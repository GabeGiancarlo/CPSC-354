<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lark documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="_static/sg_gallery.css" />
      <link rel="stylesheet" type="text/css" href="_static/sg_gallery-binder.css" />
      <link rel="stylesheet" type="text/css" href="_static/sg_gallery-dataframe.css" />
      <link rel="stylesheet" type="text/css" href="_static/sg_gallery-rendered-html.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="#" class="icon icon-home">
            Lark
          </a>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-philosophy">Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-features">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-parsers">Parsers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials &amp; Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-json_tutorial">JSON parser - Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-how_to_use">How To Use Lark - Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-how_to_develop">How to develop Lark - Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-recipes">Recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-examples/index">Examples for Lark</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#grammar-composition">Grammar Composition</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#example-grammars">Example Grammars</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#standalone-example">Standalone example</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-grammar">Grammar Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-tree_construction">Tree Construction Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-classes">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-visitors">Transformers &amp; Visitors</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-forest">Working with the SPPF</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-tools">Tools (Stand-alone, Nearley)</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">Lark</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Lark  documentation</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="welcome-to-lark-s-documentation">
<h1>Welcome to Lark’s documentation!<a class="headerlink" href="#welcome-to-lark-s-documentation" title="Permalink to this heading"></a></h1>
<div class="toctree-wrapper compound">
<span id="document-philosophy"></span><section id="philosophy">
<h2>Philosophy<a class="headerlink" href="#philosophy" title="Permalink to this heading"></a></h2>
<p>Parsers are innately complicated and confusing. They’re difficult to understand, difficult to write, and difficult to use. Even experts on the subject can become baffled by the nuances of these complicated state-machines.</p>
<p>Lark’s mission is to make the process of writing them as simple and abstract as possible, by following these design principles:</p>
<section id="design-principles">
<h3>Design Principles<a class="headerlink" href="#design-principles" title="Permalink to this heading"></a></h3>
<ol class="simple">
<li><p>Readability matters</p></li>
<li><p>Keep the grammar clean and simple</p></li>
<li><p>Don’t force the user to decide on things that the parser can figure out on its own</p></li>
<li><p>Usability is more important than performance</p></li>
<li><p>Performance is still very important</p></li>
<li><p>Follow the Zen of Python, whenever possible and applicable</p></li>
</ol>
<p>In accordance with these principles, I arrived at the following design choices:</p>
</section>
<hr class="docutils" />
<section id="design-choices">
<h3>Design Choices<a class="headerlink" href="#design-choices" title="Permalink to this heading"></a></h3>
<section id="separation-of-code-and-grammar">
<h4>1. Separation of code and grammar<a class="headerlink" href="#separation-of-code-and-grammar" title="Permalink to this heading"></a></h4>
<p>Grammars are the de-facto reference for your language, and for the structure of your parse-tree. For any non-trivial language, the conflation of code and grammar always turns out convoluted and difficult to read.</p>
<p>The grammars in Lark are EBNF-inspired, so they are especially easy to read &amp; work with.</p>
</section>
<section id="always-build-a-parse-tree-unless-told-not-to">
<h4>2. Always build a parse-tree (unless told not to)<a class="headerlink" href="#always-build-a-parse-tree-unless-told-not-to" title="Permalink to this heading"></a></h4>
<p>Trees are always simpler to work with than state-machines.</p>
<ol class="simple">
<li><p>Trees allow you to see the “state-machine” visually</p></li>
<li><p>Trees allow your computation to be aware of previous and future states</p></li>
<li><p>Trees allow you to process the parse in steps, instead of forcing you to do it all at once.</p></li>
</ol>
<p>And anyway, every parse-tree can be replayed as a state-machine, so there is no loss of information.</p>
<p>See this answer in more detail <a class="reference external" href="https://github.com/erezsh/lark/issues/4">here</a>.</p>
<p>To improve performance, you can skip building the tree for LALR(1), by providing Lark with a transformer (see the <a class="reference external" href="https://github.com/erezsh/lark/blob/master/examples/json_parser.py">JSON example</a>).</p>
</section>
<section id="earley-is-the-default">
<h4>3. Earley is the default<a class="headerlink" href="#earley-is-the-default" title="Permalink to this heading"></a></h4>
<p>The Earley algorithm can accept <em>any</em> context-free grammar you throw at it (i.e. any grammar you can write in EBNF, it can parse). That makes it extremely friendly to beginners, who are not aware of the strange and arbitrary restrictions that LALR(1) places on its grammars.</p>
<p>As the users grow to understand the structure of their grammar, the scope of their target language, and their performance requirements, they may choose to switch over to LALR(1) to gain a huge performance boost, possibly at the cost of some language features.</p>
<p>Both Earley and LALR(1) can use the same grammar, as long as all constraints are satisfied.</p>
<p>In short, “Premature optimization is the root of all evil.”</p>
</section>
<section id="other-design-features">
<h4>Other design features<a class="headerlink" href="#other-design-features" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>Automatically resolve terminal collisions whenever possible</p></li>
<li><p>Automatically keep track of line &amp; column numbers</p></li>
</ul>
</section>
</section>
</section>
<span id="document-features"></span><section id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this heading"></a></h2>
<section id="main-features">
<h3>Main Features<a class="headerlink" href="#main-features" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Earley parser, capable of parsing any context-free grammar</p>
<ul>
<li><p>Implements SPPF, for efficient parsing and storing of ambiguous grammars.</p></li>
</ul>
</li>
<li><p>LALR(1) parser, limited in power of expression, but very efficient in space and performance (O(n)).</p>
<ul>
<li><p>Implements a parse-aware lexer that provides a better power of expression than traditional LALR implementations (such as ply).</p></li>
</ul>
</li>
<li><p>EBNF-inspired grammar, with extra features (See: <a class="reference internal" href="index.html#document-grammar"><span class="doc">Grammar Reference</span></a>)</p></li>
<li><p>Builds a parse-tree (AST) automagically based on the grammar</p></li>
<li><p>Stand-alone parser generator - create a small independent parser to embed in your project. (<a class="reference external" href="tools.html#stand-alone-parser">read more</a>)</p></li>
<li><p>Flexible error handling by using an interactive parser interface (LALR only)</p></li>
<li><p>Automatic line &amp; column tracking (for both tokens and matched rules)</p></li>
<li><p>Automatic terminal collision resolution</p></li>
<li><p>Warns on regex collisions using the optional <code class="docutils literal notranslate"><span class="pre">interegular</span></code> library. (<a class="reference external" href="how_to_use.html#regex-collisions">read more</a>)</p></li>
<li><p>Grammar composition - Import terminals and rules from other grammars (see <a class="reference external" href="https://github.com/lark-parser/lark/tree/master/examples/composition">example</a>).</p></li>
<li><p>Standard library of terminals (strings, numbers, names, etc.)</p></li>
<li><p>Unicode fully supported</p></li>
<li><p>Extensive test suite</p></li>
<li><p>Type annotations (MyPy support)</p></li>
<li><p>Pure-Python implementation</p></li>
</ul>
<p><a class="reference internal" href="index.html#document-parsers"><span class="doc">Read more about the parsers</span></a></p>
</section>
<section id="extra-features">
<h3>Extra features<a class="headerlink" href="#extra-features" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Support for external regex module (<a class="reference external" href="classes.html#using-unicode-character-classes-with-regex">see here</a>)</p></li>
<li><p>Import grammars from Nearley.js (<a class="reference external" href="tools.html#importing-grammars-from-nearleyjs">read more</a>)</p></li>
<li><p>CYK parser</p></li>
<li><p>Visualize your parse trees as dot or png files (<a class="reference external" href="https://github.com/lark-parser/lark/blob/master/examples/fruitflies.py">see_example</a>)</p></li>
<li><p>Automatic reconstruction of input from parse-tree (see <a class="reference external" href="https://github.com/lark-parser/lark/blob/master/examples/advanced/reconstruct_json.py">example</a> and <a class="reference external" href="https://github.com/lark-parser/lark/blob/master/examples/advanced/reconstruct_python.py">another example</a>)</p></li>
<li><p>Use Lark grammars in <a class="reference external" href="https://github.com/jamesrhester/Lerche.jl">Julia</a> and <a class="reference external" href="https://github.com/lark-parser/Lark.js">Javascript</a>.</p></li>
</ul>
</section>
</section>
<span id="document-parsers"></span><section id="parsers">
<h2>Parsers<a class="headerlink" href="#parsers" title="Permalink to this heading"></a></h2>
<p>Lark implements the following parsing algorithms: Earley, LALR(1), and CYK</p>
<section id="earley">
<h3>Earley<a class="headerlink" href="#earley" title="Permalink to this heading"></a></h3>
<p>An <a class="reference external" href="https://www.wikiwand.com/en/Earley_parser">Earley Parser</a> is a chart parser capable of parsing any context-free grammar at O(n^3), and O(n^2) when the grammar is unambiguous. It can parse most LR grammars at O(n). Most programming languages are LR, and can be parsed at a linear time.</p>
<p>Lark’s Earley implementation runs on top of a skipping chart parser, which allows it to use regular expressions, instead of matching characters one-by-one. This is a huge improvement to Earley that is unique to Lark. This feature is used by default, but can also be requested explicitly using <code class="docutils literal notranslate"><span class="pre">lexer='dynamic'</span></code>.</p>
<p>It’s possible to bypass the dynamic lexing, and use the regular Earley parser with a basic lexer, that tokenizes as an independent first step. Doing so will provide a speed benefit, but will tokenize without using Earley’s ambiguity-resolution ability. So choose this only if you know why! Activate with <code class="docutils literal notranslate"><span class="pre">lexer='basic'</span></code></p>
<p><strong>SPPF &amp; Ambiguity resolution</strong></p>
<p>Lark implements the Shared Packed Parse Forest data-structure for the Earley parser, in order to reduce the space and computation required to handle ambiguous grammars.</p>
<p>You can read more about SPPF <a class="reference external" href="https://web.archive.org/web/20191229100607/www.bramvandersanden.com/post/2014/06/shared-packed-parse-forest">here</a></p>
<p>As a result, Lark can efficiently parse and store every ambiguity in the grammar, when using Earley.</p>
<p>Lark provides the following options to combat ambiguity:</p>
<ol class="simple">
<li><p>Lark will choose the best derivation for you (default). Users can choose between different disambiguation strategies, and can prioritize (or demote) individual rules over others, using the rule-priority syntax.</p></li>
<li><p>Users may choose to receive the set of all possible parse-trees (using ambiguity=’explicit’), and choose the best derivation themselves. While simple and flexible, it comes at the cost of space and performance, and so it isn’t recommended for highly ambiguous grammars, or very long inputs.</p></li>
<li><p>As an advanced feature, users may use specialized visitors to iterate the SPPF themselves. There is also <a class="reference external" href="https://github.com/chanicpanic/lark-ambig-tools">a 3rd party utility for iterating over the SPPF</a>.</p></li>
</ol>
<p><strong>lexer=”dynamic_complete”</strong></p>
<p>Earley’s “dynamic” lexer uses regular expressions in order to tokenize the text. It tries every possible combination of terminals, but it matches each terminal exactly once, returning the longest possible match.</p>
<p>That means, for example, that when <code class="docutils literal notranslate"><span class="pre">lexer=&quot;dynamic&quot;</span></code> (which is the default), the terminal <code class="docutils literal notranslate"><span class="pre">/a+/</span></code>, when given the text <code class="docutils literal notranslate"><span class="pre">&quot;aa&quot;</span></code>, will return one result, <code class="docutils literal notranslate"><span class="pre">aa</span></code>, even though <code class="docutils literal notranslate"><span class="pre">a</span></code> would also be correct.</p>
<p>This behavior was chosen because it is much faster, and it is usually what you would expect.</p>
<p>Setting <code class="docutils literal notranslate"><span class="pre">lexer=&quot;dynamic_complete&quot;</span></code> instructs the lexer to consider every possible regexp match. This ensures that the parser will consider and resolve every ambiguity, even inside the terminals themselves. This lexer provides the same capabilities as scannerless Earley, but with different performance tradeoffs.</p>
<p>Warning: This lexer can be much slower, especially for open-ended terminals such as <code class="docutils literal notranslate"><span class="pre">/.*/</span></code></p>
</section>
<section id="lalr-1">
<h3>LALR(1)<a class="headerlink" href="#lalr-1" title="Permalink to this heading"></a></h3>
<p><a class="reference external" href="https://www.wikiwand.com/en/LALR_parser">LALR(1)</a> is a very efficient, true-and-tested parsing algorithm. It’s incredibly fast and requires very little memory. It can parse most programming languages (For example: Python and Java).</p>
<p>LALR(1) stands for:</p>
<ul class="simple">
<li><p>Left-to-right parsing order</p></li>
<li><p>Rightmost derivation, bottom-up</p></li>
<li><p>Lookahead of 1 token</p></li>
</ul>
<p>Lark comes with an efficient implementation that outperforms every other parsing library for Python (including PLY)</p>
<p>Lark extends the traditional YACC-based architecture with a <em>contextual lexer</em>, which processes feedback from the parser, making the LALR(1) algorithm stronger than ever.</p>
<p>The contextual lexer communicates with the parser, and uses the parser’s lookahead prediction to narrow its choice of terminals. So at each point, the lexer only matches the subgroup of terminals that are legal at that parser state, instead of all of the terminals. It’s surprisingly effective at resolving common terminal collisions, and allows one to parse languages that LALR(1) was previously incapable of parsing.</p>
<p>(If you’re familiar with YACC, you can think of it as automatic lexer-states)</p>
<p>This is an improvement to LALR(1) that is unique to Lark.</p>
<section id="grammar-constraints-in-lalr-1">
<h4>Grammar constraints in LALR(1)<a class="headerlink" href="#grammar-constraints-in-lalr-1" title="Permalink to this heading"></a></h4>
<p>Due to having only a lookahead of one token, LALR is limited in its ability to choose between rules, when they both match the input.</p>
<p>Tips for writing a conforming grammar:</p>
<ul class="simple">
<li><p>Try to avoid writing different rules that can match the same sequence of characters.</p></li>
<li><p>For the best performance, prefer left-recursion over right-recursion.</p></li>
<li><p>Consider setting terminal priority only as a last resort.</p></li>
</ul>
<p>For a better understanding of these constraints, it’s recommended to learn how a SLR parser works. SLR is very similar to LALR but much simpler.</p>
</section>
</section>
<section id="cyk-parser">
<h3>CYK Parser<a class="headerlink" href="#cyk-parser" title="Permalink to this heading"></a></h3>
<p>A <a class="reference external" href="https://www.wikiwand.com/en/CYK_algorithm">CYK parser</a> can parse any context-free grammar at O(n^3*|G|).</p>
<p>Its too slow to be practical for simple grammars, but it offers good performance for highly ambiguous grammars.</p>
</section>
</section>
</div>
<div class="toctree-wrapper compound">
<span id="document-json_tutorial"></span><section id="json-parser-tutorial">
<h2>JSON parser - Tutorial<a class="headerlink" href="#json-parser-tutorial" title="Permalink to this heading"></a></h2>
<p>Lark is a parser - a program that accepts a grammar and text, and produces a structured tree that represents that text.
In this tutorial we will write a JSON parser in Lark, and explore Lark’s various features in the process.</p>
<p>It has 5 parts.</p>
<ol class="simple">
<li><p>Writing the grammar</p></li>
<li><p>Creating the parser</p></li>
<li><p>Shaping the tree</p></li>
<li><p>Evaluating the tree</p></li>
<li><p>Optimizing</p></li>
</ol>
<p>Knowledge assumed:</p>
<ul class="simple">
<li><p>Using Python</p></li>
<li><p>A basic understanding of how to use regular expressions</p></li>
</ul>
<section id="part-1-the-grammar">
<h3>Part 1 - The Grammar<a class="headerlink" href="#part-1-the-grammar" title="Permalink to this heading"></a></h3>
<p>Lark accepts its grammars in a format called <a class="reference external" href="https://www.wikiwand.com/en/Extended_Backus%E2%80%93Naur_form">EBNF</a>. It basically looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule_name</span> <span class="p">:</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">rules</span> <span class="ow">and</span> <span class="n">TERMINALS</span> <span class="n">to</span> <span class="n">match</span>
          <span class="o">|</span> <span class="n">another</span> <span class="n">possible</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">items</span>
          <span class="o">|</span> <span class="n">etc</span><span class="o">.</span>

<span class="n">TERMINAL</span><span class="p">:</span> <span class="s2">&quot;some text to match&quot;</span>
</pre></div>
</div>
<p>(<em>a terminal is a string or a regular expression</em>)</p>
<p>The parser will try to match each rule (left-part) by matching its items (right-part) sequentially, trying each alternative (In practice, the parser is predictive so we don’t have to try every alternative).</p>
<p>How to structure those rules is beyond the scope of this tutorial, but often it’s enough to follow one’s intuition.</p>
<p>In the case of JSON, the structure is simple: A json document is either a list, or a dictionary, or a string/number/etc.</p>
<p>The dictionaries and lists are recursive, and contain other json documents (or “values”).</p>
<p>Let’s write this structure in EBNF form:</p>
<div class="highlight-lark notranslate"><div class="highlight"><pre><span></span>    value: dict
         | list
         | STRING
         | NUMBER
         | &quot;true&quot; | &quot;false&quot; | &quot;null&quot;

    list : &quot;[&quot; [value (&quot;,&quot; value)*] &quot;]&quot;

    dict : &quot;{&quot; [pair (&quot;,&quot; pair)*] &quot;}&quot;
    pair : STRING &quot;:&quot; value
</pre></div>
</div>
<p>A quick explanation of the syntax:</p>
<ul class="simple">
<li><p>Parenthesis let us group rules together.</p></li>
<li><p>rule* means <em>any amount</em>. That means, zero or more instances of that rule.</p></li>
<li><p>[rule] means <em>optional</em>. That means zero or one instance of that rule.</p></li>
</ul>
<p>Lark also supports the rule+ operator, meaning one or more instances. It also supports the rule? operator which is another way to say <em>optional</em>.</p>
<p>Of course, we still haven’t defined “STRING” and “NUMBER”. Luckily, both these literals are already defined in Lark’s common library:</p>
<div class="highlight-lark notranslate"><div class="highlight"><pre><span></span>    %import common.ESCAPED_STRING   -&gt; STRING
    %import common.SIGNED_NUMBER    -&gt; NUMBER
</pre></div>
</div>
<p>The arrow (-&gt;) renames the terminals. But that only adds obscurity in this case, so going forward we’ll just use their original names.</p>
<p>We’ll also take care of the white-space, which is part of the text, by simply matching and then throwing it away.</p>
<div class="highlight-lark notranslate"><div class="highlight"><pre><span></span>    %import common.WS
    %ignore WS
</pre></div>
</div>
<p>We tell our parser to ignore whitespace. Otherwise, we’d have to fill our grammar with WS terminals.</p>
<p>By the way, if you’re curious what these terminals signify, they are roughly equivalent to this:</p>
<div class="highlight-lark notranslate"><div class="highlight"><pre><span></span>    NUMBER : /-?\d+(\.\d+)?([eE][+-]?\d+)?/
    STRING : /&quot;.*?(?&lt;!\\)&quot;/
    %ignore /[ \t\n\f\r]+/
</pre></div>
</div>
<p>Lark will accept this way of writing too, if you really want to complicate your life :)</p>
<p>You can find the original definitions in <a class="reference external" href="https://github.com/lark-parser/lark/blob/master/lark/grammars/common.lark">common.lark</a>.
They don’t strictly adhere to <a class="reference external" href="https://json.org/">json.org</a> - but our purpose here is to accept json, not validate it.</p>
<p>Notice that terminals are written in UPPER-CASE, while rules are written in lower-case.
I’ll touch more on the differences between rules and terminals later.</p>
</section>
<section id="part-2-creating-the-parser">
<h3>Part 2 - Creating the Parser<a class="headerlink" href="#part-2-creating-the-parser" title="Permalink to this heading"></a></h3>
<p>Once we have our grammar, creating the parser is very simple.</p>
<p>We simply instantiate Lark, and tell it to accept a “value”:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span>
<span class="n">json_parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    value: dict</span>
<span class="s2">         | list</span>
<span class="s2">         | ESCAPED_STRING</span>
<span class="s2">         | SIGNED_NUMBER</span>
<span class="s2">         | &quot;true&quot; | &quot;false&quot; | &quot;null&quot;</span>

<span class="s2">    list : &quot;[&quot; [value (&quot;,&quot; value)*] &quot;]&quot;</span>

<span class="s2">    dict : &quot;{&quot; [pair (&quot;,&quot; pair)*] &quot;}&quot;</span>
<span class="s2">    pair : ESCAPED_STRING &quot;:&quot; value</span>

<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common.ESCAPED_STRING</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common.SIGNED_NUMBER</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common.WS</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">gnore WS</span>

<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>It’s that simple! Let’s test it out:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;{&quot;key&quot;: [&quot;item0&quot;, &quot;item1&quot;, 3.14]}&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">json_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="go">Tree(value, [Tree(dict, [Tree(pair, [Token(STRING, &quot;key&quot;), Tree(value, [Tree(list, [Tree(value, [Token(STRING, &quot;item0&quot;)]), Tree(value, [Token(STRING, &quot;item1&quot;)]), Tree(value, [Token(NUMBER, 3.14)])])])])])])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span> <span class="n">_</span><span class="o">.</span><span class="n">pretty</span><span class="p">()</span> <span class="p">)</span>
<span class="go">value</span>
<span class="go">  dict</span>
<span class="go">    pair</span>
<span class="go">      &quot;key&quot;</span>
<span class="go">      value</span>
<span class="go">        list</span>
<span class="go">          value	&quot;item0&quot;</span>
<span class="go">          value	&quot;item1&quot;</span>
<span class="go">          value	3.14</span>
</pre></div>
</div>
<p>As promised, Lark automagically creates a tree that represents the parsed text.</p>
<p>But something is suspiciously missing from the tree. Where are the curly braces, the commas and all the other punctuation literals?</p>
<p>Lark automatically filters out literals from the tree, based on the following criteria:</p>
<ul class="simple">
<li><p>Filter out string literals without a name, or with a name that starts with an underscore.</p></li>
<li><p>Keep regexps, even unnamed ones, unless their name starts with an underscore.</p></li>
</ul>
<p>Unfortunately, this means that it will also filter out literals like “true” and “false”, and we will lose that information. The next section, “Shaping the tree” deals with this issue, and others.</p>
</section>
<section id="part-3-shaping-the-tree">
<h3>Part 3 - Shaping the Tree<a class="headerlink" href="#part-3-shaping-the-tree" title="Permalink to this heading"></a></h3>
<p>We now have a parser that can create a parse tree (or: AST), but the tree has some issues:</p>
<ol class="simple">
<li><p>“true”, “false” and “null” are filtered out (test it out yourself!)</p></li>
<li><p>Is has useless branches, like <em>value</em>, that clutter-up our view.</p></li>
</ol>
<p>I’ll present the solution, and then explain it:</p>
<div class="highlight-lark notranslate"><div class="highlight"><pre><span></span>    ?value: dict
          | list
          | string
          | SIGNED_NUMBER      -&gt; number
          | &quot;true&quot;             -&gt; true
          | &quot;false&quot;            -&gt; false
          | &quot;null&quot;             -&gt; null

    ...

    string : ESCAPED_STRING
</pre></div>
</div>
<ol class="simple">
<li><p>Those little arrows signify <em>aliases</em>. An alias is a name for a specific part of the rule. In this case, we will name the <em>true/false/null</em> matches, and this way we won’t lose the information. We also alias <em>SIGNED_NUMBER</em> to mark it for later processing.</p></li>
<li><p>The question-mark prefixing <em>value</em> (”?value”) tells the tree-builder to inline this branch if it has only one member. In this case, <em>value</em> will always have only one member, and will always be inlined.</p></li>
<li><p>We turned the <em>ESCAPED_STRING</em> terminal into a rule. This way it will appear in the tree as a branch. This is equivalent to aliasing (like we did for the number), but now <em>string</em> can also be used elsewhere in the grammar (namely, in the <em>pair</em> rule).</p></li>
</ol>
<p>Here is the new grammar:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span>
<span class="n">json_parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    ?value: dict</span>
<span class="s2">          | list</span>
<span class="s2">          | string</span>
<span class="s2">          | SIGNED_NUMBER      -&gt; number</span>
<span class="s2">          | &quot;true&quot;             -&gt; true</span>
<span class="s2">          | &quot;false&quot;            -&gt; false</span>
<span class="s2">          | &quot;null&quot;             -&gt; null</span>

<span class="s2">    list : &quot;[&quot; [value (&quot;,&quot; value)*] &quot;]&quot;</span>

<span class="s2">    dict : &quot;{&quot; [pair (&quot;,&quot; pair)*] &quot;}&quot;</span>
<span class="s2">    pair : string &quot;:&quot; value</span>

<span class="s2">    string : ESCAPED_STRING</span>

<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common.ESCAPED_STRING</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common.SIGNED_NUMBER</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common.WS</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">gnore WS</span>

<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>And let’s test it out:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;{&quot;key&quot;: [&quot;item0&quot;, &quot;item1&quot;, 3.14, true]}&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span> <span class="n">json_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">pretty</span><span class="p">()</span> <span class="p">)</span>
<span class="go">dict</span>
<span class="go">  pair</span>
<span class="go">    string	&quot;key&quot;</span>
<span class="go">    list</span>
<span class="go">      string	&quot;item0&quot;</span>
<span class="go">      string	&quot;item1&quot;</span>
<span class="go">      number	3.14</span>
<span class="go">      true</span>
</pre></div>
</div>
<p>Ah! That is much much nicer.</p>
</section>
<section id="part-4-evaluating-the-tree">
<h3>Part 4 - Evaluating the tree<a class="headerlink" href="#part-4-evaluating-the-tree" title="Permalink to this heading"></a></h3>
<p>It’s nice to have a tree, but what we really want is a JSON object.</p>
<p>The way to do it is to evaluate the tree, using a Transformer.</p>
<p>A transformer is a class with methods corresponding to branch names. For each branch, the appropriate method will be called with the children of the branch as its argument, and its return value will replace the branch in the tree.</p>
<p>So let’s write a partial transformer, that handles lists and dictionaries:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Transformer</span>

<span class="k">class</span> <span class="nc">MyTransformer</span><span class="p">(</span><span class="n">Transformer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">pair</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_value</span><span class="p">):</span>
        <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">key_value</span>
        <span class="k">return</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span>
    <span class="k">def</span> <span class="nf">dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
</pre></div>
</div>
<p>And when we run it, we get this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tree</span> <span class="o">=</span> <span class="n">json_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">MyTransformer</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="go">{Tree(string, [Token(ANONRE_1, &quot;key&quot;)]): [Tree(string, [Token(ANONRE_1, &quot;item0&quot;)]), Tree(string, [Token(ANONRE_1, &quot;item1&quot;)]), Tree(number, [Token(ANONRE_0, 3.14)]), Tree(true, [])]}</span>
</pre></div>
</div>
<p>This is pretty close. Let’s write a full transformer that can handle the terminals too.</p>
<p>Also, our definitions of list and dict are a bit verbose. We can do better:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Transformer</span>

<span class="k">class</span> <span class="nc">TreeToJson</span><span class="p">(</span><span class="n">Transformer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="p">(</span><span class="n">s</span><span class="p">,)</span> <span class="o">=</span> <span class="n">s</span>
        <span class="k">return</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="p">(</span><span class="n">n</span><span class="p">,)</span> <span class="o">=</span> <span class="n">n</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="nb">list</span> <span class="o">=</span> <span class="nb">list</span>
    <span class="n">pair</span> <span class="o">=</span> <span class="nb">tuple</span>
    <span class="nb">dict</span> <span class="o">=</span> <span class="nb">dict</span>

    <span class="n">null</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="kc">None</span>
    <span class="n">true</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="kc">True</span>
    <span class="n">false</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="kc">False</span>
</pre></div>
</div>
<p>And when we run it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tree</span> <span class="o">=</span> <span class="n">json_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">TreeToJson</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="go">{u&#39;key&#39;: [u&#39;item0&#39;, u&#39;item1&#39;, 3.14, True]}</span>
</pre></div>
</div>
<p>Magic!</p>
</section>
<section id="part-5-optimizing">
<h3>Part 5 - Optimizing<a class="headerlink" href="#part-5-optimizing" title="Permalink to this heading"></a></h3>
<section id="step-1-benchmark">
<h4>Step 1 - Benchmark<a class="headerlink" href="#step-1-benchmark" title="Permalink to this heading"></a></h4>
<p>By now, we have a fully working JSON parser, that can accept a string of JSON, and return its Pythonic representation.</p>
<p>But how fast is it?</p>
<p>Now, of course there are JSON libraries for Python written in C, and we can never compete with them. But since this is applicable to any parser you would write in Lark, let’s see how far we can take this.</p>
<p>The first step for optimizing is to have a benchmark. For this benchmark I’m going to take data from <a class="reference external" href="http://www.json-generator.com/">json-generator.com/</a>. I took their default suggestion and changed it to 5000 objects. The result is a 6.6MB sparse JSON file.</p>
<p>Our first program is going to be just a concatenation of everything we’ve done so far:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span><span class="p">,</span> <span class="n">Transformer</span>

<span class="n">json_grammar</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    ?value: dict</span>
<span class="s2">          | list</span>
<span class="s2">          | string</span>
<span class="s2">          | SIGNED_NUMBER      -&gt; number</span>
<span class="s2">          | &quot;true&quot;             -&gt; true</span>
<span class="s2">          | &quot;false&quot;            -&gt; false</span>
<span class="s2">          | &quot;null&quot;             -&gt; null</span>

<span class="s2">    list : &quot;[&quot; [value (&quot;,&quot; value)*] &quot;]&quot;</span>

<span class="s2">    dict : &quot;{&quot; [pair (&quot;,&quot; pair)*] &quot;}&quot;</span>
<span class="s2">    pair : string &quot;:&quot; value</span>

<span class="s2">    string : ESCAPED_STRING</span>

<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common.ESCAPED_STRING</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common.SIGNED_NUMBER</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common.WS</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">gnore WS</span>
<span class="s2">    &quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">TreeToJson</span><span class="p">(</span><span class="n">Transformer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="p">(</span><span class="n">s</span><span class="p">,)</span> <span class="o">=</span> <span class="n">s</span>
        <span class="k">return</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="p">(</span><span class="n">n</span><span class="p">,)</span> <span class="o">=</span> <span class="n">n</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="nb">list</span> <span class="o">=</span> <span class="nb">list</span>
    <span class="n">pair</span> <span class="o">=</span> <span class="nb">tuple</span>
    <span class="nb">dict</span> <span class="o">=</span> <span class="nb">dict</span>

    <span class="n">null</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="kc">None</span>
    <span class="n">true</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="kc">True</span>
    <span class="n">false</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="kc">False</span>

<span class="n">json_parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="n">json_grammar</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">lexer</span><span class="o">=</span><span class="s1">&#39;basic&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">json_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">TreeToJson</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">tree</span><span class="p">))</span>
</pre></div>
</div>
<p>We run it and get this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ time python tutorial_json.py json_data &gt; /dev/null

real	0m36.257s
user	0m34.735s
sys         0m1.361s
</pre></div>
</div>
<p>That’s unsatisfactory time for a 6MB file. Maybe if we were parsing configuration or a small DSL, but we’re trying to handle large amount of data here.</p>
<p>Well, turns out there’s quite a bit we can do about it!</p>
</section>
<section id="step-2-lalr-1">
<h4>Step 2 - LALR(1)<a class="headerlink" href="#step-2-lalr-1" title="Permalink to this heading"></a></h4>
<p>So far we’ve been using the Earley algorithm, which is the default in Lark. Earley is powerful but slow. But it just so happens that our grammar is LR-compatible, and specifically LALR(1) compatible.</p>
<p>So let’s switch to LALR(1) and see what happens:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">json_parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="n">json_grammar</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s1">&#39;lalr&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ time python tutorial_json.py json_data &gt; /dev/null

real        0m7.554s
user        0m7.352s
sys         0m0.148s
</pre></div>
</div>
<p>Ah, that’s much better. The resulting JSON is of course exactly the same. You can run it for yourself and see.</p>
<p>It’s important to note that not all grammars are LR-compatible, and so you can’t always switch to LALR(1). But there’s no harm in trying! If Lark lets you build the grammar, it means you’re good to go.</p>
</section>
<section id="step-3-tree-less-lalr-1">
<h4>Step 3 - Tree-less LALR(1)<a class="headerlink" href="#step-3-tree-less-lalr-1" title="Permalink to this heading"></a></h4>
<p>So far, we’ve built a full parse tree for our JSON, and then transformed it. It’s a convenient method, but it’s not the most efficient in terms of speed and memory. Luckily, Lark lets us avoid building the tree when parsing with LALR(1).</p>
<p>Here’s the way to do it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">json_parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="n">json_grammar</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s1">&#39;lalr&#39;</span><span class="p">,</span> <span class="n">transformer</span><span class="o">=</span><span class="n">TreeToJson</span><span class="p">())</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span> <span class="n">json_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span> <span class="p">)</span>
</pre></div>
</div>
<p>We’ve used the transformer we’ve already written, but this time we plug it straight into the parser. Now it can avoid building the parse tree, and just send the data straight into our transformer. The <em>parse()</em> method now returns the transformed JSON, instead of a tree.</p>
<p>Let’s benchmark it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">real</span>	<span class="mi">0</span><span class="n">m4</span><span class="mf">.866</span><span class="n">s</span>
<span class="n">user</span>	<span class="mi">0</span><span class="n">m4</span><span class="mf">.722</span><span class="n">s</span>
<span class="n">sys</span> 	<span class="mi">0</span><span class="n">m0</span><span class="mf">.121</span><span class="n">s</span>
</pre></div>
</div>
<p>That’s a measurable improvement! Also, this way is more memory efficient. Check out the benchmark table at the end to see just how much.</p>
<p>As a general practice, it’s recommended to work with parse trees, and only skip the tree-builder when your transformer is already working.</p>
</section>
<section id="step-4-pypy">
<h4>Step 4 - PyPy<a class="headerlink" href="#step-4-pypy" title="Permalink to this heading"></a></h4>
<p>PyPy is a JIT engine for running Python, and it’s designed to be a drop-in replacement.</p>
<p>Lark is written purely in Python, which makes it very suitable for PyPy.</p>
<p>Let’s get some free performance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ time pypy tutorial_json.py json_data &gt; /dev/null

real	0m1.397s
user	0m1.296s
sys 	0m0.083s
</pre></div>
</div>
<p>PyPy is awesome!</p>
</section>
<section id="conclusion">
<h4>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this heading"></a></h4>
<p>We’ve brought the run-time down from 36 seconds to 1.1 seconds, in a series of small and simple steps.</p>
<p>Now let’s compare the benchmarks in a nicely organized table.</p>
<p>I measured memory consumption using a little script called <a class="reference external" href="https://gist.github.com/netj/526585">memusg</a></p>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: left;">Code</th>
<th style="text-align: left;">CPython Time</th>
<th style="text-align: left;">PyPy Time</th>
<th style="text-align: left;">CPython Mem</th>
<th style="text-align: left;">PyPy Mem</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Lark - Earley <em>(with lexer)</em></td>
<td style="text-align: left;">42s</td>
<td style="text-align: left;">4s</td>
<td style="text-align: left;">1167M</td>
<td style="text-align: left;">608M</td>
</tr>
<tr>
<td style="text-align: left;">Lark - LALR(1)</td>
<td style="text-align: left;">8s</td>
<td style="text-align: left;">1.53s</td>
<td style="text-align: left;">453M</td>
<td style="text-align: left;">266M</td>
</tr>
<tr>
<td style="text-align: left;">Lark - LALR(1) tree-less</td>
<td style="text-align: left;">4.76s</td>
<td style="text-align: left;">1.23s</td>
<td style="text-align: left;">70M</td>
<td style="text-align: left;">134M</td>
</tr>
<tr>
<td style="text-align: left;">PyParsing (<a href="https://github.com/pyparsing/pyparsing/blob/master/examples/jsonParser.py">Parser</a>)</td>
<td style="text-align: left;">32s</td>
<td style="text-align: left;">3.53s</td>
<td style="text-align: left;">443M</td>
<td style="text-align: left;">225M</td>
</tr>
<tr>
<td style="text-align: left;">funcparserlib (<a href="https://github.com/vlasovskikh/funcparserlib/blob/master/tests/json.py">Parser</a>)</td>
<td style="text-align: left;">8.5s</td>
<td style="text-align: left;">1.3s</td>
<td style="text-align: left;">483M</td>
<td style="text-align: left;">293M</td>
</tr>
<tr>
<td style="text-align: left;">Parsimonious (<a href="https://gist.github.com/reclosedev/5222560">Parser</a>)</td>
<td style="text-align: left;">?</td>
<td style="text-align: left;">5.7s</td>
<td style="text-align: left;">?</td>
<td style="text-align: left;">1545M</td>
</tr>
</tbody>
</table><p>I added a few other parsers for comparison. PyParsing and funcparselib fair pretty well in their memory usage (they don’t build a tree), but they can’t compete with the run-time speed of LALR(1).</p>
<p>These benchmarks are for Lark’s alpha version. I already have several optimizations planned that will significantly improve run-time speed.</p>
<p>Once again, shout-out to PyPy for being so effective.</p>
</section>
</section>
<section id="afterword">
<h3>Afterword<a class="headerlink" href="#afterword" title="Permalink to this heading"></a></h3>
<p>This is the end of the tutorial. I hoped you liked it and learned a little about Lark.</p>
<p>To see what else you can do with Lark, check out the <a class="reference external" href="/examples">examples</a>.</p>
<p>Read the documentation here: https://lark-parser.readthedocs.io/en/latest/</p>
</section>
</section>
<span id="document-how_to_use"></span><section id="how-to-use-lark-guide">
<h2>How To Use Lark - Guide<a class="headerlink" href="#how-to-use-lark-guide" title="Permalink to this heading"></a></h2>
<section id="work-process">
<h3>Work process<a class="headerlink" href="#work-process" title="Permalink to this heading"></a></h3>
<p>This is the recommended process for working with Lark:</p>
<ol>
<li><p>Collect or create input samples, that demonstrate key features or behaviors in the language you’re trying to parse.</p></li>
<li><p>Write a grammar. Try to aim for a structure that is intuitive, and in a way that imitates how you would explain your language to a fellow human.</p></li>
<li><p>Try your grammar in Lark against each input sample. Make sure the resulting parse-trees make sense.</p></li>
<li><p>Use Lark’s grammar features to <a class="reference internal" href="index.html#document-tree_construction"><span class="doc">shape the tree</span></a>: Get rid of superfluous rules by inlining them, and use aliases when specific cases need clarification.</p>
<p>You can perform steps 1-4 repeatedly, gradually growing your grammar to include more sentences.</p>
</li>
<li><p>Create a transformer to evaluate the parse-tree into a structure you’ll be comfortable to work with. This may include evaluating literals, merging branches, or even converting the entire tree into your own set of AST classes.</p></li>
</ol>
<p>Of course, some specific use-cases may deviate from this process. Feel free to suggest these cases, and I’ll add them to this page.</p>
</section>
<section id="getting-started">
<h3>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this heading"></a></h3>
<p>Browse the <a class="reference external" href="https://github.com/lark-parser/lark/tree/master/examples">Examples</a> to find a template that suits your purposes.</p>
<p>Read the tutorials to get a better understanding of how everything works. (links in the <a class="reference internal" href="index.html#document-index"><span class="doc">main page</span></a>)</p>
<p>Use the <a class="reference external" href="https://lark-parser.readthedocs.io/en/latest/_static/lark_cheatsheet.pdf">Cheatsheet (PDF)</a> for quick reference.</p>
<p>Use the reference pages for more in-depth explanations. (links in the <a class="reference internal" href="index.html#document-index"><span class="doc">main page</span></a>)</p>
</section>
<section id="debug">
<h3>Debug<a class="headerlink" href="#debug" title="Permalink to this heading"></a></h3>
<p>Grammars may contain non-obvious bugs, usually caused by rules or terminals interfering with each other in subtle ways.</p>
<p>When trying to debug a misbehaving grammar, the following methodology is recommended:</p>
<ol class="simple">
<li><p>Create a copy of the grammar, so you can change the parser/grammar without any worries</p></li>
<li><p>Find the minimal input that creates the error</p></li>
<li><p>Slowly remove rules from the grammar, while making sure the error still occurs.</p></li>
</ol>
<p>Usually, by the time you get to a minimal grammar, the problem becomes clear.</p>
<p>But if it doesn’t, feel free to ask us on gitter, or even open an issue. Post a reproducing code, with the minimal grammar and input, and we’ll do our best to help.</p>
<section id="regex-collisions">
<h4>Regex collisions<a class="headerlink" href="#regex-collisions" title="Permalink to this heading"></a></h4>
<p>A likely source of bugs occurs when two regexes in a grammar can match the same input. If both terminals have the same priority, most lexers would arbitrarily choose the first one that matches, which isn’t always the desired one. (a notable exception is the <code class="docutils literal notranslate"><span class="pre">dynamic_complete</span></code> lexer, which always tries all variations. But its users pay for that with performance.)</p>
<p>These collisions can be hard to notice, and their effects can be difficult to debug, as they are subtle and sometimes hard to reproduce.</p>
<p>To help with these situations, Lark can utilize a new external library called <code class="docutils literal notranslate"><span class="pre">interegular</span></code>. If it is installed, Lark uses it to check for collisions, and warn about any conflicts that it can find:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span><span class="p">,</span> <span class="n">logger</span>

<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARN</span><span class="p">)</span>

<span class="n">collision_grammar</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">start: A | B</span>
<span class="s1">A: /a+/</span>
<span class="s1">B: /[ab]+/</span>
<span class="s1">&#39;&#39;&#39;</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="n">collision_grammar</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s1">&#39;lalr&#39;</span><span class="p">)</span>

<span class="c1"># Output:</span>
<span class="c1"># Collision between Terminals B and A. The lexer will choose between them arbitrarily</span>
<span class="c1"># Example Collision: a</span>
</pre></div>
</div>
<p>You can install interegular for Lark using <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">'lark[interegular]'</span></code>.</p>
<p>Note 1: Interegular currently only runs when the lexer is <code class="docutils literal notranslate"><span class="pre">basic</span></code> or <code class="docutils literal notranslate"><span class="pre">contextual</span></code>.</p>
<p>Note 2: Some advanced regex features, such as lookahead and lookbehind, may prevent interegular from detecting existing collisions.</p>
</section>
<section id="shift-reduce-collisions">
<h4>Shift/Reduce collisions<a class="headerlink" href="#shift-reduce-collisions" title="Permalink to this heading"></a></h4>
<p>By default Lark automatically resolves Shift/Reduce conflicts as Shift. It produces notifications as debug messages.</p>
<p>when users pass <code class="docutils literal notranslate"><span class="pre">debug=True</span></code>, those notifications are written as warnings.</p>
<p>Either way, to get the messages printed you have to configure the <code class="docutils literal notranslate"><span class="pre">logger</span></code> beforehand. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span><span class="p">,</span> <span class="n">logger</span>

<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="n">collision_grammar</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">start: as as</span>
<span class="s1">as: a*</span>
<span class="s1">a: &quot;a&quot;</span>
<span class="s1">&#39;&#39;&#39;</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="n">collision_grammar</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s1">&#39;lalr&#39;</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Shift/Reduce conflict for terminal A: (resolving as shift)</span>
<span class="c1">#  * &lt;as : &gt;</span>
<span class="c1"># Shift/Reduce conflict for terminal A: (resolving as shift)</span>
<span class="c1">#  * &lt;as : __as_star_0&gt;</span>
</pre></div>
</div>
</section>
<section id="strict-mode">
<h4>Strict-Mode<a class="headerlink" href="#strict-mode" title="Permalink to this heading"></a></h4>
<p>Lark, by default, accepts grammars with unresolved Shift/Reduce collisions (which it always resolves to shift), and regex collisions.</p>
<p>Strict-mode allows users to validate that their grammars don’t contain these collisions.</p>
<p>When Lark is initialized with <code class="docutils literal notranslate"><span class="pre">strict=True</span></code>, it raises an exception on any Shift/Reduce or regex collision.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">interegular</span></code> isn’t installed, an exception is thrown.</p>
<p>When using strict-mode, users will be expected to resolve their collisions manually:</p>
<ul class="simple">
<li><p>To resolve Shift/Reduce collisions, adjust the priority weights of the rules involved, until there are no more collisions.</p></li>
<li><p>To resolve regex collisions, change the involved regexes so that they can no longer both match the same input (Lark provides an example).</p></li>
</ul>
<p>Strict-mode only applies to LALR for now.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span>

<span class="n">collision_grammar</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">start: as as</span>
<span class="s1">as: a*</span>
<span class="s1">a: &quot;a&quot;</span>
<span class="s1">&#39;&#39;&#39;</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="n">collision_grammar</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s1">&#39;lalr&#39;</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Traceback (most recent call last):</span>
<span class="c1">#   ...</span>
<span class="c1"># lark.exceptions.GrammarError: Shift/Reduce conflict for terminal A. [strict-mode]</span>
</pre></div>
</div>
</section>
</section>
<section id="tools">
<h3>Tools<a class="headerlink" href="#tools" title="Permalink to this heading"></a></h3>
<section id="stand-alone-parser">
<h4>Stand-alone parser<a class="headerlink" href="#stand-alone-parser" title="Permalink to this heading"></a></h4>
<p>Lark can generate a stand-alone LALR(1) parser from a grammar.</p>
<p>The resulting module provides the same interface as Lark, but with a fixed grammar, and reduced functionality.</p>
<p>Run using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>lark.tools.standalone
</pre></div>
</div>
<p>For a play-by-play, read the <a class="reference external" href="http://blog.erezsh.com/create-a-stand-alone-lalr1-parser-in-python/">tutorial</a></p>
</section>
<section id="import-nearley-js-grammars">
<h4>Import Nearley.js grammars<a class="headerlink" href="#import-nearley-js-grammars" title="Permalink to this heading"></a></h4>
<p>It is possible to import Nearley grammars into Lark. The Javascript code is translated using Js2Py.</p>
<p>See the <a class="reference internal" href="index.html#document-tools"><span class="doc">tools page</span></a> for more information.</p>
</section>
</section>
</section>
<span id="document-how_to_develop"></span><section id="how-to-develop-lark-guide">
<h2>How to develop Lark - Guide<a class="headerlink" href="#how-to-develop-lark-guide" title="Permalink to this heading"></a></h2>
<p>There are many ways you can help the project:</p>
<ul class="simple">
<li><p>Help solve issues</p></li>
<li><p>Improve the documentation</p></li>
<li><p>Write new grammars for Lark’s library</p></li>
<li><p>Write a blog post introducing Lark to your audience</p></li>
<li><p>Port Lark to another language</p></li>
<li><p>Help with code development</p></li>
</ul>
<p>If you’re interested in taking one of these on, contact us on <a class="reference external" href="https://gitter.im/lark-parser/Lobby">Gitter</a> or <a class="reference external" href="https://github.com/lark-parser/lark/discussions">Github Discussion</a>, and we will provide more details and assist you in the process.</p>
<section id="code-style">
<h3>Code Style<a class="headerlink" href="#code-style" title="Permalink to this heading"></a></h3>
<p>Lark does not follow a predefined code style.
We accept any code style that makes sense, as long as it’s Pythonic and easy to read.</p>
</section>
<section id="unit-tests">
<h3>Unit Tests<a class="headerlink" href="#unit-tests" title="Permalink to this heading"></a></h3>
<p>Lark comes with an extensive set of tests. Many of the tests will run several times, once for each parser configuration.</p>
<p>To run the tests, just go to the lark project root, and run the command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>tests
</pre></div>
</div>
<p>or</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pypy<span class="w"> </span>-m<span class="w"> </span>tests
</pre></div>
</div>
<p>For a list of supported interpreters, you can consult the <code class="docutils literal notranslate"><span class="pre">tox.ini</span></code> file.</p>
<p>You can also run a single unittest using its class and method name, for example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">##   test_package test_class_name.test_function_name</span>
python<span class="w"> </span>-m<span class="w"> </span>tests<span class="w"> </span>TestLalrBasic.test_keep_all_tokens
</pre></div>
</div>
<section id="tox">
<h4>tox<a class="headerlink" href="#tox" title="Permalink to this heading"></a></h4>
<p>To run all Unit Tests with tox,
install tox and Python 2.7 up to the latest python interpreter supported (consult the file tox.ini).
Then,
run the command <code class="docutils literal notranslate"><span class="pre">tox</span></code> on the root of this project (where the main setup.py file is on).</p>
<p>And, for example,
if you would like to only run the Unit Tests for Python version 2.7,
you can run the command <code class="docutils literal notranslate"><span class="pre">tox</span> <span class="pre">-e</span> <span class="pre">py27</span></code></p>
</section>
<section id="pytest">
<h4>pytest<a class="headerlink" href="#pytest" title="Permalink to this heading"></a></h4>
<p>You can also run the tests using pytest:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest<span class="w"> </span>tests
</pre></div>
</div>
</section>
<section id="using-setup-py">
<h4>Using setup.py<a class="headerlink" href="#using-setup-py" title="Permalink to this heading"></a></h4>
<p>Another way to run the tests is using setup.py:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>setup.py<span class="w"> </span><span class="nb">test</span>
</pre></div>
</div>
</section>
</section>
<section id="building-the-documentation">
<h3>Building the Documentation<a class="headerlink" href="#building-the-documentation" title="Permalink to this heading"></a></h3>
<p>To build the documentation:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>docs/
pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
make<span class="w"> </span>html
</pre></div>
</div>
<p>To review the result, open the built HTML files under <code class="docutils literal notranslate"><span class="pre">_build/html/</span></code> in your browser.</p>
</section>
</section>
<span id="document-recipes"></span><section id="recipes">
<h2>Recipes<a class="headerlink" href="#recipes" title="Permalink to this heading"></a></h2>
<p>A collection of recipes to use Lark and its various features</p>
<section id="use-a-transformer-to-parse-integer-tokens">
<h3>Use a transformer to parse integer tokens<a class="headerlink" href="#use-a-transformer-to-parse-integer-tokens" title="Permalink to this heading"></a></h3>
<p>Transformers are the common interface for processing matched rules and tokens.</p>
<p>They can be used during parsing for better performance.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span><span class="p">,</span> <span class="n">Transformer</span>

<span class="k">class</span> <span class="nc">T</span><span class="p">(</span><span class="n">Transformer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">INT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tok</span><span class="p">):</span>
        <span class="s2">&quot;Convert the value of `tok` from string to int, while maintaining line number &amp; column.&quot;</span>
        <span class="k">return</span> <span class="n">tok</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">tok</span><span class="p">))</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">start: INT*</span>
<span class="si">%i</span><span class="s2">mport common.INT</span>
<span class="si">%i</span><span class="s2">gnore &quot; &quot;</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s2">&quot;lalr&quot;</span><span class="p">,</span> <span class="n">transformer</span><span class="o">=</span><span class="n">T</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;3 14 159&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Prints out:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Tree</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="p">[</span><span class="n">Token</span><span class="p">(</span><span class="n">INT</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">Token</span><span class="p">(</span><span class="n">INT</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span> <span class="n">Token</span><span class="p">(</span><span class="n">INT</span><span class="p">,</span> <span class="mi">159</span><span class="p">)])</span>
</pre></div>
</div>
</section>
<section id="collect-all-comments-with-lexer-callbacks">
<h3>Collect all comments with lexer_callbacks<a class="headerlink" href="#collect-all-comments-with-lexer-callbacks" title="Permalink to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">lexer_callbacks</span></code> can be used to interface with the lexer as it generates tokens.</p>
<p>It accepts a dictionary of the form</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">TOKEN_TYPE</span><span class="p">:</span> <span class="n">callback</span><span class="p">}</span>
</pre></div>
</div>
<p>Where callback is of type <code class="docutils literal notranslate"><span class="pre">f(Token)</span> <span class="pre">-&gt;</span> <span class="pre">Token</span></code></p>
<p>It only works with the basic and contextual lexers.</p>
<p>This has the same effect of using a transformer, but can also process ignored tokens.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span>

<span class="n">comments</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    start: INT*</span>

<span class="s2">    COMMENT: /#.*/</span>

<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common (INT, WS)</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">gnore COMMENT</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">gnore WS</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s2">&quot;lalr&quot;</span><span class="p">,</span> <span class="n">lexer_callbacks</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;COMMENT&#39;</span><span class="p">:</span> <span class="n">comments</span><span class="o">.</span><span class="n">append</span><span class="p">})</span>

<span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">1 2 3  # hello</span>
<span class="s2"># world</span>
<span class="s2">4 5 6</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">comments</span><span class="p">)</span>
</pre></div>
</div>
<p>Prints out:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Token</span><span class="p">(</span><span class="n">COMMENT</span><span class="p">,</span> <span class="s1">&#39;# hello&#39;</span><span class="p">),</span> <span class="n">Token</span><span class="p">(</span><span class="n">COMMENT</span><span class="p">,</span> <span class="s1">&#39;# world&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p><em>Note: We don’t have to return a token, because comments are ignored</em></p>
</section>
<section id="collapseambiguities">
<h3>CollapseAmbiguities<a class="headerlink" href="#collapseambiguities" title="Permalink to this heading"></a></h3>
<p>Parsing ambiguous texts with earley and <code class="docutils literal notranslate"><span class="pre">ambiguity='explicit'</span></code> produces a single tree with <code class="docutils literal notranslate"><span class="pre">_ambig</span></code> nodes to mark where the ambiguity occurred.</p>
<p>However, it’s sometimes more convenient instead to work with a list of all possible unambiguous trees.</p>
<p>Lark provides a utility transformer for that purpose:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span><span class="p">,</span> <span class="n">Tree</span><span class="p">,</span> <span class="n">Transformer</span>
<span class="kn">from</span> <span class="nn">lark.visitors</span> <span class="kn">import</span> <span class="n">CollapseAmbiguities</span>

<span class="n">grammar</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    !start: x y</span>

<span class="s2">    !x: &quot;a&quot; &quot;b&quot;</span>
<span class="s2">      | &quot;ab&quot;</span>
<span class="s2">      | &quot;abc&quot;</span>

<span class="s2">    !y: &quot;c&quot; &quot;d&quot;</span>
<span class="s2">      | &quot;cd&quot;</span>
<span class="s2">      | &quot;d&quot;</span>

<span class="s2">&quot;&quot;&quot;</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">ambiguity</span><span class="o">=</span><span class="s1">&#39;explicit&#39;</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;abcd&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">CollapseAmbiguities</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">pretty</span><span class="p">())</span>
</pre></div>
</div>
<p>This prints out:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">start</span>
<span class="n">x</span>
    <span class="n">a</span>
    <span class="n">b</span>
<span class="n">y</span>
    <span class="n">c</span>
    <span class="n">d</span>

<span class="n">start</span>
<span class="n">x</span>     <span class="n">ab</span>
<span class="n">y</span>     <span class="n">cd</span>

<span class="n">start</span>
<span class="n">x</span>     <span class="n">abc</span>
<span class="n">y</span>     <span class="n">d</span>
</pre></div>
</div>
<p>While convenient, this should be used carefully, as highly ambiguous trees will soon create an exponential explosion of such unambiguous derivations.</p>
</section>
<section id="keeping-track-of-parents-when-visiting">
<h3>Keeping track of parents when visiting<a class="headerlink" href="#keeping-track-of-parents-when-visiting" title="Permalink to this heading"></a></h3>
<p>The following visitor assigns a <code class="docutils literal notranslate"><span class="pre">parent</span></code> attribute for every node in the tree.</p>
<p>If your tree nodes aren’t unique (if there is a shared Tree instance), the assert will fail.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Parent</span><span class="p">(</span><span class="n">Visitor</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__default__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">subtree</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subtree</span><span class="p">,</span> <span class="n">Tree</span><span class="p">):</span>
                <span class="k">assert</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">subtree</span><span class="p">,</span> <span class="s1">&#39;parent&#39;</span><span class="p">)</span>
                <span class="n">subtree</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">proxy</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="unwinding-visiterror-after-a-transformer-visitor-exception">
<h3>Unwinding VisitError after a transformer/visitor exception<a class="headerlink" href="#unwinding-visiterror-after-a-transformer-visitor-exception" title="Permalink to this heading"></a></h3>
<p>Errors that happen inside visitors and transformers get wrapped inside a <code class="docutils literal notranslate"><span class="pre">VisitError</span></code> exception.</p>
<p>This can often be inconvenient, if you wish the actual error to propagate upwards, or if you want to catch it.</p>
<p>But, it’s easy to unwrap it at the point of calling the transformer, by catching it and raising the <code class="docutils literal notranslate"><span class="pre">VisitError.orig_exc</span></code> attribute.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span><span class="p">,</span> <span class="n">Transformer</span>
<span class="kn">from</span> <span class="nn">lark.visitors</span> <span class="kn">import</span> <span class="n">VisitError</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="s1">&#39;start: &quot;a&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">T</span><span class="p">(</span><span class="n">Transformer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Original Exception&quot;</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">T</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="n">t</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">tree</span><span class="p">))</span>
<span class="k">except</span> <span class="n">VisitError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">raise</span> <span class="n">e</span><span class="o">.</span><span class="n">orig_exc</span>
</pre></div>
</div>
</section>
<section id="adding-a-progress-bar-to-parsing-with-tqdm">
<h3>Adding a Progress Bar to Parsing with tqdm<a class="headerlink" href="#adding-a-progress-bar-to-parsing-with-tqdm" title="Permalink to this heading"></a></h3>
<p>Parsing large files can take a long time, even with the <code class="docutils literal notranslate"><span class="pre">parser='lalr'</span></code> option. To make this process more user-friendly, it’s useful to add a progress bar. One way to achieve this is to use the <code class="docutils literal notranslate"><span class="pre">InteractiveParser</span></code> to display each token as it is processed. In this example, we use <a class="reference external" href="https://github.com/tqdm/tqdm">tqdm</a>, but it should be easy to adapt to other kinds of progress bars.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="k">def</span> <span class="nf">parse_with_progress</span><span class="p">(</span><span class="n">parser</span><span class="p">:</span> <span class="n">Lark</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">last</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">progress</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
    <span class="n">pi</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_interactive</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">pi</span><span class="o">.</span><span class="n">iter_parse</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">end_pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">end_pos</span> <span class="o">-</span> <span class="n">last</span><span class="p">)</span>
            <span class="n">last</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">end_pos</span>
    <span class="k">return</span> <span class="n">pi</span><span class="o">.</span><span class="n">resume_parse</span><span class="p">()</span>    <span class="c1"># Finish up and get the result</span>
</pre></div>
</div>
<p>Keep in mind that this implementation relies on the <code class="docutils literal notranslate"><span class="pre">InteractiveParser</span></code> and, therefore, only works with the <code class="docutils literal notranslate"><span class="pre">LALR(1)</span></code> parser, and not <code class="docutils literal notranslate"><span class="pre">Earley</span></code>.</p>
</section>
<section id="parsing-a-language-with-significant-indentation">
<h3>Parsing a Language with Significant Indentation<a class="headerlink" href="#parsing-a-language-with-significant-indentation" title="Permalink to this heading"></a></h3>
<p>If your grammar needs to support significant indentation (e.g. Python, YAML), you will need to use
the <code class="docutils literal notranslate"><span class="pre">Indenter</span></code> class. Take a look at the <a class="reference external" href="examples/indented_tree.html">indented tree example</a> as well as the
<a class="reference external" href="https://github.com/lark-parser/lark/blob/master/lark/grammars/python.lark">Python grammar</a> for inspiration.</p>
</section>
</section>
<span id="document-examples/index"></span><section id="examples-for-lark">
<h2>Examples for Lark<a class="headerlink" href="#examples-for-lark" title="Permalink to this heading"></a></h2>
<p><strong>How to run the examples</strong>:</p>
<p>After cloning the repo, open the terminal into the root directory of the
project, and run the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>lark<span class="o">]</span>$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>examples.&lt;name_of_example&gt;
</pre></div>
</div>
<p>For example, the following will parse all the Python files in the
standard library of your local installation:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>lark<span class="o">]</span>$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>examples.advanced.python_parser
</pre></div>
</div>
<section id="beginner-examples">
<h3>Beginner Examples<a class="headerlink" href="#beginner-examples" title="Permalink to this heading"></a></h3>
<div class="sphx-glr-thumbnails"><div class="sphx-glr-thumbcontainer" tooltip="A demonstration of parsing indentation (“whitespace significant” language) and the usage of the..."><img alt="" src="_images/sphx_glr_indented_tree_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-indented-tree-py"><span class="std std-ref">Parsing Indentation</span></a></p>
  <div class="sphx-glr-thumbnail-title">Parsing Indentation</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="A reference implementation of the Lark grammar (using LALR(1))"><img alt="" src="_images/sphx_glr_lark_grammar_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-lark-grammar-py"><span class="std std-ref">Lark Grammar</span></a></p>
  <div class="sphx-glr-thumbnail-title">Lark Grammar</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="A demonstration of ambiguity"><img alt="" src="_images/sphx_glr_fruitflies_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-fruitflies-py"><span class="std std-ref">Handling Ambiguity</span></a></p>
  <div class="sphx-glr-thumbnail-title">Handling Ambiguity</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="A simple example of a REPL calculator"><img alt="" src="_images/sphx_glr_calc_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-calc-py"><span class="std std-ref">Basic calculator</span></a></p>
  <div class="sphx-glr-thumbnail-title">Basic calculator</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="Implements a LOGO-like toy language for Python’s turtle, with interpreter."><img alt="" src="_images/sphx_glr_turtle_dsl_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-turtle-dsl-py"><span class="std std-ref">Turtle DSL</span></a></p>
  <div class="sphx-glr-thumbnail-title">Turtle DSL</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="The code is short and clear, and outperforms every other parser (that&#x27;s written in Python). For..."><img alt="" src="_images/sphx_glr_json_parser_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-json-parser-py"><span class="std std-ref">Simple JSON Parser</span></a></p>
  <div class="sphx-glr-thumbnail-title">Simple JSON Parser</div>
</div></div><div class="toctree-wrapper compound">
<span id="document-examples/indented_tree"></span><div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-indented-tree-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="parsing-indentation">
<span id="sphx-glr-examples-indented-tree-py"></span><h4>Parsing Indentation<a class="headerlink" href="#parsing-indentation" title="Permalink to this heading"></a></h4>
<p>A demonstration of parsing indentation (“whitespace significant” language)
and the usage of the <code class="docutils literal notranslate"><span class="pre">Indenter</span></code> class.</p>
<p>Since indentation is context-sensitive, a postlex stage is introduced to
manufacture <code class="docutils literal notranslate"><span class="pre">INDENT</span></code>/<code class="docutils literal notranslate"><span class="pre">DEDENT</span></code> tokens.</p>
<p>It is crucial for the indenter that the <code class="docutils literal notranslate"><span class="pre">NL_type</span></code> matches the spaces (and
tabs) after the newline.</p>
<p>If your whitespace-significant grammar supports comments, then <code class="docutils literal notranslate"><span class="pre">NL_type</span></code>
must match those comments too. Otherwise, comments that appear in the middle
of a line will <a class="reference external" href="https://github.com/lark-parser/lark/issues/863">confuse Lark</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span>
<span class="kn">from</span> <span class="nn">lark.indenter</span> <span class="kn">import</span> <span class="n">Indenter</span>

<span class="n">tree_grammar</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common.CNAME -&gt; NAME</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common.WS_INLINE</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common.SH_COMMENT</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">gnore WS_INLINE</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">gnore SH_COMMENT</span>
<span class="s2">    </span><span class="si">%d</span><span class="s2">eclare _INDENT _DEDENT</span>

<span class="s2">    ?start: _NL* tree</span>
<span class="s2">    tree: NAME _NL [_INDENT tree+ _DEDENT]</span>
<span class="s2">    _NL: (/\r?\n[\t ]*/ | SH_COMMENT)+</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">TreeIndenter</span><span class="p">(</span><span class="n">Indenter</span><span class="p">):</span>
    <span class="n">NL_type</span> <span class="o">=</span> <span class="s1">&#39;_NL&#39;</span>
    <span class="n">OPEN_PAREN_types</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">CLOSE_PAREN_types</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">INDENT_type</span> <span class="o">=</span> <span class="s1">&#39;_INDENT&#39;</span>
    <span class="n">DEDENT_type</span> <span class="o">=</span> <span class="s1">&#39;_DEDENT&#39;</span>
    <span class="n">tab_len</span> <span class="o">=</span> <span class="mi">8</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="n">tree_grammar</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s1">&#39;lalr&#39;</span><span class="p">,</span> <span class="n">postlex</span><span class="o">=</span><span class="n">TreeIndenter</span><span class="p">())</span>

<span class="n">test_tree</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">a</span>
<span class="s2">    # check this comment out</span>
<span class="s2">    b</span>
<span class="s2">    c</span>
<span class="s2">        d</span>
<span class="s2">        e</span>
<span class="s2">    f</span>
<span class="s2">        g</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">test_tree</span><span class="p">)</span><span class="o">.</span><span class="n">pretty</span><span class="p">())</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">test</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-indented-tree-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/7cc2abf4fecd3796ed4ad6d455bda349/indented_tree.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">indented_tree.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/4b6a9b4fb62278f5d7a70e5b2900ff58/indented_tree.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">indented_tree.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
<span id="document-examples/lark_grammar"></span><div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-lark-grammar-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="lark-grammar">
<span id="sphx-glr-examples-lark-grammar-py"></span><h4>Lark Grammar<a class="headerlink" href="#lark-grammar" title="Permalink to this heading"></a></h4>
<p>A reference implementation of the Lark grammar (using LALR(1))</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">lark</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="n">examples_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
<span class="n">lark_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">lark</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">lark</span><span class="o">.</span><span class="n">Lark</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">lark_path</span> <span class="o">/</span> <span class="s1">&#39;grammars/lark.lark&#39;</span><span class="p">,</span> <span class="n">rel_to</span><span class="o">=</span><span class="vm">__file__</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s2">&quot;lalr&quot;</span><span class="p">)</span>


<span class="n">grammar_files</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">examples_path</span> <span class="o">/</span> <span class="s1">&#39;advanced/python2.lark&#39;</span><span class="p">,</span>
    <span class="n">examples_path</span> <span class="o">/</span> <span class="s1">&#39;relative-imports/multiples.lark&#39;</span><span class="p">,</span>
    <span class="n">examples_path</span> <span class="o">/</span> <span class="s1">&#39;relative-imports/multiple2.lark&#39;</span><span class="p">,</span>
    <span class="n">examples_path</span> <span class="o">/</span> <span class="s1">&#39;relative-imports/multiple3.lark&#39;</span><span class="p">,</span>
    <span class="n">examples_path</span> <span class="o">/</span> <span class="s1">&#39;tests/no_newline_at_end.lark&#39;</span><span class="p">,</span>
    <span class="n">examples_path</span> <span class="o">/</span> <span class="s1">&#39;tests/negative_priority.lark&#39;</span><span class="p">,</span>
    <span class="n">examples_path</span> <span class="o">/</span> <span class="s1">&#39;standalone/json.lark&#39;</span><span class="p">,</span>
    <span class="n">lark_path</span> <span class="o">/</span> <span class="s1">&#39;grammars/common.lark&#39;</span><span class="p">,</span>
    <span class="n">lark_path</span> <span class="o">/</span> <span class="s1">&#39;grammars/lark.lark&#39;</span><span class="p">,</span>
    <span class="n">lark_path</span> <span class="o">/</span> <span class="s1">&#39;grammars/unicode.lark&#39;</span><span class="p">,</span>
    <span class="n">lark_path</span> <span class="o">/</span> <span class="s1">&#39;grammars/python.lark&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">grammar_file</span> <span class="ow">in</span> <span class="n">grammar_files</span><span class="p">:</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">grammar_file</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All grammars parsed successfully&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">test</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-lark-grammar-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/b9abd703bb1b061d8ae5f6ab1b9393e8/lark_grammar.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">lark_grammar.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/2f68c21f7729a47e57d3ae345753e407/lark_grammar.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">lark_grammar.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
<span id="document-examples/fruitflies"></span><div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-fruitflies-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="handling-ambiguity">
<span id="sphx-glr-examples-fruitflies-py"></span><h4>Handling Ambiguity<a class="headerlink" href="#handling-ambiguity" title="Permalink to this heading"></a></h4>
<p>A demonstration of ambiguity</p>
<p>This example shows how to use get explicit ambiguity from Lark’s Earley parser.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span><span class="p">,</span> <span class="n">tree</span>

<span class="n">grammar</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    sentence: noun verb noun        -&gt; simple</span>
<span class="s2">            | noun verb &quot;like&quot; noun -&gt; comparative</span>

<span class="s2">    noun: adj? NOUN</span>
<span class="s2">    verb: VERB</span>
<span class="s2">    adj: ADJ</span>

<span class="s2">    NOUN: &quot;flies&quot; | &quot;bananas&quot; | &quot;fruit&quot;</span>
<span class="s2">    VERB: &quot;like&quot; | &quot;flies&quot;</span>
<span class="s2">    ADJ: &quot;fruit&quot;</span>

<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common.WS</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">gnore WS</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s1">&#39;sentence&#39;</span><span class="p">,</span> <span class="n">ambiguity</span><span class="o">=</span><span class="s1">&#39;explicit&#39;</span><span class="p">)</span>

<span class="n">sentence</span> <span class="o">=</span> <span class="s1">&#39;fruit flies like bananas&#39;</span>

<span class="k">def</span> <span class="nf">make_png</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">tree</span><span class="o">.</span><span class="n">pydot__tree_to_png</span><span class="p">(</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">sentence</span><span class="p">),</span> <span class="n">filename</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">make_dot</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">tree</span><span class="o">.</span><span class="n">pydot__tree_to_dot</span><span class="p">(</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">sentence</span><span class="p">),</span> <span class="n">filename</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span><span class="o">.</span><span class="n">pretty</span><span class="p">())</span>
    <span class="c1"># make_png(sys.argv[1])</span>
    <span class="c1"># make_dot(sys.argv[1])</span>

<span class="c1"># Output:</span>
<span class="c1">#</span>
<span class="c1"># _ambig</span>
<span class="c1">#   comparative</span>
<span class="c1">#     noun  fruit</span>
<span class="c1">#     verb  flies</span>
<span class="c1">#     noun  bananas</span>
<span class="c1">#   simple</span>
<span class="c1">#     noun</span>
<span class="c1">#       fruit</span>
<span class="c1">#       flies</span>
<span class="c1">#     verb  like</span>
<span class="c1">#     noun  bananas</span>
<span class="c1">#</span>
<span class="c1"># (or view a nicer version at &quot;./fruitflies.png&quot;)</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-fruitflies-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/b0239cee17ba033b2ccfffe66491b86e/fruitflies.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">fruitflies.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/9ebc86868010e2fc400ecf1ef8a5aa4a/fruitflies.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">fruitflies.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
<span id="document-examples/calc"></span><div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-calc-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="basic-calculator">
<span id="sphx-glr-examples-calc-py"></span><h4>Basic calculator<a class="headerlink" href="#basic-calculator" title="Permalink to this heading"></a></h4>
<p>A simple example of a REPL calculator</p>
<p>This example shows how to write a basic calculator with variables.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span><span class="p">,</span> <span class="n">Transformer</span><span class="p">,</span> <span class="n">v_args</span>


<span class="k">try</span><span class="p">:</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">raw_input</span>   <span class="c1"># For Python2 compatibility</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="k">pass</span>


<span class="n">calc_grammar</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    ?start: sum</span>
<span class="s2">          | NAME &quot;=&quot; sum    -&gt; assign_var</span>

<span class="s2">    ?sum: product</span>
<span class="s2">        | sum &quot;+&quot; product   -&gt; add</span>
<span class="s2">        | sum &quot;-&quot; product   -&gt; sub</span>

<span class="s2">    ?product: atom</span>
<span class="s2">        | product &quot;*&quot; atom  -&gt; mul</span>
<span class="s2">        | product &quot;/&quot; atom  -&gt; div</span>

<span class="s2">    ?atom: NUMBER           -&gt; number</span>
<span class="s2">         | &quot;-&quot; atom         -&gt; neg</span>
<span class="s2">         | NAME             -&gt; var</span>
<span class="s2">         | &quot;(&quot; sum &quot;)&quot;</span>

<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common.CNAME -&gt; NAME</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common.NUMBER</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common.WS_INLINE</span>

<span class="s2">    </span><span class="si">%i</span><span class="s2">gnore WS_INLINE</span>
<span class="s2">&quot;&quot;&quot;</span>


<span class="nd">@v_args</span><span class="p">(</span><span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>    <span class="c1"># Affects the signatures of the methods</span>
<span class="k">class</span> <span class="nc">CalculateTree</span><span class="p">(</span><span class="n">Transformer</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">add</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">mul</span><span class="p">,</span> <span class="n">truediv</span> <span class="k">as</span> <span class="n">div</span><span class="p">,</span> <span class="n">neg</span>
    <span class="n">number</span> <span class="o">=</span> <span class="nb">float</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">assign_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Variable not found: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>


<span class="n">calc_parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="n">calc_grammar</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s1">&#39;lalr&#39;</span><span class="p">,</span> <span class="n">transformer</span><span class="o">=</span><span class="n">CalculateTree</span><span class="p">())</span>
<span class="n">calc</span> <span class="o">=</span> <span class="n">calc_parser</span><span class="o">.</span><span class="n">parse</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;&gt; &#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">calc</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">calc</span><span class="p">(</span><span class="s2">&quot;a = 1+2&quot;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">calc</span><span class="p">(</span><span class="s2">&quot;1+a*-3&quot;</span><span class="p">))</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># test()</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-calc-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/50b59008a60a728670b293084a6fe042/calc.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">calc.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/63680f346bf793a45964b4e687bde3d9/calc.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">calc.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
<span id="document-examples/turtle_dsl"></span><div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-turtle-dsl-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="turtle-dsl">
<span id="sphx-glr-examples-turtle-dsl-py"></span><h4>Turtle DSL<a class="headerlink" href="#turtle-dsl" title="Permalink to this heading"></a></h4>
<p>Implements a LOGO-like toy language for Python’s turtle, with interpreter.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">raw_input</span>   <span class="c1"># For Python2 compatibility</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="kn">import</span> <span class="nn">turtle</span>

<span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span>

<span class="n">turtle_grammar</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    start: instruction+</span>

<span class="s2">    instruction: MOVEMENT NUMBER            -&gt; movement</span>
<span class="s2">               | &quot;c&quot; COLOR [COLOR]          -&gt; change_color</span>
<span class="s2">               | &quot;fill&quot; code_block          -&gt; fill</span>
<span class="s2">               | &quot;repeat&quot; NUMBER code_block -&gt; repeat</span>

<span class="s2">    code_block: &quot;{&quot; instruction+ &quot;}&quot;</span>

<span class="s2">    MOVEMENT: &quot;f&quot;|&quot;b&quot;|&quot;l&quot;|&quot;r&quot;</span>
<span class="s2">    COLOR: LETTER+</span>

<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common.LETTER</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common.INT -&gt; NUMBER</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common.WS</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">gnore WS</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="n">turtle_grammar</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">run_instruction</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s1">&#39;change_color&#39;</span><span class="p">:</span>
        <span class="n">turtle</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="o">*</span><span class="n">t</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>   <span class="c1"># We just pass the color names as-is</span>

    <span class="k">elif</span> <span class="n">t</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s1">&#39;movement&#39;</span><span class="p">:</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">number</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">children</span>
        <span class="p">{</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="n">turtle</span><span class="o">.</span><span class="n">fd</span><span class="p">,</span>
          <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">turtle</span><span class="o">.</span><span class="n">bk</span><span class="p">,</span>
          <span class="s1">&#39;l&#39;</span><span class="p">:</span> <span class="n">turtle</span><span class="o">.</span><span class="n">lt</span><span class="p">,</span>
          <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="n">turtle</span><span class="o">.</span><span class="n">rt</span><span class="p">,</span> <span class="p">}[</span><span class="n">name</span><span class="p">](</span><span class="nb">int</span><span class="p">(</span><span class="n">number</span><span class="p">))</span>

    <span class="k">elif</span> <span class="n">t</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s1">&#39;repeat&#39;</span><span class="p">:</span>
        <span class="n">count</span><span class="p">,</span> <span class="n">block</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">children</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">count</span><span class="p">)):</span>
            <span class="n">run_instruction</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">t</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s1">&#39;fill&#39;</span><span class="p">:</span>
        <span class="n">turtle</span><span class="o">.</span><span class="n">begin_fill</span><span class="p">()</span>
        <span class="n">run_instruction</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">turtle</span><span class="o">.</span><span class="n">end_fill</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">t</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s1">&#39;code_block&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">run_instruction</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s1">&#39;Unknown instruction: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">t</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">run_turtle</span><span class="p">(</span><span class="n">program</span><span class="p">):</span>
    <span class="n">parse_tree</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">program</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">parse_tree</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
        <span class="n">run_instruction</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">code</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;&gt; &#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">run_turtle</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        c red yellow</span>
<span class="s2">        fill { repeat 36 {</span>
<span class="s2">            f200 l170</span>
<span class="s2">        }}</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">run_turtle</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># test()</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-turtle-dsl-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/9cadc23f6b1e9e52f35d3cb0a28053b0/turtle_dsl.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">turtle_dsl.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/207f80f4ec59e1e363837373665f649f/turtle_dsl.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">turtle_dsl.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
<span id="document-examples/json_parser"></span><div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-json-parser-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="simple-json-parser">
<span id="sphx-glr-examples-json-parser-py"></span><h4>Simple JSON Parser<a class="headerlink" href="#simple-json-parser" title="Permalink to this heading"></a></h4>
<p>The code is short and clear, and outperforms every other parser (that’s written in Python).
For an explanation, check out the JSON parser tutorial at /docs/json_tutorial.md</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span><span class="p">,</span> <span class="n">Transformer</span><span class="p">,</span> <span class="n">v_args</span>

<span class="n">json_grammar</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    ?start: value</span>

<span class="s2">    ?value: object</span>
<span class="s2">          | array</span>
<span class="s2">          | string</span>
<span class="s2">          | SIGNED_NUMBER      -&gt; number</span>
<span class="s2">          | &quot;true&quot;             -&gt; true</span>
<span class="s2">          | &quot;false&quot;            -&gt; false</span>
<span class="s2">          | &quot;null&quot;             -&gt; null</span>

<span class="s2">    array  : &quot;[&quot; [value (&quot;,&quot; value)*] &quot;]&quot;</span>
<span class="s2">    object : &quot;{&quot; [pair (&quot;,&quot; pair)*] &quot;}&quot;</span>
<span class="s2">    pair   : string &quot;:&quot; value</span>

<span class="s2">    string : ESCAPED_STRING</span>

<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common.ESCAPED_STRING</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common.SIGNED_NUMBER</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common.WS</span>

<span class="s2">    </span><span class="si">%i</span><span class="s2">gnore WS</span>
<span class="s2">&quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">TreeToJson</span><span class="p">(</span><span class="n">Transformer</span><span class="p">):</span>
    <span class="nd">@v_args</span><span class="p">(</span><span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>

    <span class="n">array</span> <span class="o">=</span> <span class="nb">list</span>
    <span class="n">pair</span> <span class="o">=</span> <span class="nb">tuple</span>
    <span class="nb">object</span> <span class="o">=</span> <span class="nb">dict</span>
    <span class="n">number</span> <span class="o">=</span> <span class="n">v_args</span><span class="p">(</span><span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">null</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="kc">None</span>
    <span class="n">true</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="kc">True</span>
    <span class="n">false</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="kc">False</span>


<span class="c1">### Create the JSON parser with Lark, using the Earley algorithm</span>
<span class="c1"># json_parser = Lark(json_grammar, parser=&#39;earley&#39;, lexer=&#39;basic&#39;)</span>
<span class="c1"># def parse(x):</span>
<span class="c1">#     return TreeToJson().transform(json_parser.parse(x))</span>

<span class="c1">### Create the JSON parser with Lark, using the LALR algorithm</span>
<span class="n">json_parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="n">json_grammar</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s1">&#39;lalr&#39;</span><span class="p">,</span>
                   <span class="c1"># Using the basic lexer isn&#39;t required, and isn&#39;t usually recommended.</span>
                   <span class="c1"># But, it&#39;s good enough for JSON, and it&#39;s slightly faster.</span>
                   <span class="n">lexer</span><span class="o">=</span><span class="s1">&#39;basic&#39;</span><span class="p">,</span>
                   <span class="c1"># Disabling propagate_positions and placeholders slightly improves speed</span>
                   <span class="n">propagate_positions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">maybe_placeholders</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="c1"># Using an internal transformer is faster and more memory efficient</span>
                   <span class="n">transformer</span><span class="o">=</span><span class="n">TreeToJson</span><span class="p">())</span>
<span class="n">parse</span> <span class="o">=</span> <span class="n">json_parser</span><span class="o">.</span><span class="n">parse</span>


<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="n">test_json</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        {</span>
<span class="s1">            &quot;empty_object&quot; : </span><span class="si">{}</span><span class="s1">,</span>
<span class="s1">            &quot;empty_array&quot;  : [],</span>
<span class="s1">            &quot;booleans&quot;     : { &quot;YES&quot; : true, &quot;NO&quot; : false },</span>
<span class="s1">            &quot;numbers&quot;      : [ 0, 1, -2, 3.3, 4.4e5, 6.6e-7 ],</span>
<span class="s1">            &quot;strings&quot;      : [ &quot;This&quot;, [ &quot;And&quot; , &quot;That&quot;, &quot;And a </span><span class="se">\\</span><span class="s1">&quot;b&quot; ] ],</span>
<span class="s1">            &quot;nothing&quot;      : null</span>
<span class="s1">        }</span>
<span class="s1">    &#39;&#39;&#39;</span>

    <span class="n">j</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">test_json</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">json</span>
    <span class="k">assert</span> <span class="n">j</span> <span class="o">==</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">test_json</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># test()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">parse</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-json-parser-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/9897e3d2b4b242b1ded5769f50c0eea1/json_parser.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">json_parser.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/179842700c93c6cca88ed33e1b99eb9c/json_parser.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">json_parser.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</div>
</section>
<section id="advanced-examples">
<h3>Advanced Examples<a class="headerlink" href="#advanced-examples" title="Permalink to this heading"></a></h3>
<div class="sphx-glr-thumbnails"><div class="sphx-glr-thumbcontainer" tooltip="This example demonstrates the power of LALR&#x27;s contextual lexer, by parsing a toy configuration ..."><img alt="" src="_images/sphx_glr_conf_lalr_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-conf-lalr-py"><span class="std std-ref">LALR’s contextual lexer</span></a></p>
  <div class="sphx-glr-thumbnail-title">LALR’s contextual lexer</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="This example shows how to use Lark&#x27;s templates to achieve cleaner grammars"><img alt="" src="_images/sphx_glr_templates_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-templates-py"><span class="std std-ref">Templates</span></a></p>
  <div class="sphx-glr-thumbnail-title">Templates</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="Demonstrates the power of Earley’s dynamic lexer on a toy configuration language"><img alt="" src="_images/sphx_glr_conf_earley_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-conf-earley-py"><span class="std std-ref">Earley’s dynamic lexer</span></a></p>
  <div class="sphx-glr-thumbnail-title">Earley’s dynamic lexer</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="This example demonstrates error handling using an interactive parser in LALR"><img alt="" src="_images/sphx_glr_error_handling_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-error-handling-py"><span class="std std-ref">Error handling using an interactive parser</span></a></p>
  <div class="sphx-glr-thumbnail-title">Error handling using an interactive parser</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="Demonstrates the experimental text-reconstruction feature"><img alt="" src="_images/sphx_glr_reconstruct_json_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-reconstruct-json-py"><span class="std std-ref">Reconstruct a JSON</span></a></p>
  <div class="sphx-glr-thumbnail-title">Reconstruct a JSON</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="Demonstrates using a custom lexer to parse a non-textual stream of data"><img alt="" src="_images/sphx_glr_custom_lexer_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-custom-lexer-py"><span class="std std-ref">Custom lexer</span></a></p>
  <div class="sphx-glr-thumbnail-title">Custom lexer</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="This example demonstrates how to subclass TreeForestTransformer to directly transform a SPPF."><img alt="" src="_images/sphx_glr_tree_forest_transformer_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-tree-forest-transformer-py"><span class="std std-ref">Transform a Forest</span></a></p>
  <div class="sphx-glr-thumbnail-title">Transform a Forest</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="The code is short and clear, and outperforms every other parser (that&#x27;s written in Python). For..."><img alt="" src="_images/sphx_glr__json_parser_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-json-parser-py"><span class="std std-ref">Simple JSON Parser</span></a></p>
  <div class="sphx-glr-thumbnail-title">Simple JSON Parser</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="This example demonstrates how to subclass ForestVisitor to make a custom SPPF node prioritizer ..."><img alt="" src="_images/sphx_glr_prioritizer_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-prioritizer-py"><span class="std std-ref">Custom SPPF Prioritizer</span></a></p>
  <div class="sphx-glr-thumbnail-title">Custom SPPF Prioritizer</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="This example demonstrates how to translate between two trees using tree templates. It parses Py..."><img alt="" src="_images/sphx_glr_py3to2_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-py3to2-py"><span class="std std-ref">Python 3 to Python 2 converter (tree templates)</span></a></p>
  <div class="sphx-glr-thumbnail-title">Python 3 to Python 2 converter (tree templates)</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="A fully-working Python 2 &amp; 3 parser (but not production ready yet!)"><img alt="" src="_images/sphx_glr_python_parser_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-python-parser-py"><span class="std std-ref">Grammar-complete Python Parser</span></a></p>
  <div class="sphx-glr-thumbnail-title">Grammar-complete Python Parser</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="    This example demonstrates how to transform a parse-tree into an AST using lark.ast_utils."><img alt="" src="_images/sphx_glr_create_ast_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-create-ast-py"><span class="std std-ref">Creating an AST from the parse tree</span></a></p>
  <div class="sphx-glr-thumbnail-title">Creating an AST from the parse tree</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="A demonstration of example-driven error reporting with the Earley parser (See also: error_repor..."><img alt="" src="_images/sphx_glr_error_reporting_earley_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-error-reporting-earley-py"><span class="std std-ref">Example-Driven Error Reporting</span></a></p>
  <div class="sphx-glr-thumbnail-title">Example-Driven Error Reporting</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="A demonstration of example-driven error reporting with the LALR parser (See also: error_reporti..."><img alt="" src="_images/sphx_glr_error_reporting_lalr_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-error-reporting-lalr-py"><span class="std std-ref">Example-Driven Error Reporting</span></a></p>
  <div class="sphx-glr-thumbnail-title">Example-Driven Error Reporting</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="Demonstrates how Lark&#x27;s experimental text-reconstruction feature can recreate functional Python..."><img alt="" src="_images/sphx_glr_reconstruct_python_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-reconstruct-python-py"><span class="std std-ref">Reconstruct Python</span></a></p>
  <div class="sphx-glr-thumbnail-title">Reconstruct Python</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="Demonstrates how to use lexer=&#x27;dynamic_complete&#x27; and ambiguity=&#x27;explicit&#x27;"><img alt="" src="_images/sphx_glr_dynamic_complete_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-dynamic-complete-py"><span class="std std-ref">Using lexer dynamic_complete</span></a></p>
  <div class="sphx-glr-thumbnail-title">Using lexer dynamic_complete</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="This example shows how to write a syntax-highlighted editor with Qt and Lark"><img alt="" src="_images/sphx_glr_qscintilla_json_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-qscintilla-json-py"><span class="std std-ref">Syntax Highlighting</span></a></p>
  <div class="sphx-glr-thumbnail-title">Syntax Highlighting</div>
</div></div></section>
</section>
<section id="grammar-composition">
<h2>Grammar Composition<a class="headerlink" href="#grammar-composition" title="Permalink to this heading"></a></h2>
<p>This example shows how to do grammar composition in Lark, by creating a new
file format that allows both CSV and JSON to co-exist.</p>
<p>We show how, by using namespaces, Lark grammars and their transformers can be fully reused -
they don’t need to care if their grammar is used directly, or being imported, or who is doing the importing.</p>
<p>See <a class="reference external" href="https://github.com/lark-parser/lark/blob/master/examples/composition/main.py">main.py</a> for more details.</p>
<div class="sphx-glr-thumbnails"><div class="sphx-glr-thumbcontainer" tooltip="Transformer for evaluating json.lark"><img alt="" src="_images/sphx_glr_eval_json_thumb.png" />
<p><span class="xref std std-ref">sphx_glr_examples_composition_eval_json.py</span></p>
  <div class="sphx-glr-thumbnail-title">Transformer for evaluating json.lark</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="Transformer for evaluating csv.lark"><img alt="" src="_images/sphx_glr_eval_csv_thumb.png" />
<p><span class="xref std std-ref">sphx_glr_examples_composition_eval_csv.py</span></p>
  <div class="sphx-glr-thumbnail-title">Transformer for evaluating csv.lark</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="This example shows how to do grammar composition in Lark, by creating a new file format that al..."><img alt="" src="_images/sphx_glr_main_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-composition-main-py"><span class="std std-ref">Grammar Composition</span></a></p>
  <div class="sphx-glr-thumbnail-title">Grammar Composition</div>
</div></div></section>
<section id="example-grammars">
<h2>Example Grammars<a class="headerlink" href="#example-grammars" title="Permalink to this heading"></a></h2>
<p>This directory is a collection of lark grammars, taken from real world projects.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/lark-parser/lark/blob/master/examples/grammars/verilog.lark">Verilog</a> - Taken from <a class="reference external" href="https://github.com/circuitgraph/circuitgraph/blob/main/circuitgraph/parsing/verilog.lark">https://github.com/circuitgraph/circuitgraph/blob/main/circuitgraph/parsing/verilog.lark</a></p></li>
</ul>
<div class="sphx-glr-thumbnails"></div></section>
<section id="standalone-example">
<h2>Standalone example<a class="headerlink" href="#standalone-example" title="Permalink to this heading"></a></h2>
<p>To initialize, cd to this folder, and run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./create_standalone.sh
</pre></div>
</div>
<p>Or:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>lark.tools.standalone<span class="w"> </span>json.lark<span class="w"> </span>&gt;<span class="w"> </span>json_parser.py
</pre></div>
</div>
<p>Then run using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>json_parser_main.py<span class="w"> </span>&lt;path-to.json&gt;
</pre></div>
</div>
<div class="sphx-glr-thumbnails"><div class="sphx-glr-thumbcontainer" tooltip="    This example demonstrates how to generate and use the standalone parser,     using the JSON..."><img alt="" src="_images/sphx_glr_json_parser_main_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-standalone-json-parser-main-py"><span class="std std-ref">Standalone Parser</span></a></p>
  <div class="sphx-glr-thumbnail-title">Standalone Parser</div>
</div></div><div class="toctree-wrapper compound">
<span id="document-examples/advanced/index"></span><section id="advanced-examples">
<span id="sphx-glr-examples-advanced"></span><h3>Advanced Examples<a class="headerlink" href="#advanced-examples" title="Permalink to this heading"></a></h3>
<div class="sphx-glr-thumbnails"><div class="sphx-glr-thumbcontainer" tooltip="This example demonstrates the power of LALR&#x27;s contextual lexer, by parsing a toy configuration ..."><img alt="" src="_images/sphx_glr_conf_lalr_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-conf-lalr-py"><span class="std std-ref">LALR’s contextual lexer</span></a></p>
  <div class="sphx-glr-thumbnail-title">LALR’s contextual lexer</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="This example shows how to use Lark&#x27;s templates to achieve cleaner grammars"><img alt="" src="_images/sphx_glr_templates_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-templates-py"><span class="std std-ref">Templates</span></a></p>
  <div class="sphx-glr-thumbnail-title">Templates</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="Demonstrates the power of Earley’s dynamic lexer on a toy configuration language"><img alt="" src="_images/sphx_glr_conf_earley_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-conf-earley-py"><span class="std std-ref">Earley’s dynamic lexer</span></a></p>
  <div class="sphx-glr-thumbnail-title">Earley’s dynamic lexer</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="This example demonstrates error handling using an interactive parser in LALR"><img alt="" src="_images/sphx_glr_error_handling_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-error-handling-py"><span class="std std-ref">Error handling using an interactive parser</span></a></p>
  <div class="sphx-glr-thumbnail-title">Error handling using an interactive parser</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="Demonstrates the experimental text-reconstruction feature"><img alt="" src="_images/sphx_glr_reconstruct_json_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-reconstruct-json-py"><span class="std std-ref">Reconstruct a JSON</span></a></p>
  <div class="sphx-glr-thumbnail-title">Reconstruct a JSON</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="Demonstrates using a custom lexer to parse a non-textual stream of data"><img alt="" src="_images/sphx_glr_custom_lexer_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-custom-lexer-py"><span class="std std-ref">Custom lexer</span></a></p>
  <div class="sphx-glr-thumbnail-title">Custom lexer</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="This example demonstrates how to subclass TreeForestTransformer to directly transform a SPPF."><img alt="" src="_images/sphx_glr_tree_forest_transformer_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-tree-forest-transformer-py"><span class="std std-ref">Transform a Forest</span></a></p>
  <div class="sphx-glr-thumbnail-title">Transform a Forest</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="The code is short and clear, and outperforms every other parser (that&#x27;s written in Python). For..."><img alt="" src="_images/sphx_glr__json_parser_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-json-parser-py"><span class="std std-ref">Simple JSON Parser</span></a></p>
  <div class="sphx-glr-thumbnail-title">Simple JSON Parser</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="This example demonstrates how to subclass ForestVisitor to make a custom SPPF node prioritizer ..."><img alt="" src="_images/sphx_glr_prioritizer_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-prioritizer-py"><span class="std std-ref">Custom SPPF Prioritizer</span></a></p>
  <div class="sphx-glr-thumbnail-title">Custom SPPF Prioritizer</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="This example demonstrates how to translate between two trees using tree templates. It parses Py..."><img alt="" src="_images/sphx_glr_py3to2_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-py3to2-py"><span class="std std-ref">Python 3 to Python 2 converter (tree templates)</span></a></p>
  <div class="sphx-glr-thumbnail-title">Python 3 to Python 2 converter (tree templates)</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="A fully-working Python 2 &amp; 3 parser (but not production ready yet!)"><img alt="" src="_images/sphx_glr_python_parser_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-python-parser-py"><span class="std std-ref">Grammar-complete Python Parser</span></a></p>
  <div class="sphx-glr-thumbnail-title">Grammar-complete Python Parser</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="    This example demonstrates how to transform a parse-tree into an AST using lark.ast_utils."><img alt="" src="_images/sphx_glr_create_ast_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-create-ast-py"><span class="std std-ref">Creating an AST from the parse tree</span></a></p>
  <div class="sphx-glr-thumbnail-title">Creating an AST from the parse tree</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="A demonstration of example-driven error reporting with the Earley parser (See also: error_repor..."><img alt="" src="_images/sphx_glr_error_reporting_earley_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-error-reporting-earley-py"><span class="std std-ref">Example-Driven Error Reporting</span></a></p>
  <div class="sphx-glr-thumbnail-title">Example-Driven Error Reporting</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="A demonstration of example-driven error reporting with the LALR parser (See also: error_reporti..."><img alt="" src="_images/sphx_glr_error_reporting_lalr_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-error-reporting-lalr-py"><span class="std std-ref">Example-Driven Error Reporting</span></a></p>
  <div class="sphx-glr-thumbnail-title">Example-Driven Error Reporting</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="Demonstrates how Lark&#x27;s experimental text-reconstruction feature can recreate functional Python..."><img alt="" src="_images/sphx_glr_reconstruct_python_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-reconstruct-python-py"><span class="std std-ref">Reconstruct Python</span></a></p>
  <div class="sphx-glr-thumbnail-title">Reconstruct Python</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="Demonstrates how to use lexer=&#x27;dynamic_complete&#x27; and ambiguity=&#x27;explicit&#x27;"><img alt="" src="_images/sphx_glr_dynamic_complete_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-dynamic-complete-py"><span class="std std-ref">Using lexer dynamic_complete</span></a></p>
  <div class="sphx-glr-thumbnail-title">Using lexer dynamic_complete</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="This example shows how to write a syntax-highlighted editor with Qt and Lark"><img alt="" src="_images/sphx_glr_qscintilla_json_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-advanced-qscintilla-json-py"><span class="std std-ref">Syntax Highlighting</span></a></p>
  <div class="sphx-glr-thumbnail-title">Syntax Highlighting</div>
</div></div><div class="toctree-wrapper compound">
<span id="document-examples/advanced/conf_lalr"></span><div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-advanced-conf-lalr-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="lalrs-contextual-lexer">
<span id="sphx-glr-examples-advanced-conf-lalr-py"></span><h4>LALR’s contextual lexer<a class="headerlink" href="#lalrs-contextual-lexer" title="Permalink to this heading"></a></h4>
<p>This example demonstrates the power of LALR’s contextual lexer,
by parsing a toy configuration language.</p>
<p>The terminals <cite>NAME</cite> and <cite>VALUE</cite> overlap. They can match the same input.
A basic lexer would arbitrarily choose one over the other, based on priority,
which would lead to a (confusing) parse error.
However, due to the unambiguous structure of the grammar, Lark’s LALR(1) algorithm knows
which one of them to expect at each point during the parse.
The lexer then only matches the tokens that the parser expects.
The result is a correct parse, something that is impossible with a regular lexer.</p>
<p>Another approach is to use the Earley algorithm.
It will handle more cases than the contextual lexer, but at the cost of performance.
See examples/conf_earley.py for an example of that approach.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        start: _NL? section+</span>
<span class="s2">        section: &quot;[&quot; NAME &quot;]&quot; _NL item+</span>
<span class="s2">        item: NAME &quot;=&quot; VALUE? _NL</span>

<span class="s2">        NAME: /\w/+</span>
<span class="s2">        VALUE: /./+</span>

<span class="s2">        </span><span class="si">%i</span><span class="s2">mport common.NEWLINE -&gt; _NL</span>
<span class="s2">        </span><span class="si">%i</span><span class="s2">mport common.WS_INLINE</span>
<span class="s2">        </span><span class="si">%i</span><span class="s2">gnore WS_INLINE</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s2">&quot;lalr&quot;</span><span class="p">)</span>


<span class="n">sample_conf</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">[bla]</span>
<span class="s2">a=Hello</span>
<span class="s2">this=&quot;that&quot;,4</span>
<span class="s2">empty=</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">sample_conf</span><span class="p">)</span><span class="o">.</span><span class="n">pretty</span><span class="p">())</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-advanced-conf-lalr-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/3ed7cc698fc366fe253eac6ecf76ee3e/conf_lalr.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">conf_lalr.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/9e5ca2d2f34acae5a9391bd4b16a935f/conf_lalr.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">conf_lalr.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
<span id="document-examples/advanced/templates"></span><div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-advanced-templates-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="templates">
<span id="sphx-glr-examples-advanced-templates-py"></span><h4>Templates<a class="headerlink" href="#templates" title="Permalink to this heading"></a></h4>
<p>This example shows how to use Lark’s templates to achieve cleaner grammars</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span>

<span class="n">grammar</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">start: list | dict</span>

<span class="s2">list: &quot;[&quot; _seperated{atom, &quot;,&quot;} &quot;]&quot;</span>
<span class="s2">dict: &quot;{&quot; _seperated{key_value, &quot;,&quot;} &quot;}&quot;</span>
<span class="s2">key_value: atom &quot;:&quot; atom</span>

<span class="s2">_seperated{x, sep}: x (sep x)*  // Define a sequence of &#39;x sep x sep x ...&#39;</span>

<span class="s2">atom: NUMBER | ESCAPED_STRING</span>

<span class="si">%i</span><span class="s2">mport common (NUMBER, ESCAPED_STRING, WS)</span>
<span class="si">%i</span><span class="s2">gnore WS</span>
<span class="s2">&quot;&quot;&quot;</span>


<span class="n">parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="n">grammar</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;[1, &quot;a&quot;, 2]&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;{&quot;a&quot;: 2, &quot;b&quot;: 6}&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-advanced-templates-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/d3b43c711b7f9a6aeee99f79cf861539/templates.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">templates.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/6619e43bab1bed7430fa709940e67aa2/templates.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">templates.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
<span id="document-examples/advanced/conf_earley"></span><div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-advanced-conf-earley-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="earleys-dynamic-lexer">
<span id="sphx-glr-examples-advanced-conf-earley-py"></span><h4>Earley’s dynamic lexer<a class="headerlink" href="#earleys-dynamic-lexer" title="Permalink to this heading"></a></h4>
<p>Demonstrates the power of Earley’s dynamic lexer on a toy configuration language</p>
<p>Using a lexer for configuration files is tricky, because values don’t
have to be surrounded by delimiters. Using a basic lexer for this just won’t work.</p>
<p>In this example we use a dynamic lexer and let the Earley parser resolve the ambiguity.</p>
<p>Another approach is to use the contextual lexer with LALR. It is less powerful than Earley,
but it can handle some ambiguity when lexing and it’s much faster.
See examples/conf_lalr.py for an example of that approach.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        start: _NL? section+</span>
<span class="s2">        section: &quot;[&quot; NAME &quot;]&quot; _NL item+</span>
<span class="s2">        item: NAME &quot;=&quot; VALUE? _NL</span>

<span class="s2">        NAME: /\w/+</span>
<span class="s2">        VALUE: /./+</span>

<span class="s2">        </span><span class="si">%i</span><span class="s2">mport common.NEWLINE -&gt; _NL</span>
<span class="s2">        </span><span class="si">%i</span><span class="s2">mport common.WS_INLINE</span>
<span class="s2">        </span><span class="si">%i</span><span class="s2">gnore WS_INLINE</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s2">&quot;earley&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="n">sample_conf</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">[bla]</span>

<span class="s2">a=Hello</span>
<span class="s2">this=&quot;that&quot;,4</span>
<span class="s2">empty=</span>
<span class="s2">&quot;&quot;&quot;</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">sample_conf</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">pretty</span><span class="p">())</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">test</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-advanced-conf-earley-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/1bc3cb4e14f2c898c0bf16247304d5b2/conf_earley.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">conf_earley.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/f034a71a096a9049dcf409ec85c36943/conf_earley.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">conf_earley.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
<span id="document-examples/advanced/error_handling"></span><div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-advanced-error-handling-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="error-handling-using-an-interactive-parser">
<span id="sphx-glr-examples-advanced-error-handling-py"></span><h4>Error handling using an interactive parser<a class="headerlink" href="#error-handling-using-an-interactive-parser" title="Permalink to this heading"></a></h4>
<p>This example demonstrates error handling using an interactive parser in LALR</p>
<p>When the parser encounters an UnexpectedToken exception, it creates a
an interactive parser with the current parse-state, and lets you control how
to proceed step-by-step. When you’ve achieved the correct parse-state,
you can resume the run by returning True.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Token</span>

<span class="kn">from</span> <span class="nn">_json_parser</span> <span class="kn">import</span> <span class="n">json_parser</span>

<span class="k">def</span> <span class="nf">ignore_errors</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;COMMA&#39;</span><span class="p">:</span>
        <span class="c1"># Skip comma</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;SIGNED_NUMBER&#39;</span><span class="p">:</span>
        <span class="c1"># Try to feed a comma and retry the number</span>
        <span class="n">e</span><span class="o">.</span><span class="n">interactive_parser</span><span class="o">.</span><span class="n">feed_token</span><span class="p">(</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;COMMA&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">))</span>
        <span class="n">e</span><span class="o">.</span><span class="n">interactive_parser</span><span class="o">.</span><span class="n">feed_token</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">token</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># Unhandled error. Will stop parse and raise exception</span>
    <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;[0 1, 2,, 3,,, 4, 5 6 ]&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">json_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">on_error</span><span class="o">=</span><span class="n">ignore_errors</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>      <span class="c1"># prints [0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0]</span>

<span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-advanced-error-handling-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/3a11fd47a1fb670a6759747d618a244e/error_handling.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">error_handling.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/5a9e0a0dc353e4a9357e2204639f6c76/error_handling.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">error_handling.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
<span id="document-examples/advanced/reconstruct_json"></span><div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-advanced-reconstruct-json-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="reconstruct-a-json">
<span id="sphx-glr-examples-advanced-reconstruct-json-py"></span><h4>Reconstruct a JSON<a class="headerlink" href="#reconstruct-a-json" title="Permalink to this heading"></a></h4>
<p>Demonstrates the experimental text-reconstruction feature</p>
<p>The Reconstructor takes a parse tree (already filtered from punctuation, of course),
and reconstructs it into correct text, that can be parsed correctly.
It can be useful for creating “hooks” to alter data before handing it to other parsers. You can also use it to generate samples from scratch.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>

<span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span>
<span class="kn">from</span> <span class="nn">lark.reconstruct</span> <span class="kn">import</span> <span class="n">Reconstructor</span>

<span class="kn">from</span> <span class="nn">_json_parser</span> <span class="kn">import</span> <span class="n">json_grammar</span>

<span class="n">test_json</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    {</span>
<span class="s1">        &quot;empty_object&quot; : </span><span class="si">{}</span><span class="s1">,</span>
<span class="s1">        &quot;empty_array&quot;  : [],</span>
<span class="s1">        &quot;booleans&quot;     : { &quot;YES&quot; : true, &quot;NO&quot; : false },</span>
<span class="s1">        &quot;numbers&quot;      : [ 0, 1, -2, 3.3, 4.4e5, 6.6e-7 ],</span>
<span class="s1">        &quot;strings&quot;      : [ &quot;This&quot;, [ &quot;And&quot; , &quot;That&quot;, &quot;And a </span><span class="se">\\</span><span class="s1">&quot;b&quot; ] ],</span>
<span class="s1">        &quot;nothing&quot;      : null</span>
<span class="s1">    }</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="k">def</span> <span class="nf">test_earley</span><span class="p">():</span>

    <span class="n">json_parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="n">json_grammar</span><span class="p">,</span> <span class="n">maybe_placeholders</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">json_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">test_json</span><span class="p">)</span>

    <span class="n">new_json</span> <span class="o">=</span> <span class="n">Reconstructor</span><span class="p">(</span><span class="n">json_parser</span><span class="p">)</span><span class="o">.</span><span class="n">reconstruct</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">new_json</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">new_json</span><span class="p">)</span> <span class="o">==</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">test_json</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">test_lalr</span><span class="p">():</span>

    <span class="n">json_parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="n">json_grammar</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s1">&#39;lalr&#39;</span><span class="p">,</span> <span class="n">maybe_placeholders</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">json_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">test_json</span><span class="p">)</span>

    <span class="n">new_json</span> <span class="o">=</span> <span class="n">Reconstructor</span><span class="p">(</span><span class="n">json_parser</span><span class="p">)</span><span class="o">.</span><span class="n">reconstruct</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">new_json</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">new_json</span><span class="p">)</span> <span class="o">==</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">test_json</span><span class="p">))</span>

<span class="n">test_earley</span><span class="p">()</span>
<span class="n">test_lalr</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-advanced-reconstruct-json-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/e6911b819cf4afa1ca68b5be22630e13/reconstruct_json.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">reconstruct_json.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/adf07a4514e9cfb278aef018e6994028/reconstruct_json.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">reconstruct_json.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
<span id="document-examples/advanced/custom_lexer"></span><div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-advanced-custom-lexer-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="custom-lexer">
<span id="sphx-glr-examples-advanced-custom-lexer-py"></span><h4>Custom lexer<a class="headerlink" href="#custom-lexer" title="Permalink to this heading"></a></h4>
<p>Demonstrates using a custom lexer to parse a non-textual stream of data</p>
<p>You can use a custom lexer to tokenize text when the lexers offered by Lark
are too slow, or not flexible enough.</p>
<p>You can also use it (as shown in this example) to tokenize streams of objects.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span><span class="p">,</span> <span class="n">Transformer</span><span class="p">,</span> <span class="n">v_args</span>
<span class="kn">from</span> <span class="nn">lark.lexer</span> <span class="kn">import</span> <span class="n">Lexer</span><span class="p">,</span> <span class="n">Token</span>

<span class="k">class</span> <span class="nc">TypeLexer</span><span class="p">(</span><span class="n">Lexer</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lexer_conf</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">lex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">Token</span><span class="p">(</span><span class="s1">&#39;INT&#39;</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;&#39;</span><span class="p">))):</span>
                <span class="k">yield</span> <span class="n">Token</span><span class="p">(</span><span class="s1">&#39;STR&#39;</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        start: data_item+</span>
<span class="s2">        data_item: STR INT*</span>

<span class="s2">        </span><span class="si">%d</span><span class="s2">eclare STR INT</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s1">&#39;lalr&#39;</span><span class="p">,</span> <span class="n">lexer</span><span class="o">=</span><span class="n">TypeLexer</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ParseToDict</span><span class="p">(</span><span class="n">Transformer</span><span class="p">):</span>
    <span class="nd">@v_args</span><span class="p">(</span><span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">data_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">numbers</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">]</span>

    <span class="n">start</span> <span class="o">=</span> <span class="nb">dict</span>


<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;alice&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;bob&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;carrie&#39;</span><span class="p">,</span> <span class="s1">&#39;dan&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">tree</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">ParseToDict</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--&gt;&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="c1"># prints {&#39;alice&#39;: [1, 27, 3], &#39;bob&#39;: [4], &#39;carrie&#39;: [], &#39;dan&#39;: [8, 6]}</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">test</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-advanced-custom-lexer-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/4667ab58050962ac05455b953c59244f/custom_lexer.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">custom_lexer.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/5811ce5e933efd9af1ae8e52d16a3a4f/custom_lexer.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">custom_lexer.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
<span id="document-examples/advanced/tree_forest_transformer"></span><div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-advanced-tree-forest-transformer-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="transform-a-forest">
<span id="sphx-glr-examples-advanced-tree-forest-transformer-py"></span><h4>Transform a Forest<a class="headerlink" href="#transform-a-forest" title="Permalink to this heading"></a></h4>
<p>This example demonstrates how to subclass <code class="docutils literal notranslate"><span class="pre">TreeForestTransformer</span></code> to
directly transform a SPPF.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span>
<span class="kn">from</span> <span class="nn">lark.parsers.earley_forest</span> <span class="kn">import</span> <span class="n">TreeForestTransformer</span><span class="p">,</span> <span class="n">handles_ambiguity</span><span class="p">,</span> <span class="n">Discard</span>

<span class="k">class</span> <span class="nc">CustomTransformer</span><span class="p">(</span><span class="n">TreeForestTransformer</span><span class="p">):</span>

    <span class="nd">@handles_ambiguity</span>
    <span class="k">def</span> <span class="nf">sentence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trees</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="n">tree</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">trees</span> <span class="k">if</span> <span class="n">tree</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s1">&#39;simple&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">simple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">children</span><span class="p">):</span>
        <span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_class</span><span class="p">(</span><span class="s1">&#39;simple&#39;</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">adj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">children</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Discard</span>

    <span class="k">def</span> <span class="nf">__default_token__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">token</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>

<span class="n">grammar</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    sentence: noun verb noun        -&gt; simple</span>
<span class="s2">            | noun verb &quot;like&quot; noun -&gt; comparative</span>

<span class="s2">    noun: adj? NOUN</span>
<span class="s2">    verb: VERB</span>
<span class="s2">    adj: ADJ</span>

<span class="s2">    NOUN: &quot;flies&quot; | &quot;bananas&quot; | &quot;fruit&quot;</span>
<span class="s2">    VERB: &quot;like&quot; | &quot;flies&quot;</span>
<span class="s2">    ADJ: &quot;fruit&quot;</span>

<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common.WS</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">gnore WS</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s1">&#39;sentence&#39;</span><span class="p">,</span> <span class="n">ambiguity</span><span class="o">=</span><span class="s1">&#39;forest&#39;</span><span class="p">)</span>
<span class="n">sentence</span> <span class="o">=</span> <span class="s1">&#39;fruit flies like bananas&#39;</span>
<span class="n">forest</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">CustomTransformer</span><span class="p">(</span><span class="n">resolve_ambiguity</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">forest</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">pretty</span><span class="p">())</span>

<span class="c1"># Output:</span>
<span class="c1">#</span>
<span class="c1"># simple</span>
<span class="c1">#   noun  Flies</span>
<span class="c1">#   verb  Like</span>
<span class="c1">#   noun  Bananas</span>
<span class="c1">#   .</span>
<span class="c1">#</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-advanced-tree-forest-transformer-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/9d7d9d95319f4514ab7247f8eb86ddf0/tree_forest_transformer.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">tree_forest_transformer.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/2d7086e8ce7628b916237820c20847e4/tree_forest_transformer.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">tree_forest_transformer.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
<span id="document-examples/advanced/_json_parser"></span><div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-advanced-json-parser-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="simple-json-parser">
<span id="sphx-glr-examples-advanced-json-parser-py"></span><h4>Simple JSON Parser<a class="headerlink" href="#simple-json-parser" title="Permalink to this heading"></a></h4>
<p>The code is short and clear, and outperforms every other parser (that’s written in Python).
For an explanation, check out the JSON parser tutorial at /docs/json_tutorial.md</p>
<p>(this is here for use by the other examples)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span><span class="p">,</span> <span class="n">Transformer</span><span class="p">,</span> <span class="n">v_args</span>

<span class="n">json_grammar</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    ?start: value</span>

<span class="s2">    ?value: object</span>
<span class="s2">          | array</span>
<span class="s2">          | string</span>
<span class="s2">          | SIGNED_NUMBER      -&gt; number</span>
<span class="s2">          | &quot;true&quot;             -&gt; true</span>
<span class="s2">          | &quot;false&quot;            -&gt; false</span>
<span class="s2">          | &quot;null&quot;             -&gt; null</span>

<span class="s2">    array  : &quot;[&quot; [value (&quot;,&quot; value)*] &quot;]&quot;</span>
<span class="s2">    object : &quot;{&quot; [pair (&quot;,&quot; pair)*] &quot;}&quot;</span>
<span class="s2">    pair   : string &quot;:&quot; value</span>

<span class="s2">    string : ESCAPED_STRING</span>

<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common.ESCAPED_STRING</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common.SIGNED_NUMBER</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common.WS</span>

<span class="s2">    </span><span class="si">%i</span><span class="s2">gnore WS</span>
<span class="s2">&quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">TreeToJson</span><span class="p">(</span><span class="n">Transformer</span><span class="p">):</span>
    <span class="nd">@v_args</span><span class="p">(</span><span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>

    <span class="n">array</span> <span class="o">=</span> <span class="nb">list</span>
    <span class="n">pair</span> <span class="o">=</span> <span class="nb">tuple</span>
    <span class="nb">object</span> <span class="o">=</span> <span class="nb">dict</span>
    <span class="n">number</span> <span class="o">=</span> <span class="n">v_args</span><span class="p">(</span><span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">null</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="kc">None</span>
    <span class="n">true</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="kc">True</span>
    <span class="n">false</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="kc">False</span>


<span class="c1">### Create the JSON parser with Lark, using the LALR algorithm</span>
<span class="n">json_parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="n">json_grammar</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s1">&#39;lalr&#39;</span><span class="p">,</span>
                   <span class="c1"># Using the basic lexer isn&#39;t required, and isn&#39;t usually recommended.</span>
                   <span class="c1"># But, it&#39;s good enough for JSON, and it&#39;s slightly faster.</span>
                   <span class="n">lexer</span><span class="o">=</span><span class="s1">&#39;basic&#39;</span><span class="p">,</span>
                   <span class="c1"># Disabling propagate_positions and placeholders slightly improves speed</span>
                   <span class="n">propagate_positions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">maybe_placeholders</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="c1"># Using an internal transformer is faster and more memory efficient</span>
                   <span class="n">transformer</span><span class="o">=</span><span class="n">TreeToJson</span><span class="p">())</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-advanced-json-parser-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/6d1927842b20958cbf08c916e786d2d0/_json_parser.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">_json_parser.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/ee39a682704904d3f08f1d957831c955/_json_parser.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">_json_parser.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
<span id="document-examples/advanced/prioritizer"></span><div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-advanced-prioritizer-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="custom-sppf-prioritizer">
<span id="sphx-glr-examples-advanced-prioritizer-py"></span><h4>Custom SPPF Prioritizer<a class="headerlink" href="#custom-sppf-prioritizer" title="Permalink to this heading"></a></h4>
<p>This example demonstrates how to subclass <code class="docutils literal notranslate"><span class="pre">ForestVisitor</span></code> to make a custom
SPPF node prioritizer to be used in conjunction with <code class="docutils literal notranslate"><span class="pre">TreeForestTransformer</span></code>.</p>
<p>Our prioritizer will count the number of descendants of a node that are tokens.
By negating this count, our prioritizer will prefer nodes with fewer token
descendants. Thus, we choose the more specific parse.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span>
<span class="kn">from</span> <span class="nn">lark.parsers.earley_forest</span> <span class="kn">import</span> <span class="n">ForestVisitor</span><span class="p">,</span> <span class="n">TreeForestTransformer</span>

<span class="k">class</span> <span class="nc">TokenPrioritizer</span><span class="p">(</span><span class="n">ForestVisitor</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">visit_symbol_node_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="c1"># visit the entire forest by returning node.children</span>
        <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span>

    <span class="k">def</span> <span class="nf">visit_packed_node_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span>

    <span class="k">def</span> <span class="nf">visit_symbol_node_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">priority</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="c1"># Tokens do not have a priority attribute</span>
            <span class="c1"># count them as -1</span>
            <span class="n">priority</span> <span class="o">+=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;priority&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">priority</span> <span class="o">=</span> <span class="n">priority</span>

    <span class="k">def</span> <span class="nf">visit_packed_node_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">priority</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">priority</span> <span class="o">+=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;priority&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">priority</span> <span class="o">=</span> <span class="n">priority</span>

    <span class="k">def</span> <span class="nf">on_cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Oops, we encountered a cycle.&quot;</span><span class="p">)</span>

<span class="n">grammar</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">start: hello &quot; &quot; world | hello_world</span>
<span class="s2">hello: &quot;Hello&quot;</span>
<span class="s2">world: &quot;World&quot;</span>
<span class="s2">hello_world: &quot;Hello World&quot;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s1">&#39;earley&#39;</span><span class="p">,</span> <span class="n">ambiguity</span><span class="o">=</span><span class="s1">&#39;forest&#39;</span><span class="p">)</span>
<span class="n">forest</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Default prioritizer:&quot;</span><span class="p">)</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">TreeForestTransformer</span><span class="p">(</span><span class="n">resolve_ambiguity</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">forest</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">pretty</span><span class="p">())</span>

<span class="n">forest</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Custom prioritizer:&quot;</span><span class="p">)</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">TreeForestTransformer</span><span class="p">(</span><span class="n">resolve_ambiguity</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">prioritizer</span><span class="o">=</span><span class="n">TokenPrioritizer</span><span class="p">())</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">forest</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">pretty</span><span class="p">())</span>

<span class="c1"># Output:</span>
<span class="c1">#</span>
<span class="c1"># Default prioritizer:</span>
<span class="c1"># start</span>
<span class="c1">#   hello Hello</span>
<span class="c1">#</span>
<span class="c1">#   world World</span>
<span class="c1">#</span>
<span class="c1"># Custom prioritizer:</span>
<span class="c1"># start</span>
<span class="c1">#   hello_world   Hello World</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-advanced-prioritizer-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/3c07a7adfbea6387847af2b079a58ed6/prioritizer.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">prioritizer.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/6dea8dbfb244508aaa3b8283470f8c2d/prioritizer.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">prioritizer.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
<span id="document-examples/advanced/py3to2"></span><div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-advanced-py3to2-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="python-3-to-python-2-converter-tree-templates">
<span id="sphx-glr-examples-advanced-py3to2-py"></span><h4>Python 3 to Python 2 converter (tree templates)<a class="headerlink" href="#python-3-to-python-2-converter-tree-templates" title="Permalink to this heading"></a></h4>
<p>This example demonstrates how to translate between two trees using tree templates.
It parses Python 3, translates it to a Python 2 AST, and then outputs the result as Python 2 code.</p>
<p>Uses reconstruct_python.py for generating the final Python 2 code.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span>
<span class="kn">from</span> <span class="nn">lark.tree_templates</span> <span class="kn">import</span> <span class="n">TemplateConf</span><span class="p">,</span> <span class="n">TemplateTranslator</span>

<span class="kn">from</span> <span class="nn">lark.indenter</span> <span class="kn">import</span> <span class="n">PythonIndenter</span>
<span class="kn">from</span> <span class="nn">reconstruct_python</span> <span class="kn">import</span> <span class="n">PythonReconstructor</span>


<span class="c1">#</span>
<span class="c1"># 1. Define a Python parser that also accepts template vars in the code (in the form of $var)</span>
<span class="c1">#</span>
<span class="n">TEMPLATED_PYTHON</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="si">%i</span><span class="s2">mport python (single_input, file_input, eval_input, atom, var, stmt, expr, testlist_star_expr, _NEWLINE, _INDENT, _DEDENT, COMMENT, NAME)</span>

<span class="si">%e</span><span class="s2">xtend atom: TEMPLATE_NAME -&gt; var</span>

<span class="s2">TEMPLATE_NAME: &quot;$&quot; NAME</span>

<span class="s2">?template_start: (stmt | testlist_star_expr _NEWLINE)</span>

<span class="si">%i</span><span class="s2">gnore /[\t \f]+/          // WS</span>
<span class="si">%i</span><span class="s2">gnore /\\[\t \f]*\r?\n/   // LINE_CONT</span>
<span class="si">%i</span><span class="s2">gnore COMMENT</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="n">TEMPLATED_PYTHON</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s1">&#39;lalr&#39;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;single_input&#39;</span><span class="p">,</span> <span class="s1">&#39;file_input&#39;</span><span class="p">,</span> <span class="s1">&#39;eval_input&#39;</span><span class="p">,</span> <span class="s1">&#39;template_start&#39;</span><span class="p">],</span> <span class="n">postlex</span><span class="o">=</span><span class="n">PythonIndenter</span><span class="p">(),</span> <span class="n">maybe_placeholders</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">parse_template</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s1">&#39;template_start&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">parse_code</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s1">&#39;file_input&#39;</span><span class="p">)</span>


<span class="c1">#</span>
<span class="c1"># 2. Define translations using templates (each template code is parsed to a template tree)</span>
<span class="c1">#</span>

<span class="n">pytemplate</span> <span class="o">=</span> <span class="n">TemplateConf</span><span class="p">(</span><span class="n">parse</span><span class="o">=</span><span class="n">parse_template</span><span class="p">)</span>

<span class="n">translations_3to2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;yield from $a&#39;</span><span class="p">:</span>
        <span class="s1">&#39;for _tmp in $a: yield _tmp&#39;</span><span class="p">,</span>

    <span class="s1">&#39;raise $e from $x&#39;</span><span class="p">:</span>
            <span class="s1">&#39;raise $e&#39;</span><span class="p">,</span>

    <span class="s1">&#39;$a / $b&#39;</span><span class="p">:</span>
        <span class="s1">&#39;float($a) / $b&#39;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">translations_3to2</span> <span class="o">=</span> <span class="p">{</span><span class="n">pytemplate</span><span class="p">(</span><span class="n">k</span><span class="p">):</span> <span class="n">pytemplate</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">translations_3to2</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

<span class="c1">#</span>
<span class="c1"># 3. Translate and reconstruct Python 3 code into valid Python 2 code</span>
<span class="c1">#</span>

<span class="n">python_reconstruct</span> <span class="o">=</span> <span class="n">PythonReconstructor</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">translate_py3to2</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">parse_code</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">TemplateTranslator</span><span class="p">(</span><span class="n">translations_3to2</span><span class="p">)</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">python_reconstruct</span><span class="o">.</span><span class="n">reconstruct</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>


<span class="c1">#</span>
<span class="c1"># Test Code</span>
<span class="c1">#</span>

<span class="n">_TEST_CODE</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">if a / 2 &gt; 1:</span>
<span class="s1">    yield from [1,2,3]</span>
<span class="s1">else:</span>
<span class="s1">    raise ValueError(a) from e</span>

<span class="s1">&#39;&#39;&#39;</span>

<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">_TEST_CODE</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   -----&gt;    &#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">translate_py3to2</span><span class="p">(</span><span class="n">_TEST_CODE</span><span class="p">))</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">test</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-advanced-py3to2-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/347194332333371dddab71778db00fd5/py3to2.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">py3to2.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/c1123c2587eda70bc64752df00c577b1/py3to2.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">py3to2.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
<span id="document-examples/advanced/python_parser"></span><div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-advanced-python-parser-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="grammar-complete-python-parser">
<span id="sphx-glr-examples-advanced-python-parser-py"></span><h4>Grammar-complete Python Parser<a class="headerlink" href="#grammar-complete-python-parser" title="Permalink to this heading"></a></h4>
<p>A fully-working Python 2 &amp; 3 parser (but not production ready yet!)</p>
<p>This example demonstrates usage of the included Python grammars</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">os.path</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="nb">open</span>
<span class="kn">import</span> <span class="nn">glob</span><span class="o">,</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span>
<span class="kn">from</span> <span class="nn">lark.indenter</span> <span class="kn">import</span> <span class="n">PythonIndenter</span>


<span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">postlex</span><span class="o">=</span><span class="n">PythonIndenter</span><span class="p">(),</span> <span class="n">start</span><span class="o">=</span><span class="s1">&#39;file_input&#39;</span><span class="p">)</span>

<span class="c1"># Official Python grammar by Lark</span>
<span class="n">python_parser3</span> <span class="o">=</span> <span class="n">Lark</span><span class="o">.</span><span class="n">open_from_package</span><span class="p">(</span><span class="s1">&#39;lark&#39;</span><span class="p">,</span> <span class="s1">&#39;python.lark&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;grammars&#39;</span><span class="p">],</span> <span class="n">parser</span><span class="o">=</span><span class="s1">&#39;lalr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="c1"># Local Python2 grammar</span>
<span class="n">python_parser2</span> <span class="o">=</span> <span class="n">Lark</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;python2.lark&#39;</span><span class="p">,</span> <span class="n">rel_to</span><span class="o">=</span><span class="vm">__file__</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s1">&#39;lalr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="n">python_parser2_earley</span> <span class="o">=</span> <span class="n">Lark</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;python2.lark&#39;</span><span class="p">,</span> <span class="n">rel_to</span><span class="o">=</span><span class="vm">__file__</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s1">&#39;earley&#39;</span><span class="p">,</span> <span class="n">lexer</span><span class="o">=</span><span class="s1">&#39;basic&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">xrange</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="n">chosen_parser</span> <span class="o">=</span> <span class="n">python_parser3</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">chosen_parser</span> <span class="o">=</span> <span class="n">python_parser2</span>


<span class="k">def</span> <span class="nf">_read</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;iso-8859-1&#39;</span><span class="p">}</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">_get_lib_path</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;nt&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;PyPy&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">base_prefix</span><span class="p">,</span> <span class="s1">&#39;lib-python&#39;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">winver</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">base_prefix</span><span class="p">,</span> <span class="s1">&#39;Lib&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[:</span><span class="mi">2</span><span class="p">])][</span><span class="mi">0</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">test_python_lib</span><span class="p">():</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">_get_lib_path</span><span class="p">()</span>

    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;/*.py&#39;</span><span class="p">)</span>
    <span class="n">total_kb</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">_read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
        <span class="n">kb</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span>
        <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> -</span><span class="se">\t</span><span class="si">%.1f</span><span class="s1"> kb&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">kb</span><span class="p">))</span>
        <span class="n">chosen_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">total_kb</span> <span class="o">+=</span> <span class="n">kb</span>

    <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;test_python_lib (</span><span class="si">%d</span><span class="s2"> files, </span><span class="si">%.1f</span><span class="s2"> kb), time: </span><span class="si">%.2f</span><span class="s2"> secs&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">),</span> <span class="n">total_kb</span><span class="p">,</span> <span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">)</span> <span class="p">)</span>

<span class="k">def</span> <span class="nf">test_earley_equals_lalr</span><span class="p">():</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">_get_lib_path</span><span class="p">()</span>

    <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;/*.py&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span> <span class="n">f</span> <span class="p">)</span>
        <span class="n">tree1</span> <span class="o">=</span> <span class="n">python_parser2</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">_read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">tree2</span> <span class="o">=</span> <span class="n">python_parser2_earley</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">_read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">tree1</span> <span class="o">==</span> <span class="n">tree2</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">test_python_lib</span><span class="p">()</span>
    <span class="c1"># test_earley_equals_lalr()</span>
    <span class="c1"># python_parser3.parse(_read(sys.argv[1]) + &#39;\n&#39;)</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-advanced-python-parser-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/3933bf173c425fd28a9c4d7c72b8eca1/python_parser.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">python_parser.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/60290154124d6b16926446036bb711d6/python_parser.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">python_parser.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
<span id="document-examples/advanced/create_ast"></span><div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-advanced-create-ast-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="creating-an-ast-from-the-parse-tree">
<span id="sphx-glr-examples-advanced-create-ast-py"></span><h4>Creating an AST from the parse tree<a class="headerlink" href="#creating-an-ast-from-the-parse-tree" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>This example demonstrates how to transform a parse-tree into an AST using <cite>lark.ast_utils</cite>.</p>
<p>create_transformer() collects every subclass of <cite>Ast</cite> subclass from the module,
and creates a Lark transformer that builds the AST with no extra code.</p>
<p>This example only works with Python 3.</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span><span class="p">,</span> <span class="n">ast_utils</span><span class="p">,</span> <span class="n">Transformer</span><span class="p">,</span> <span class="n">v_args</span>
<span class="kn">from</span> <span class="nn">lark.tree</span> <span class="kn">import</span> <span class="n">Meta</span>

<span class="n">this_module</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">]</span>


<span class="c1">#</span>
<span class="c1">#   Define AST</span>
<span class="c1">#</span>
<span class="k">class</span> <span class="nc">_Ast</span><span class="p">(</span><span class="n">ast_utils</span><span class="o">.</span><span class="n">Ast</span><span class="p">):</span>
    <span class="c1"># This will be skipped by create_transformer(), because it starts with an underscore</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">_Statement</span><span class="p">(</span><span class="n">_Ast</span><span class="p">):</span>
    <span class="c1"># This will be skipped by create_transformer(), because it starts with an underscore</span>
    <span class="k">pass</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Value</span><span class="p">(</span><span class="n">_Ast</span><span class="p">,</span> <span class="n">ast_utils</span><span class="o">.</span><span class="n">WithMeta</span><span class="p">):</span>
    <span class="s2">&quot;Uses WithMeta to include line-number metadata in the meta attribute&quot;</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Meta</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">object</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Name</span><span class="p">(</span><span class="n">_Ast</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">CodeBlock</span><span class="p">(</span><span class="n">_Ast</span><span class="p">,</span> <span class="n">ast_utils</span><span class="o">.</span><span class="n">AsList</span><span class="p">):</span>
    <span class="c1"># Corresponds to code_block in the grammar</span>
    <span class="n">statements</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">_Statement</span><span class="p">]</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">If</span><span class="p">(</span><span class="n">_Statement</span><span class="p">):</span>
    <span class="n">cond</span><span class="p">:</span> <span class="n">Value</span>
    <span class="n">then</span><span class="p">:</span> <span class="n">CodeBlock</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">SetVar</span><span class="p">(</span><span class="n">_Statement</span><span class="p">):</span>
    <span class="c1"># Corresponds to set_var in the grammar</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Value</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Print</span><span class="p">(</span><span class="n">_Statement</span><span class="p">):</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Value</span>


<span class="k">class</span> <span class="nc">ToAst</span><span class="p">(</span><span class="n">Transformer</span><span class="p">):</span>
    <span class="c1"># Define extra transformation functions, for rules that don&#39;t correspond to an AST class.</span>

    <span class="k">def</span> <span class="nf">STRING</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="c1"># Remove quotation marks</span>
        <span class="k">return</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">DEC_NUMBER</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="nd">@v_args</span><span class="p">(</span><span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span>

<span class="c1">#</span>
<span class="c1">#   Define Parser</span>
<span class="c1">#</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    start: code_block</span>

<span class="s2">    code_block: statement+</span>

<span class="s2">    ?statement: if | set_var | print</span>

<span class="s2">    if: &quot;if&quot; value &quot;{&quot; code_block &quot;}&quot;</span>
<span class="s2">    set_var: NAME &quot;=&quot; value &quot;;&quot;</span>
<span class="s2">    print: &quot;print&quot; value &quot;;&quot;</span>

<span class="s2">    value: name | STRING | DEC_NUMBER</span>
<span class="s2">    name: NAME</span>

<span class="s2">    </span><span class="si">%i</span><span class="s2">mport python (NAME, STRING, DEC_NUMBER)</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">mport common.WS</span>
<span class="s2">    </span><span class="si">%i</span><span class="s2">gnore WS</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">parser</span><span class="o">=</span><span class="s2">&quot;lalr&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">transformer</span> <span class="o">=</span> <span class="n">ast_utils</span><span class="o">.</span><span class="n">create_transformer</span><span class="p">(</span><span class="n">this_module</span><span class="p">,</span> <span class="n">ToAst</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

<span class="c1">#</span>
<span class="c1">#   Test</span>
<span class="c1">#</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        a = 1;</span>
<span class="s2">        if a {</span>
<span class="s2">            print &quot;a is 1&quot;;</span>
<span class="s2">            a = 2;</span>
<span class="s2">        }</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-advanced-create-ast-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/bfeb22cff3ae6c24841aad8c5a95d047/create_ast.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">create_ast.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/08132b45db8ea39c7a8efd8acc048de2/create_ast.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">create_ast.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
<span id="document-examples/advanced/error_reporting_earley"></span><div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-advanced-error-reporting-earley-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="example-driven-error-reporting">
<span id="sphx-glr-examples-advanced-error-reporting-earley-py"></span><h4>Example-Driven Error Reporting<a class="headerlink" href="#example-driven-error-reporting" title="Permalink to this heading"></a></h4>
<p>A demonstration of example-driven error reporting with the Earley parser
(See also: error_reporting_lalr.py)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span><span class="p">,</span> <span class="n">UnexpectedInput</span>

<span class="kn">from</span> <span class="nn">_json_parser</span> <span class="kn">import</span> <span class="n">json_grammar</span>   <span class="c1"># Using the grammar from the json_parser example</span>

<span class="n">json_parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="n">json_grammar</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">JsonSyntaxError</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">context</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> at line </span><span class="si">%s</span><span class="s1">, column </span><span class="si">%s</span><span class="s1">.</span><span class="se">\n\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">JsonMissingValue</span><span class="p">(</span><span class="n">JsonSyntaxError</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Missing Value&#39;</span>

<span class="k">class</span> <span class="nc">JsonMissingOpening</span><span class="p">(</span><span class="n">JsonSyntaxError</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Missing Opening&#39;</span>

<span class="k">class</span> <span class="nc">JsonMissingClosing</span><span class="p">(</span><span class="n">JsonSyntaxError</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Missing Closing&#39;</span>

<span class="k">class</span> <span class="nc">JsonMissingComma</span><span class="p">(</span><span class="n">JsonSyntaxError</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Missing Comma&#39;</span>

<span class="k">class</span> <span class="nc">JsonTrailingComma</span><span class="p">(</span><span class="n">JsonSyntaxError</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Trailing Comma&#39;</span>


<span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">json_text</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">json_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">json_text</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">UnexpectedInput</span> <span class="k">as</span> <span class="n">u</span><span class="p">:</span>
        <span class="n">exc_class</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">match_examples</span><span class="p">(</span><span class="n">json_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">JsonMissingOpening</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;{&quot;foo&quot;: ]}&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;{&quot;foor&quot;: }}&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;{&quot;foo&quot;: }&#39;</span><span class="p">],</span>
            <span class="n">JsonMissingClosing</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;{&quot;foo&quot;: [}&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;{&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;{&quot;a&quot;: 1&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;[1&#39;</span><span class="p">],</span>
            <span class="n">JsonMissingComma</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;[1 2]&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;[false 1]&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;[&quot;b&quot; 1]&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;{&quot;a&quot;:true 1:4}&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;{&quot;a&quot;:1 1:4}&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;{&quot;a&quot;:&quot;b&quot; 1:4}&#39;</span><span class="p">],</span>
            <span class="n">JsonTrailingComma</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;[,]&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;[1,]&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;[1,2,]&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;{&quot;foo&quot;:1,}&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;{&quot;foo&quot;:false,&quot;bar&quot;:true,}&#39;</span><span class="p">]</span>
        <span class="p">},</span> <span class="n">use_accepts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">exc_class</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">raise</span> <span class="n">exc_class</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">get_context</span><span class="p">(</span><span class="n">json_text</span><span class="p">),</span> <span class="n">u</span><span class="o">.</span><span class="n">line</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">column</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">parse</span><span class="p">(</span><span class="s1">&#39;{&quot;example1&quot;: &quot;value&quot;&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">JsonMissingClosing</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">parse</span><span class="p">(</span><span class="s1">&#39;{&quot;example2&quot;: ] &#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">JsonMissingOpening</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">test</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-advanced-error-reporting-earley-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/ca074bdcc9170e436dcd2f779e4a4285/error_reporting_earley.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">error_reporting_earley.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/bdb62f1189ee436f5378982a91ecc1cf/error_reporting_earley.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">error_reporting_earley.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
<span id="document-examples/advanced/error_reporting_lalr"></span><div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-advanced-error-reporting-lalr-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="example-driven-error-reporting">
<span id="sphx-glr-examples-advanced-error-reporting-lalr-py"></span><h4>Example-Driven Error Reporting<a class="headerlink" href="#example-driven-error-reporting" title="Permalink to this heading"></a></h4>
<p>A demonstration of example-driven error reporting with the LALR parser
(See also: error_reporting_earley.py)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span><span class="p">,</span> <span class="n">UnexpectedInput</span>

<span class="kn">from</span> <span class="nn">_json_parser</span> <span class="kn">import</span> <span class="n">json_grammar</span>   <span class="c1"># Using the grammar from the json_parser example</span>

<span class="n">json_parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="n">json_grammar</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s1">&#39;lalr&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">JsonSyntaxError</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">context</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> at line </span><span class="si">%s</span><span class="s1">, column </span><span class="si">%s</span><span class="s1">.</span><span class="se">\n\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">JsonMissingValue</span><span class="p">(</span><span class="n">JsonSyntaxError</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Missing Value&#39;</span>

<span class="k">class</span> <span class="nc">JsonMissingOpening</span><span class="p">(</span><span class="n">JsonSyntaxError</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Missing Opening&#39;</span>

<span class="k">class</span> <span class="nc">JsonMissingClosing</span><span class="p">(</span><span class="n">JsonSyntaxError</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Missing Closing&#39;</span>

<span class="k">class</span> <span class="nc">JsonMissingComma</span><span class="p">(</span><span class="n">JsonSyntaxError</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Missing Comma&#39;</span>

<span class="k">class</span> <span class="nc">JsonTrailingComma</span><span class="p">(</span><span class="n">JsonSyntaxError</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Trailing Comma&#39;</span>


<span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">json_text</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">json_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">json_text</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">UnexpectedInput</span> <span class="k">as</span> <span class="n">u</span><span class="p">:</span>
        <span class="n">exc_class</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">match_examples</span><span class="p">(</span><span class="n">json_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">JsonMissingOpening</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;{&quot;foo&quot;: ]}&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;{&quot;foor&quot;: }}&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;{&quot;foo&quot;: }&#39;</span><span class="p">],</span>
            <span class="n">JsonMissingClosing</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;{&quot;foo&quot;: [}&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;{&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;{&quot;a&quot;: 1&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;[1&#39;</span><span class="p">],</span>
            <span class="n">JsonMissingComma</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;[1 2]&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;[false 1]&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;[&quot;b&quot; 1]&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;{&quot;a&quot;:true 1:4}&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;{&quot;a&quot;:1 1:4}&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;{&quot;a&quot;:&quot;b&quot; 1:4}&#39;</span><span class="p">],</span>
            <span class="n">JsonTrailingComma</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;[,]&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;[1,]&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;[1,2,]&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;{&quot;foo&quot;:1,}&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;{&quot;foo&quot;:false,&quot;bar&quot;:true,}&#39;</span><span class="p">]</span>
        <span class="p">},</span> <span class="n">use_accepts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">exc_class</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">raise</span> <span class="n">exc_class</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">get_context</span><span class="p">(</span><span class="n">json_text</span><span class="p">),</span> <span class="n">u</span><span class="o">.</span><span class="n">line</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">column</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">parse</span><span class="p">(</span><span class="s1">&#39;{&quot;example1&quot;: &quot;value&quot;&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">JsonMissingClosing</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">parse</span><span class="p">(</span><span class="s1">&#39;{&quot;example2&quot;: ] &#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">JsonMissingOpening</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">test</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-advanced-error-reporting-lalr-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/2cc75b757e7515472722c8c02d4fe4e4/error_reporting_lalr.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">error_reporting_lalr.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/7279f5d640bfe9814468a2adf38516d5/error_reporting_lalr.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">error_reporting_lalr.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
<span id="document-examples/advanced/reconstruct_python"></span><div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-advanced-reconstruct-python-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="reconstruct-python">
<span id="sphx-glr-examples-advanced-reconstruct-python-py"></span><h4>Reconstruct Python<a class="headerlink" href="#reconstruct-python" title="Permalink to this heading"></a></h4>
<p>Demonstrates how Lark’s experimental text-reconstruction feature can recreate
functional Python code from its parse-tree, using just the correct grammar and
a small formatter.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Token</span><span class="p">,</span> <span class="n">Lark</span>
<span class="kn">from</span> <span class="nn">lark.reconstruct</span> <span class="kn">import</span> <span class="n">Reconstructor</span>
<span class="kn">from</span> <span class="nn">lark.indenter</span> <span class="kn">import</span> <span class="n">PythonIndenter</span>

<span class="c1"># Official Python grammar by Lark</span>
<span class="n">python_parser3</span> <span class="o">=</span> <span class="n">Lark</span><span class="o">.</span><span class="n">open_from_package</span><span class="p">(</span><span class="s1">&#39;lark&#39;</span><span class="p">,</span> <span class="s1">&#39;python.lark&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;grammars&#39;</span><span class="p">],</span>
                                        <span class="n">parser</span><span class="o">=</span><span class="s1">&#39;lalr&#39;</span><span class="p">,</span> <span class="n">postlex</span><span class="o">=</span><span class="n">PythonIndenter</span><span class="p">(),</span> <span class="n">start</span><span class="o">=</span><span class="s1">&#39;file_input&#39;</span><span class="p">,</span>
                                        <span class="n">maybe_placeholders</span><span class="o">=</span><span class="kc">False</span>    <span class="c1"># Necessary for reconstructor</span>
                                        <span class="p">)</span>

<span class="n">SPACE_AFTER</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="s1">&#39;,+-*/~@&lt;&gt;=&quot;|:&#39;</span><span class="p">)</span>
<span class="n">SPACE_BEFORE</span> <span class="o">=</span> <span class="p">(</span><span class="n">SPACE_AFTER</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="s1">&#39;,:&#39;</span><span class="p">))</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">special</span><span class="p">(</span><span class="n">sym</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Token</span><span class="p">(</span><span class="s1">&#39;SPECIAL&#39;</span><span class="p">,</span> <span class="n">sym</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">postproc</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">last_was_whitespace</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Token</span><span class="p">)</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;SPECIAL&#39;</span><span class="p">:</span>
            <span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">actions</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">actions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;_NEWLINE&#39;</span> <span class="ow">and</span> <span class="s1">&#39;_NEWLINE&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">actions</span>

                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s1">&#39;_INDENT&#39;</span><span class="p">:</span>
                        <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="n">a</span> <span class="o">==</span> <span class="s1">&#39;_DEDENT&#39;</span>
                        <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">actions</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="k">yield</span> <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">last_was_whitespace</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">last_was_whitespace</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">SPACE_BEFORE</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="s1">&#39; &#39;</span>
            <span class="k">yield</span> <span class="n">item</span>
            <span class="n">last_was_whitespace</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">last_was_whitespace</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">SPACE_AFTER</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="s1">&#39; &#39;</span>
                    <span class="n">last_was_whitespace</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">yield</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>


<span class="k">class</span> <span class="nc">PythonReconstructor</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_recons</span> <span class="o">=</span> <span class="n">Reconstructor</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;_NEWLINE&#39;</span><span class="p">:</span> <span class="n">special</span><span class="p">,</span> <span class="s1">&#39;_DEDENT&#39;</span><span class="p">:</span> <span class="n">special</span><span class="p">,</span> <span class="s1">&#39;_INDENT&#39;</span><span class="p">:</span> <span class="n">special</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">reconstruct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recons</span><span class="o">.</span><span class="n">reconstruct</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">postproc</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="n">python_reconstructor</span> <span class="o">=</span> <span class="n">PythonReconstructor</span><span class="p">(</span><span class="n">python_parser3</span><span class="p">)</span>

    <span class="n">self_contents</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="n">tree</span> <span class="o">=</span> <span class="n">python_parser3</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">self_contents</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">python_reconstructor</span><span class="o">.</span><span class="n">reconstruct</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

    <span class="n">tree_new</span> <span class="o">=</span> <span class="n">python_parser3</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">pretty</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">tree_new</span><span class="o">.</span><span class="n">pretty</span><span class="p">())</span>
    <span class="c1"># assert tree.pretty() == tree_new.pretty()</span>
    <span class="k">assert</span> <span class="n">tree</span> <span class="o">==</span> <span class="n">tree_new</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">test</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-advanced-reconstruct-python-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/3b0766c1f76ff2904339853615cf4943/reconstruct_python.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">reconstruct_python.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/57b38708c982e98764460c3e288a1ff5/reconstruct_python.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">reconstruct_python.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
<span id="document-examples/advanced/dynamic_complete"></span><div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-advanced-dynamic-complete-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="using-lexer-dynamic-complete">
<span id="sphx-glr-examples-advanced-dynamic-complete-py"></span><h4>Using lexer dynamic_complete<a class="headerlink" href="#using-lexer-dynamic-complete" title="Permalink to this heading"></a></h4>
<p>Demonstrates how to use <code class="docutils literal notranslate"><span class="pre">lexer='dynamic_complete'</span></code> and <code class="docutils literal notranslate"><span class="pre">ambiguity='explicit'</span></code></p>
<p>Sometimes you have data that is highly ambiguous or ‘broken’ in some sense.
When using <code class="docutils literal notranslate"><span class="pre">parser='earley'</span></code> and <code class="docutils literal notranslate"><span class="pre">lexer='dynamic_complete'</span></code>, Lark will be able
parse just about anything as long as there is a valid way to generate it from
the Grammar, including looking ‘into’ the Regexes.</p>
<p>This examples shows how to parse a json input where the quotes have been
replaced by underscores: <code class="docutils literal notranslate"><span class="pre">{_foo_:{},</span> <span class="pre">_bar_:</span> <span class="pre">[],</span> <span class="pre">_baz_:</span> <span class="pre">__}</span></code>
Notice that underscores might still appear inside strings, so a potentially
valid reading of the above is:
<code class="docutils literal notranslate"><span class="pre">{&quot;foo_:{},</span> <span class="pre">_bar&quot;:</span> <span class="pre">[],</span> <span class="pre">&quot;baz&quot;:</span> <span class="pre">&quot;&quot;}</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span><span class="p">,</span> <span class="n">Tree</span><span class="p">,</span> <span class="n">Transformer</span><span class="p">,</span> <span class="n">v_args</span>
<span class="kn">from</span> <span class="nn">lark.visitors</span> <span class="kn">import</span> <span class="n">Transformer_InPlace</span>

<span class="n">GRAMMAR</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="si">%i</span><span class="s2">mport common.SIGNED_NUMBER</span>
<span class="si">%i</span><span class="s2">mport common.WS_INLINE</span>
<span class="si">%i</span><span class="s2">mport common.NEWLINE</span>
<span class="si">%i</span><span class="s2">gnore WS_INLINE</span>

<span class="s2">?start: value</span>

<span class="s2">?value: object</span>
<span class="s2">      | array</span>
<span class="s2">      | string</span>
<span class="s2">      | SIGNED_NUMBER      -&gt; number</span>
<span class="s2">      | &quot;true&quot;             -&gt; true</span>
<span class="s2">      | &quot;false&quot;            -&gt; false</span>
<span class="s2">      | &quot;null&quot;             -&gt; null</span>

<span class="s2">array  : &quot;[&quot; (value (&quot;,&quot; value)*)? &quot;]&quot;</span>
<span class="s2">object : &quot;{&quot; (pair (&quot;,&quot; pair)*)? &quot;}&quot;</span>
<span class="s2">pair   : string &quot;:&quot; value</span>

<span class="s2">string: STRING</span>
<span class="s2">STRING : ESCAPED_STRING</span>

<span class="s2">ESCAPED_STRING: QUOTE_CHAR _STRING_ESC_INNER QUOTE_CHAR</span>
<span class="s2">QUOTE_CHAR: &quot;_&quot;</span>

<span class="s2">_STRING_INNER: /.*/</span>
<span class="s2">_STRING_ESC_INNER: _STRING_INNER /(?&lt;!\\)(\\\\)*?/</span>

<span class="s2">&quot;&quot;&quot;</span>


<span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">Tree</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Scores an option by how many children (and grand-children, and</span>
<span class="sd">    grand-grand-children, ...) it has.</span>
<span class="sd">    This means that the option with fewer large terminals gets selected</span>

<span class="sd">    Between</span>
<span class="sd">        object</span>
<span class="sd">          pair</span>
<span class="sd">            string  _foo_</span>
<span class="sd">            object</span>
<span class="sd">          pair</span>
<span class="sd">            string  _bar_: [], _baz_</span>
<span class="sd">            string  __</span>

<span class="sd">    and</span>

<span class="sd">        object</span>
<span class="sd">          pair</span>
<span class="sd">            string  _foo_</span>
<span class="sd">            object</span>
<span class="sd">          pair</span>
<span class="sd">            string  _bar_</span>
<span class="sd">            array</span>
<span class="sd">          pair</span>
<span class="sd">            string  _baz_</span>
<span class="sd">            string  __</span>

<span class="sd">    this will give the second a higher score. (9 vs 13)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">iter_subtrees</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">RemoveAmbiguities</span><span class="p">(</span><span class="n">Transformer_InPlace</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Selects an option to resolve an ambiguity using the score function above.</span>
<span class="sd">    Scores each option and selects the one with the higher score, e.g. the one</span>
<span class="sd">    with more nodes.</span>

<span class="sd">    If there is a performance problem with the Tree having to many _ambig and</span>
<span class="sd">    being slow and to large, this can instead be written as a ForestVisitor.</span>
<span class="sd">    Look at the &#39;Custom SPPF Prioritizer&#39; example.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_ambig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">score</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TreeToJson</span><span class="p">(</span><span class="n">Transformer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the same Transformer as the json_parser example.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@v_args</span><span class="p">(</span><span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>

    <span class="n">array</span> <span class="o">=</span> <span class="nb">list</span>
    <span class="n">pair</span> <span class="o">=</span> <span class="nb">tuple</span>
    <span class="nb">object</span> <span class="o">=</span> <span class="nb">dict</span>
    <span class="n">number</span> <span class="o">=</span> <span class="n">v_args</span><span class="p">(</span><span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">null</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="kc">None</span>
    <span class="n">true</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="kc">True</span>
    <span class="n">false</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="kc">False</span>


<span class="n">parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="n">GRAMMAR</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s1">&#39;earley&#39;</span><span class="p">,</span> <span class="n">ambiguity</span><span class="o">=</span><span class="s2">&quot;explicit&quot;</span><span class="p">,</span> <span class="n">lexer</span><span class="o">=</span><span class="s1">&#39;dynamic_complete&#39;</span><span class="p">)</span>

<span class="n">EXAMPLES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="sa">r</span><span class="s1">&#39;{_array_:[1,2,3]}&#39;</span><span class="p">,</span>

    <span class="sa">r</span><span class="s1">&#39;{_abc_: _array must be of the following format [_1_, _2_, _3_]_}&#39;</span><span class="p">,</span>

    <span class="sa">r</span><span class="s1">&#39;{_foo_:</span><span class="si">{}</span><span class="s1">, _bar_: [], _baz_: __}&#39;</span><span class="p">,</span>

    <span class="sa">r</span><span class="s1">&#39;{_error_:_invalid_client_, _error_description_:_AADSTS7000215: Invalid &#39;</span>
    <span class="sa">r</span><span class="s1">&#39;client secret is provided.\r\nTrace ID: &#39;</span>
    <span class="sa">r</span><span class="s1">&#39;a0a0aaaa-a0a0-0a00-000a-00a00aaa0a00\r\nCorrelation ID: &#39;</span>
    <span class="sa">r</span><span class="s1">&#39;aa0aaa00-0aaa-0000-00a0-00000aaaa0aa\r\nTimestamp: 1997-10-10 00:00:00Z_, &#39;</span>
    <span class="sa">r</span><span class="s1">&#39;_error_codes_:[7000215], _timestamp_:_1997-10-10 00:00:00Z_, &#39;</span>
    <span class="sa">r</span><span class="s1">&#39;_trace_id_:_a0a0aaaa-a0a0-0a00-000a-00a00aaa0a00_, &#39;</span>
    <span class="sa">r</span><span class="s1">&#39;_correlation_id_:_aa0aaa00-0aaa-0000-00a0-00000aaaa0aa_, &#39;</span>
    <span class="sa">r</span><span class="s1">&#39;_error_uri_:_https://example.com_}&#39;</span><span class="p">,</span>

<span class="p">]</span>
<span class="k">for</span> <span class="n">example</span> <span class="ow">in</span> <span class="n">EXAMPLES</span><span class="p">:</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">RemoveAmbiguities</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">TreeToJson</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-advanced-dynamic-complete-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/22081051f999d4e0753796b91b344ee3/dynamic_complete.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">dynamic_complete.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/fc674523e7ef0712dfc331b1ddd10972/dynamic_complete.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">dynamic_complete.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
<span id="document-examples/advanced/qscintilla_json"></span><div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-advanced-qscintilla-json-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="syntax-highlighting">
<span id="sphx-glr-examples-advanced-qscintilla-json-py"></span><h4>Syntax Highlighting<a class="headerlink" href="#syntax-highlighting" title="Permalink to this heading"></a></h4>
<p>This example shows how to write a syntax-highlighted editor with Qt and Lark</p>
<p>Requirements:</p>
<blockquote>
<div><p>PyQt5==5.15.8
QScintilla==2.13.4</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">textwrap</span>

<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="n">QApplication</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtGui</span> <span class="kn">import</span> <span class="n">QColor</span><span class="p">,</span> <span class="n">QFont</span><span class="p">,</span> <span class="n">QFontMetrics</span>

<span class="kn">from</span> <span class="nn">PyQt5.Qsci</span> <span class="kn">import</span> <span class="n">QsciScintilla</span>
<span class="kn">from</span> <span class="nn">PyQt5.Qsci</span> <span class="kn">import</span> <span class="n">QsciLexerCustom</span>

<span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span>


<span class="k">class</span> <span class="nc">LexerJson</span><span class="p">(</span><span class="n">QsciLexerCustom</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_parser</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_styles</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">create_styles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">deeppink</span> <span class="o">=</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">249</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">114</span><span class="p">)</span>
        <span class="n">khaki</span> <span class="o">=</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">230</span><span class="p">,</span> <span class="mi">219</span><span class="p">,</span> <span class="mi">116</span><span class="p">)</span>
        <span class="n">mediumpurple</span> <span class="o">=</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">174</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
        <span class="n">mediumturquoise</span> <span class="o">=</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">81</span><span class="p">,</span> <span class="mi">217</span><span class="p">,</span> <span class="mi">205</span><span class="p">)</span>
        <span class="n">yellowgreen</span> <span class="o">=</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">166</span><span class="p">,</span> <span class="mi">226</span><span class="p">,</span> <span class="mi">46</span><span class="p">)</span>
        <span class="n">lightcyan</span> <span class="o">=</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">213</span><span class="p">,</span> <span class="mi">248</span><span class="p">,</span> <span class="mi">232</span><span class="p">)</span>
        <span class="n">darkslategrey</span> <span class="o">=</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">39</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">34</span><span class="p">)</span>

        <span class="n">styles</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="n">mediumturquoise</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">:</span> <span class="n">mediumpurple</span><span class="p">,</span>
            <span class="mi">2</span><span class="p">:</span> <span class="n">yellowgreen</span><span class="p">,</span>
            <span class="mi">3</span><span class="p">:</span> <span class="n">deeppink</span><span class="p">,</span>
            <span class="mi">4</span><span class="p">:</span> <span class="n">khaki</span><span class="p">,</span>
            <span class="mi">5</span><span class="p">:</span> <span class="n">lightcyan</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">style</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">styles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setPaper</span><span class="p">(</span><span class="n">darkslategrey</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">font</span><span class="p">(),</span> <span class="n">style</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">token_styles</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;COLON&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s2">&quot;COMMA&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s2">&quot;LBRACE&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s2">&quot;LSQB&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s2">&quot;RBRACE&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s2">&quot;RSQB&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s2">&quot;FALSE&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;NULL&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;TRUE&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;STRING&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s2">&quot;NUMBER&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">create_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">grammar</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            anons: &quot;:&quot; &quot;{&quot; &quot;}&quot; &quot;,&quot; &quot;[&quot; &quot;]&quot;</span>
<span class="s1">            TRUE: &quot;true&quot;</span>
<span class="s1">            FALSE: &quot;false&quot;</span>
<span class="s1">            NULL: &quot;NULL&quot;</span>
<span class="s1">            </span><span class="si">%i</span><span class="s1">mport common.ESCAPED_STRING -&gt; STRING</span>
<span class="s1">            </span><span class="si">%i</span><span class="s1">mport common.SIGNED_NUMBER  -&gt; NUMBER</span>
<span class="s1">            </span><span class="si">%i</span><span class="s1">mport common.WS</span>
<span class="s1">            </span><span class="si">%i</span><span class="s1">gnore WS</span>
<span class="s1">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lark</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lexer</span><span class="o">=</span><span class="s1">&#39;basic&#39;</span><span class="p">)</span>
        <span class="c1"># All tokens: print([t.name for t in self.lark.parser.lexer.tokens])</span>

    <span class="k">def</span> <span class="nf">defaultPaper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">39</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">34</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">language</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Json&quot;</span>

    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">token_styles</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">styleText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startStyling</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
        <span class="n">last_pos</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lark</span><span class="o">.</span><span class="n">lex</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
                <span class="n">ws_len</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">start_pos</span> <span class="o">-</span> <span class="n">last_pos</span>
                <span class="k">if</span> <span class="n">ws_len</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setStyling</span><span class="p">(</span><span class="n">ws_len</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>    <span class="c1"># whitespace</span>

                <span class="n">token_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setStyling</span><span class="p">(</span>
                    <span class="n">token_len</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">token_styles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

                <span class="n">last_pos</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">start_pos</span> <span class="o">+</span> <span class="n">token_len</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">EditorAll</span><span class="p">(</span><span class="n">QsciScintilla</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

        <span class="c1"># Set font defaults</span>
        <span class="n">font</span> <span class="o">=</span> <span class="n">QFont</span><span class="p">()</span>
        <span class="n">font</span><span class="o">.</span><span class="n">setFamily</span><span class="p">(</span><span class="s1">&#39;Consolas&#39;</span><span class="p">)</span>
        <span class="n">font</span><span class="o">.</span><span class="n">setFixedPitch</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">font</span><span class="o">.</span><span class="n">setPointSize</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">font</span><span class="o">.</span><span class="n">setBold</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>

        <span class="c1"># Set margin defaults</span>
        <span class="n">fontmetrics</span> <span class="o">=</span> <span class="n">QFontMetrics</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMarginsFont</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMarginWidth</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontmetrics</span><span class="o">.</span><span class="n">width</span><span class="p">(</span><span class="s2">&quot;000&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMarginLineNumbers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMarginsForegroundColor</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMarginsBackgroundColor</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="mi">39</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">34</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMarginType</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SymbolMargin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMarginWidth</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>

        <span class="c1"># Set indentation defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setIndentationsUseTabs</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setIndentationWidth</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setBackspaceUnindents</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setIndentationGuides</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># self.setFolding(QsciScintilla.CircledFoldStyle)</span>

        <span class="c1"># Set caret defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setCaretForegroundColor</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="mi">247</span><span class="p">,</span> <span class="mi">247</span><span class="p">,</span> <span class="mi">241</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setCaretWidth</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Set selection color defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSelectionBackgroundColor</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="mi">61</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">52</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resetSelectionForegroundColor</span><span class="p">()</span>

        <span class="c1"># Set multiselection defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="n">QsciScintilla</span><span class="o">.</span><span class="n">SCI_SETMULTIPLESELECTION</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="n">QsciScintilla</span><span class="o">.</span><span class="n">SCI_SETMULTIPASTE</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span>
            <span class="n">QsciScintilla</span><span class="o">.</span><span class="n">SCI_SETADDITIONALSELECTIONTYPING</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="n">lexer</span> <span class="o">=</span> <span class="n">LexerJson</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLexer</span><span class="p">(</span><span class="n">lexer</span><span class="p">)</span>


<span class="n">EXAMPLE_TEXT</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">        {</span>
<span class="s2">            &quot;_id&quot;: &quot;5b05ffcbcf8e597939b3f5ca&quot;,</span>
<span class="s2">            &quot;about&quot;: &quot;Excepteur consequat commodo esse voluptate aute aliquip ad sint deserunt commodo eiusmod irure. Sint aliquip sit magna duis eu est culpa aliqua excepteur ut tempor nulla. Aliqua ex pariatur id labore sit. Quis sit ex aliqua veniam exercitation laboris anim adipisicing. Lorem nisi reprehenderit ullamco labore qui sit ut aliqua tempor consequat pariatur proident.&quot;,</span>
<span class="s2">            &quot;address&quot;: &quot;665 Malbone Street, Thornport, Louisiana, 243&quot;,</span>
<span class="s2">            &quot;age&quot;: 23,</span>
<span class="s2">            &quot;balance&quot;: &quot;$3,216.91&quot;,</span>
<span class="s2">            &quot;company&quot;: &quot;BULLJUICE&quot;,</span>
<span class="s2">            &quot;email&quot;: &quot;elisekelley@bulljuice.com&quot;,</span>
<span class="s2">            &quot;eyeColor&quot;: &quot;brown&quot;,</span>
<span class="s2">            &quot;gender&quot;: &quot;female&quot;,</span>
<span class="s2">            &quot;guid&quot;: &quot;d3a6d865-0f64-4042-8a78-4f53de9b0707&quot;,</span>
<span class="s2">            &quot;index&quot;: 0,</span>
<span class="s2">            &quot;isActive&quot;: false,</span>
<span class="s2">            &quot;isActive2&quot;: true,</span>
<span class="s2">            &quot;latitude&quot;: -18.660714,</span>
<span class="s2">            &quot;longitude&quot;: -85.378048,</span>
<span class="s2">            &quot;name&quot;: &quot;Elise Kelley&quot;,</span>
<span class="s2">            &quot;phone&quot;: &quot;+1 (808) 543-3966&quot;,</span>
<span class="s2">            &quot;picture&quot;: &quot;http://placehold.it/32x32&quot;,</span>
<span class="s2">            &quot;registered&quot;: &quot;2017-09-30T03:47:40 -02:00&quot;,</span>
<span class="s2">            &quot;tags&quot;: [</span>
<span class="s2">                &quot;et&quot;,</span>
<span class="s2">                &quot;nostrud&quot;,</span>
<span class="s2">                &quot;in&quot;,</span>
<span class="s2">                &quot;fugiat&quot;,</span>
<span class="s2">                &quot;incididunt&quot;,</span>
<span class="s2">                &quot;labore&quot;,</span>
<span class="s2">                &quot;nostrud&quot;</span>
<span class="s2">            ]</span>
<span class="s2">        }</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">ex</span> <span class="o">=</span> <span class="n">EditorAll</span><span class="p">()</span>
    <span class="n">ex</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
    <span class="n">ex</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">EXAMPLE_TEXT</span><span class="p">)</span>
    <span class="n">ex</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span>
    <span class="n">ex</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-advanced-qscintilla-json-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/1e229dcdb521be752d4349e61ead59d1/qscintilla_json.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">qscintilla_json.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/9056f9d3440746d8fe151c31173e18e6/qscintilla_json.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">qscintilla_json.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</div>
</section>
<span id="document-examples/composition/index"></span><section id="grammar-composition">
<span id="sphx-glr-examples-composition"></span><h3>Grammar Composition<a class="headerlink" href="#grammar-composition" title="Permalink to this heading"></a></h3>
<p>This example shows how to do grammar composition in Lark, by creating a new
file format that allows both CSV and JSON to co-exist.</p>
<p>We show how, by using namespaces, Lark grammars and their transformers can be fully reused -
they don’t need to care if their grammar is used directly, or being imported, or who is doing the importing.</p>
<p>See <a class="reference external" href="https://github.com/lark-parser/lark/blob/master/examples/composition/main.py">main.py</a> for more details.</p>
<div class="sphx-glr-thumbnails"><div class="sphx-glr-thumbcontainer" tooltip="Transformer for evaluating json.lark"><img alt="" src="_images/sphx_glr_eval_json_thumb.png" />
<p><span class="xref std std-ref">sphx_glr_examples_composition_eval_json.py</span></p>
  <div class="sphx-glr-thumbnail-title">Transformer for evaluating json.lark</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="Transformer for evaluating csv.lark"><img alt="" src="_images/sphx_glr_eval_csv_thumb.png" />
<p><span class="xref std std-ref">sphx_glr_examples_composition_eval_csv.py</span></p>
  <div class="sphx-glr-thumbnail-title">Transformer for evaluating csv.lark</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="This example shows how to do grammar composition in Lark, by creating a new file format that al..."><img alt="" src="_images/sphx_glr_main_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-composition-main-py"><span class="std std-ref">Grammar Composition</span></a></p>
  <div class="sphx-glr-thumbnail-title">Grammar Composition</div>
</div></div><div class="toctree-wrapper compound">
<span id="document-examples/composition/eval_json"></span><div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-composition-eval-json-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<p class="sphx-glr-example-title" id="sphx-glr-examples-composition-eval-json-py">Transformer for evaluating json.lark</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Transformer</span><span class="p">,</span> <span class="n">v_args</span>

<span class="k">class</span> <span class="nc">JsonTreeToJson</span><span class="p">(</span><span class="n">Transformer</span><span class="p">):</span>
    <span class="nd">@v_args</span><span class="p">(</span><span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>

    <span class="n">array</span> <span class="o">=</span> <span class="nb">list</span>
    <span class="n">pair</span> <span class="o">=</span> <span class="nb">tuple</span>
    <span class="nb">object</span> <span class="o">=</span> <span class="nb">dict</span>
    <span class="n">number</span> <span class="o">=</span> <span class="n">v_args</span><span class="p">(</span><span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">null</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="kc">None</span>
    <span class="n">true</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="kc">True</span>
    <span class="n">false</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="kc">False</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-composition-eval-json-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/11091a0f6990e281219479476971fa12/eval_json.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">eval_json.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/59e28e5e93b13914beea3268d124ef92/eval_json.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">eval_json.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
<span id="document-examples/composition/eval_csv"></span><div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-composition-eval-csv-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<p class="sphx-glr-example-title" id="sphx-glr-examples-composition-eval-csv-py">Transformer for evaluating csv.lark</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Transformer</span>

<span class="k">class</span> <span class="nc">CsvTreeToPandasDict</span><span class="p">(</span><span class="n">Transformer</span><span class="p">):</span>
    <span class="n">INT</span> <span class="o">=</span> <span class="nb">int</span>
    <span class="n">FLOAT</span> <span class="o">=</span> <span class="nb">float</span>
    <span class="n">SIGNED_FLOAT</span> <span class="o">=</span> <span class="nb">float</span>
    <span class="n">WORD</span> <span class="o">=</span> <span class="nb">str</span>
    <span class="n">NON_SEPARATOR_STRING</span> <span class="o">=</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="nf">row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">children</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">children</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">children</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">header</span> <span class="o">=</span> <span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">children</span>
        <span class="k">for</span> <span class="n">heading</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="n">heading</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">data</span><span class="p">[</span><span class="n">header</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-composition-eval-csv-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/47174f1088585b541b7296c461639c79/eval_csv.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">eval_csv.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/de026e34f2e30342f31740044e683d7b/eval_csv.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">eval_csv.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
<span id="document-examples/composition/main"></span><div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-composition-main-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="grammar-composition">
<span id="sphx-glr-examples-composition-main-py"></span><h4>Grammar Composition<a class="headerlink" href="#grammar-composition" title="Permalink to this heading"></a></h4>
<p>This example shows how to do grammar composition in Lark, by creating a new
file format that allows both CSV and JSON to co-exist.</p>
<ol class="arabic simple">
<li><p>We define <code class="docutils literal notranslate"><span class="pre">storage.lark</span></code>, which imports both <code class="docutils literal notranslate"><span class="pre">csv.lark</span></code> and <code class="docutils literal notranslate"><span class="pre">json.lark</span></code>,</p></li>
</ol>
<blockquote>
<div><p>and allows them to be used one after the other.</p>
<p>In the generated tree, each imported rule/terminal is automatically prefixed (with <code class="docutils literal notranslate"><span class="pre">json__</span></code> or <a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">csv__</span></a>),
which creates an implicit namespace and allows them to coexist without collisions.</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>We merge their respective transformers (unaware of each other) into a new base transformer.
The resulting transformer can evaluate both JSON and CSV in the parse tree.</p></li>
</ol>
<blockquote>
<div><p>The methods of each transformer are renamed into their appropriate namespace, using the given prefix.
This approach allows full re-use: the transformers don’t need to care if their grammar is used directly,
or being imported, or who is doing the importing.</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span>
<span class="kn">from</span> <span class="nn">json</span> <span class="kn">import</span> <span class="n">dumps</span>
<span class="kn">from</span> <span class="nn">lark.visitors</span> <span class="kn">import</span> <span class="n">Transformer</span><span class="p">,</span> <span class="n">merge_transformers</span>

<span class="kn">from</span> <span class="nn">eval_csv</span> <span class="kn">import</span> <span class="n">CsvTreeToPandasDict</span>
<span class="kn">from</span> <span class="nn">eval_json</span> <span class="kn">import</span> <span class="n">JsonTreeToJson</span>

<span class="fm">__dir__</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>

<span class="k">class</span> <span class="nc">Storage</span><span class="p">(</span><span class="n">Transformer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">children</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">children</span>

<span class="n">storage_transformer</span> <span class="o">=</span> <span class="n">merge_transformers</span><span class="p">(</span><span class="n">Storage</span><span class="p">(),</span> <span class="n">csv</span><span class="o">=</span><span class="n">CsvTreeToPandasDict</span><span class="p">(),</span> <span class="n">json</span><span class="o">=</span><span class="n">JsonTreeToJson</span><span class="p">())</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;storage.lark&quot;</span><span class="p">,</span> <span class="n">rel_to</span><span class="o">=</span><span class="vm">__file__</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">json_tree</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;dict&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;list&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">]</span> <span class="p">}}))</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">storage_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">json_tree</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Just JSON: &quot;</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>

    <span class="n">csv_json_tree</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="fm">__dir__</span> <span class="o">/</span> <span class="s1">&#39;combined_csv_and_json.txt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">storage_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">csv_json_tree</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JSON + CSV: &quot;</span><span class="p">,</span> <span class="n">dumps</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-composition-main-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/98afe2f1c3b9485fcb8bdeebbbf0234f/main.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">main.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/9edfb38ad3bc19fc2b92c728275b9008/main.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">main.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</div>
</section>
<span id="document-examples/grammars/index"></span><section id="example-grammars">
<span id="sphx-glr-examples-grammars"></span><h3>Example Grammars<a class="headerlink" href="#example-grammars" title="Permalink to this heading"></a></h3>
<p>This directory is a collection of lark grammars, taken from real world projects.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/lark-parser/lark/blob/master/examples/grammars/verilog.lark">Verilog</a> - Taken from <a class="reference external" href="https://github.com/circuitgraph/circuitgraph/blob/main/circuitgraph/parsing/verilog.lark">https://github.com/circuitgraph/circuitgraph/blob/main/circuitgraph/parsing/verilog.lark</a></p></li>
</ul>
<div class="sphx-glr-thumbnails"></div></section>
<span id="document-examples/standalone/index"></span><section id="standalone-example">
<span id="sphx-glr-examples-standalone"></span><h3>Standalone example<a class="headerlink" href="#standalone-example" title="Permalink to this heading"></a></h3>
<p>To initialize, cd to this folder, and run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./create_standalone.sh
</pre></div>
</div>
<p>Or:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>lark.tools.standalone<span class="w"> </span>json.lark<span class="w"> </span>&gt;<span class="w"> </span>json_parser.py
</pre></div>
</div>
<p>Then run using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>json_parser_main.py<span class="w"> </span>&lt;path-to.json&gt;
</pre></div>
</div>
<div class="sphx-glr-thumbnails"><div class="sphx-glr-thumbcontainer" tooltip="    This example demonstrates how to generate and use the standalone parser,     using the JSON..."><img alt="" src="_images/sphx_glr_json_parser_main_thumb.png" />
<p><a class="reference internal" href="index.html#sphx-glr-examples-standalone-json-parser-main-py"><span class="std std-ref">Standalone Parser</span></a></p>
  <div class="sphx-glr-thumbnail-title">Standalone Parser</div>
</div></div><div class="toctree-wrapper compound">
<span id="document-examples/standalone/json_parser_main"></span><div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-standalone-json-parser-main-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="standalone-parser">
<span id="sphx-glr-examples-standalone-json-parser-main-py"></span><h4>Standalone Parser<a class="headerlink" href="#standalone-parser" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>This example demonstrates how to generate and use the standalone parser,
using the JSON example.</p>
<p>See README.md for more details.</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">json_parser</span> <span class="kn">import</span> <span class="n">Lark_StandAlone</span><span class="p">,</span> <span class="n">Transformer</span><span class="p">,</span> <span class="n">v_args</span>

<span class="n">inline_args</span> <span class="o">=</span> <span class="n">v_args</span><span class="p">(</span><span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">TreeToJson</span><span class="p">(</span><span class="n">Transformer</span><span class="p">):</span>
    <span class="nd">@inline_args</span>
    <span class="k">def</span> <span class="nf">string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>

    <span class="n">array</span> <span class="o">=</span> <span class="nb">list</span>
    <span class="n">pair</span> <span class="o">=</span> <span class="nb">tuple</span>
    <span class="nb">object</span> <span class="o">=</span> <span class="nb">dict</span>
    <span class="n">number</span> <span class="o">=</span> <span class="n">inline_args</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">null</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="kc">None</span>
    <span class="n">true</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="kc">True</span>
    <span class="n">false</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="kc">False</span>


<span class="n">parser</span> <span class="o">=</span> <span class="n">Lark_StandAlone</span><span class="p">(</span><span class="n">transformer</span><span class="o">=</span><span class="n">TreeToJson</span><span class="p">())</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-standalone-json-parser-main-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/55c526745700131cb7096e508b392be7/json_parser_main.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">json_parser_main.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/222c07e0396620c7fabb1da7fda69ca9/json_parser_main.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">json_parser_main.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</div>
</section>
</div>
<div class="sphx-glr-footer sphx-glr-footer-gallery docutils container">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="_downloads/bc82bea3a5dd7bdba60b65220891d9e5/examples_python.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">all</span> <span class="pre">examples</span> <span class="pre">in</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">examples_python.zip</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="_downloads/fb625db3c50d423b1b7881136ffdeec8/examples_jupyter.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">all</span> <span class="pre">examples</span> <span class="pre">in</span> <span class="pre">Jupyter</span> <span class="pre">notebooks:</span> <span class="pre">examples_jupyter.zip</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</div>
<div class="toctree-wrapper compound">
<span id="document-grammar"></span><section id="grammar-reference">
<h2>Grammar Reference<a class="headerlink" href="#grammar-reference" title="Permalink to this heading"></a></h2>
<section id="definitions">
<h3>Definitions<a class="headerlink" href="#definitions" title="Permalink to this heading"></a></h3>
<p>A <strong>grammar</strong> is a list of rules and terminals, that together define a language.</p>
<p>Terminals define the alphabet of the language, while rules define its structure.</p>
<p>In Lark, a terminal may be a string, a regular expression, or a concatenation of these and other terminals.</p>
<p>Each rule is a list of terminals and rules, whose location and nesting define the structure of the resulting parse-tree.</p>
<p>A <strong>parsing algorithm</strong> is an algorithm that takes a grammar definition and a sequence of symbols (members of the alphabet), and matches the entirety of the sequence by searching for a structure that is allowed by the grammar.</p>
<section id="general-syntax-and-notes">
<h4>General Syntax and notes<a class="headerlink" href="#general-syntax-and-notes" title="Permalink to this heading"></a></h4>
<p>Grammars in Lark are based on <a class="reference external" href="https://en.wikipedia.org/wiki/Extended_Backus%E2%80%93Naur_form">EBNF</a> syntax, with several enhancements.</p>
<p>EBNF is basically a short-hand for common BNF patterns.</p>
<p>Optionals are expanded:</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">a</span><span class="w"> </span><span class="n">b?</span><span class="w"> </span><span class="n">c</span><span class="w">    </span><span class="o">-&gt;</span><span class="w">    </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
<p>Repetition is extracted into a recursion:</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="ss">a</span><span class="p">:</span><span class="w"> </span><span class="n">b</span><span class="o">*</span><span class="w">    </span><span class="o">-&gt;</span><span class="w">    </span><span class="ss">a</span><span class="p">:</span><span class="w"> </span><span class="n">_b_tag</span>
<span class="w">                 </span><span class="ss">_b_tag</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">_b_tag</span><span class="w"> </span><span class="n">b</span><span class="p">)?</span>
</pre></div>
</div>
<p>And so on.</p>
<p>Lark grammars are composed of a list of definitions and directives, each on its own line. A definition is either a named rule, or a named terminal, with the following syntax, respectively:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>  rule: <span class="p">&lt;</span><span class="nt">EBNF-EXPRESSION</span><span class="p">&gt;</span>
      | etc.

  TERM: <span class="p">&lt;</span><span class="nt">EBNF-EXPRESSION</span><span class="p">&gt;</span>   // Rules aren&#39;t allowed
</pre></div>
</div>
<p><strong>Comments</strong> start with
either <code class="docutils literal notranslate"><span class="pre">//</span></code> (C++ style) or <code class="docutils literal notranslate"><span class="pre">#</span></code> (Python style, since version 1.1.6)
and last to the end of the line.</p>
<p>Lark begins the parse with the rule ‘start’, unless specified otherwise in the options.</p>
<p>Names of rules are always in lowercase, while names of terminals are always in uppercase. This distinction has practical effects, for the shape of the generated parse-tree, and the automatic construction of the lexer (aka tokenizer, or scanner).</p>
</section>
</section>
<section id="terminals">
<h3>Terminals<a class="headerlink" href="#terminals" title="Permalink to this heading"></a></h3>
<p>Terminals are used to match text into symbols. They can be defined as a combination of literals and other terminals.</p>
<p><strong>Syntax:</strong></p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">NAME</span><span class="p">&gt;</span> [. <span class="p">&lt;</span><span class="nt">priority</span><span class="p">&gt;</span>] : <span class="p">&lt;</span><span class="nt">literals-and-or-terminals</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Terminal names must be uppercase.</p>
<p>Literals can be one of:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;string&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/regular</span> <span class="pre">expression+/</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;case-insensitive</span> <span class="pre">string&quot;i</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/re</span> <span class="pre">with</span> <span class="pre">flags/imulx</span></code></p></li>
<li><p>Literal range: <code class="docutils literal notranslate"><span class="pre">&quot;a&quot;..&quot;z&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;1&quot;..&quot;9&quot;</span></code>, etc.</p></li>
</ul>
<p>Terminals also support grammar operators, such as <code class="docutils literal notranslate"><span class="pre">|</span></code>, <code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">*</span></code> and <code class="docutils literal notranslate"><span class="pre">?</span></code>.</p>
<p>Terminals are a linear construct, and therefore may not contain themselves (recursion isn’t allowed).</p>
<section id="templates">
<h4>Templates<a class="headerlink" href="#templates" title="Permalink to this heading"></a></h4>
<p>Templates are expanded when preprocessing the grammar.</p>
<p>Definition syntax:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nx">my_template</span><span class="p">{</span><span class="nx">param1</span><span class="p">,</span><span class="w"> </span><span class="nx">param2</span><span class="p">,</span><span class="w"> </span><span class="p">...}</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">EBNF</span><span class="w"> </span><span class="nx">EXPRESSION</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Use syntax:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">some_rule</span><span class="o">:</span><span class="w"> </span><span class="nx">my_template</span><span class="p">{</span><span class="nx">arg1</span><span class="p">,</span><span class="w"> </span><span class="nx">arg2</span><span class="p">,</span><span class="w"> </span><span class="p">...}</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">_separated</span><span class="p">{</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">sep</span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="p">(</span><span class="nx">sep</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span><span class="o">*</span><span class="w">  </span><span class="c1">// Define a sequence of &#39;x sep x sep x ...&#39;</span>

<span class="nx">num_list</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;[&quot;</span><span class="w"> </span><span class="nx">_separated</span><span class="p">{</span><span class="nx">NUMBER</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;,&quot;</span><span class="p">}</span><span class="w"> </span><span class="s2">&quot;]&quot;</span><span class="w">   </span><span class="c1">// Will match &quot;[1, 2, 3]&quot; etc.</span>
</pre></div>
</div>
</section>
<section id="priority">
<h4>Priority<a class="headerlink" href="#priority" title="Permalink to this heading"></a></h4>
<p>Terminals can be assigned a priority to influence lexing. Terminal priorities
are signed integers with a default value of 0.</p>
<p>When using a lexer, the highest priority terminals are always matched first.</p>
<p>When using Earley’s dynamic lexing, terminal priorities are used to prefer
certain lexings and resolve ambiguity.</p>
</section>
<section id="regexp-flags">
<h4>Regexp Flags<a class="headerlink" href="#regexp-flags" title="Permalink to this heading"></a></h4>
<p>You can use flags on regexps and strings. For example:</p>
<div class="highlight-perl notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT:</span><span class="w"> </span><span class="s">&quot;select&quot;</span><span class="n">i</span><span class="w">     </span><span class="sr">//</span><span class="c1"># Will ignore case, and match SELECT or Select, etc.</span>
<span class="n">MULTILINE_TEXT:</span><span class="w"> </span><span class="sr">/.+/s</span>
<span class="n">SIGNED_INTEGER:</span><span class="w"> </span><span class="o">/</span>
<span class="w">    </span><span class="p">[</span><span class="o">+-</span><span class="p">]?</span><span class="w">  </span><span class="c1"># the sign</span>
<span class="w">    </span><span class="p">(</span><span class="mi">0</span><span class="o">|</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">][</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="p">)</span><span class="w">  </span><span class="c1"># the digits</span>
<span class="w"> </span><span class="o">/</span><span class="n">x</span>
</pre></div>
</div>
<p>Supported flags are one of: <code class="docutils literal notranslate"><span class="pre">imslux</span></code>. See Python’s regex documentation for more details on each one.</p>
<p>Regexps/strings of different flags can only be concatenated in Python 3.6+</p>
<section id="notes-for-when-using-a-lexer">
<h5>Notes for when using a lexer:<a class="headerlink" href="#notes-for-when-using-a-lexer" title="Permalink to this heading"></a></h5>
<p>When using a lexer (basic or contextual), it is the grammar-author’s responsibility to make sure the literals don’t collide, or that if they do, they are matched in the desired order. Literals are matched according to the following precedence:</p>
<ol class="simple">
<li><p>Highest priority first (priority is specified as: TERM.number: …)</p></li>
<li><p>Length of match (for regexps, the longest theoretical match is used)</p></li>
<li><p>Length of literal / pattern definition</p></li>
<li><p>Name</p></li>
</ol>
<p><strong>Examples:</strong></p>
<div class="highlight-perl notranslate"><div class="highlight"><pre><span></span><span class="n">IF:</span><span class="w"> </span><span class="s">&quot;if&quot;</span>
<span class="n">INTEGER</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="sr">/[0-9]+/</span>
<span class="n">INTEGER2</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;0&quot;</span><span class="o">..</span><span class="s">&quot;9&quot;</span><span class="p">)</span><span class="o">+</span><span class="w">          </span><span class="sr">//</span><span class="c1"># Same as INTEGER</span>
<span class="n">DECIMAL</span><span class="mf">.2</span><span class="p">:</span><span class="w"> </span><span class="n">INTEGER</span><span class="p">?</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="w"> </span><span class="n">INTEGER</span><span class="w">  </span><span class="sr">//</span><span class="c1"># Will be matched before INTEGER</span>
<span class="n">WHITESPACE:</span><span class="w"> </span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sr">/\t/</span><span class="w"> </span><span class="p">)</span><span class="o">+</span>
<span class="n">SQL_SELECT:</span><span class="w"> </span><span class="s">&quot;select&quot;</span><span class="n">i</span>
</pre></div>
</div>
</section>
</section>
<section id="regular-expressions-ambiguity">
<h4>Regular expressions &amp; Ambiguity<a class="headerlink" href="#regular-expressions-ambiguity" title="Permalink to this heading"></a></h4>
<p>Each terminal is eventually compiled to a regular expression. All the operators and references inside it are mapped to their respective expressions.</p>
<p>For example, in the following grammar, <code class="docutils literal notranslate"><span class="pre">A1</span></code> and <code class="docutils literal notranslate"><span class="pre">A2</span></code>, are equivalent:</p>
<div class="highlight-perl notranslate"><div class="highlight"><pre><span></span><span class="n">A1:</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;b&quot;</span>
<span class="n">A2:</span><span class="w"> </span><span class="sr">/a|b/</span>
</pre></div>
</div>
<p>This means that inside terminals, Lark cannot detect or resolve ambiguity, even when using Earley.</p>
<p>For example, for this grammar:</p>
<div class="highlight-perl notranslate"><div class="highlight"><pre><span></span><span class="n">start</span><span class="w">           </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">B</span><span class="p">)</span><span class="o">+</span>
<span class="n">A</span><span class="w">               </span><span class="p">:</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;ab&quot;</span>
<span class="n">B</span><span class="w">               </span><span class="p">:</span><span class="w"> </span><span class="s">&quot;b&quot;</span>
</pre></div>
</div>
<p>We get only one possible derivation, instead of two:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt;<span class="w"> </span><span class="nv">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Lark<span class="o">(</span>g,<span class="w"> </span><span class="nv">ambiguity</span><span class="o">=</span><span class="s2">&quot;explicit&quot;</span><span class="o">)</span>
&gt;&gt;&gt;<span class="w"> </span>p.parse<span class="o">(</span><span class="s2">&quot;ab&quot;</span><span class="o">)</span>
Tree<span class="o">(</span><span class="s1">&#39;start&#39;</span>,<span class="w"> </span><span class="o">[</span>Token<span class="o">(</span><span class="s1">&#39;A&#39;</span>,<span class="w"> </span><span class="s1">&#39;ab&#39;</span><span class="o">)])</span>
</pre></div>
</div>
<p>This is happening because Python’s regex engine always returns the best matching option. There is no way to access the alternatives.</p>
<p>If you find yourself in this situation, the recommended solution is to either use the “dynamic_complete” lexer, or use rules instead.</p>
<p>Example using rules:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;start: (a | b)+</span>
<span class="gp">... </span><span class="s2">            !a: &quot;a&quot; | &quot;ab&quot;</span>
<span class="gp">... </span><span class="s2">            !b: &quot;b&quot;</span>
<span class="gp">... </span><span class="s2">            &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">ambiguity</span><span class="o">=</span><span class="s2">&quot;explicit&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;ab&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pretty</span><span class="p">())</span>
<span class="go">_ambig</span>
<span class="go">  start</span>
<span class="go">    a   ab</span>
<span class="go">  start</span>
<span class="go">    a   a</span>
<span class="go">    b   b</span>
</pre></div>
</div>
<p>Example using dynamic-complete:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="s2">    start: (A | B)+</span>
<span class="gp">... </span><span class="s2">    A    : &quot;a&quot; | &quot;ab&quot;</span>
<span class="gp">... </span><span class="s2">    B    : &quot;b&quot;</span>
<span class="gp">... </span><span class="s2">&quot;&quot;&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">ambiguity</span><span class="o">=</span><span class="s2">&quot;explicit&quot;</span><span class="p">,</span> <span class="n">lexer</span><span class="o">=</span><span class="s2">&quot;dynamic_complete&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;ab&quot;</span><span class="p">))</span>
<span class="go">_ambig</span>
<span class="go">├── start</span>
<span class="go">│   └── ab</span>
<span class="go">└── start</span>
<span class="go">    ├── a</span>
<span class="go">    └── b</span>
</pre></div>
</div>
<p>(note: the dynamic-complete lexer can significantly affect the performance of the parser)</p>
</section>
</section>
<section id="rules">
<h3>Rules<a class="headerlink" href="#rules" title="Permalink to this heading"></a></h3>
<p><strong>Syntax:</strong></p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">name</span><span class="p">&gt;</span> : <span class="p">&lt;</span><span class="nt">items-to-match</span><span class="p">&gt;</span>  [-&gt; <span class="p">&lt;</span><span class="nt">alias</span><span class="p">&gt;</span> ]
       | ...
</pre></div>
</div>
<p>Names of rules and aliases are always in lowercase.</p>
<p>Rule definitions can be extended to the next line by using the OR operator (signified by a pipe: <code class="docutils literal notranslate"><span class="pre">|</span></code> ).</p>
<p>An alias is a name for the specific rule alternative. It affects tree construction.</p>
<p>Each item is one of:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">rule</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TERMINAL</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;string</span> <span class="pre">literal&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">/regexp</span> <span class="pre">literal/</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">(item</span> <span class="pre">item</span> <span class="pre">..)</span></code> - Group items</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[item</span> <span class="pre">item</span> <span class="pre">..]</span></code> - Maybe. Same as <code class="docutils literal notranslate"><span class="pre">(item</span> <span class="pre">item</span> <span class="pre">..)?</span></code>, but when <code class="docutils literal notranslate"><span class="pre">maybe_placeholders=True</span></code>, generates <code class="docutils literal notranslate"><span class="pre">None</span></code> if there is no match.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">item?</span></code> - Zero or one instances of item (”maybe”)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">item*</span></code> - Zero or more instances of item</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">item+</span></code> - One or more instances of item</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">item</span> <span class="pre">~</span> <span class="pre">n</span></code> - Exactly <em>n</em> instances of item</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">item</span> <span class="pre">~</span> <span class="pre">n..m</span></code> - Between <em>n</em> to <em>m</em> instances of item (not recommended for wide ranges, due to performance issues)</p></li>
</ul>
<p>Note that all operators, including <code class="docutils literal notranslate"><span class="pre">~</span> <span class="pre">n</span></code>, apply directly to the item on their left.
For instance <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">~</span> <span class="pre">2</span> <span class="pre">b</span> <span class="pre">~</span> <span class="pre">3</span></code> is parsed as <code class="docutils literal notranslate"><span class="pre">(a</span> <span class="pre">~</span> <span class="pre">2)</span> <span class="pre">(b</span> <span class="pre">~</span> <span class="pre">3)</span></code>.</p>
<p><strong>Examples:</strong></p>
<div class="highlight-perl notranslate"><div class="highlight"><pre><span></span><span class="n">hello_world:</span><span class="w"> </span><span class="s">&quot;hello&quot;</span><span class="w"> </span><span class="s">&quot;world&quot;</span>
<span class="n">mul:</span><span class="w"> </span><span class="p">(</span><span class="n">mul</span><span class="w"> </span><span class="s">&quot;*&quot;</span><span class="p">)?</span><span class="w"> </span><span class="n">number</span><span class="w">     </span><span class="sr">//</span><span class="c1"># Left-recursion is allowed and encouraged!</span>
<span class="n">expr:</span><span class="w"> </span><span class="n">expr</span><span class="w"> </span><span class="n">operator</span><span class="w"> </span><span class="n">expr</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">value</span><span class="w">               </span><span class="sr">//</span><span class="c1"># Multi-line, belongs to expr</span>

<span class="n">four_words:</span><span class="w"> </span><span class="n">word</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="mi">4</span>
</pre></div>
</div>
<section id="id1">
<h4>Priority<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h4>
<p>Like terminals, rules can be assigned a priority. Rule priorities are signed
integers with a default value of 0.</p>
<p>When using LALR, the highest priority rules are used to resolve collision errors.</p>
<p>When using Earley, rule priorities are used to resolve ambiguity.</p>
<p><a name="dirs"></a></p>
</section>
</section>
<section id="directives">
<h3>Directives<a class="headerlink" href="#directives" title="Permalink to this heading"></a></h3>
<section id="ignore">
<h4>%ignore<a class="headerlink" href="#ignore" title="Permalink to this heading"></a></h4>
<p>All occurrences of the terminal will be ignored, and won’t be part of the parse.</p>
<p>Using the <code class="docutils literal notranslate"><span class="pre">%ignore</span></code> directive results in a cleaner grammar.</p>
<p>It’s especially important for the LALR(1) algorithm, because adding whitespace (or comments, or other extraneous elements) explicitly in the grammar, harms its predictive abilities, which are based on a lookahead of 1.</p>
<p><strong>Syntax:</strong></p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>%ignore <span class="p">&lt;</span><span class="nt">TERMINAL</span><span class="p">&gt;</span>
</pre></div>
</div>
<p><strong>Examples:</strong></p>
<div class="highlight-perl notranslate"><div class="highlight"><pre><span></span><span class="nv">%ignore</span><span class="w"> </span><span class="s">&quot; &quot;</span>

<span class="n">COMMENT:</span><span class="w"> </span><span class="s">&quot;#&quot;</span><span class="w"> </span><span class="sr">/[^\n]/</span><span class="o">*</span>
<span class="nv">%ignore</span><span class="w"> </span><span class="n">COMMENT</span>
</pre></div>
</div>
</section>
<section id="import">
<h4>%import<a class="headerlink" href="#import" title="Permalink to this heading"></a></h4>
<p>Allows one to import terminals and rules from lark grammars.</p>
<p>When importing rules, all their dependencies will be imported into a namespace, to avoid collisions. To override any of their dependencies (e.g. like you would override methods when inheriting a class), use the <code class="docutils literal notranslate"><span class="pre">%override</span></code> directive.</p>
<p><strong>Syntax:</strong></p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>%import <span class="p">&lt;</span><span class="nt">module</span><span class="p">&gt;</span>.<span class="p">&lt;</span><span class="nt">TERMINAL</span><span class="p">&gt;</span>
%import <span class="p">&lt;</span><span class="nt">module</span><span class="p">&gt;</span>.<span class="p">&lt;</span><span class="nt">rule</span><span class="p">&gt;</span>
%import <span class="p">&lt;</span><span class="nt">module</span><span class="p">&gt;</span>.<span class="p">&lt;</span><span class="nt">TERMINAL</span><span class="p">&gt;</span> -&gt; <span class="p">&lt;</span><span class="nt">NEWTERMINAL</span><span class="p">&gt;</span>
%import <span class="p">&lt;</span><span class="nt">module</span><span class="p">&gt;</span>.<span class="p">&lt;</span><span class="nt">rule</span><span class="p">&gt;</span> -&gt; <span class="p">&lt;</span><span class="nt">newrule</span><span class="p">&gt;</span>
%import <span class="p">&lt;</span><span class="nt">module</span><span class="p">&gt;</span> (<span class="p">&lt;</span><span class="nt">TERM1</span><span class="p">&gt;</span>, <span class="p">&lt;</span><span class="nt">TERM2</span><span class="p">&gt;</span>, <span class="p">&lt;</span><span class="nt">rule1</span><span class="p">&gt;</span>, <span class="p">&lt;</span><span class="nt">rule2</span><span class="p">&gt;</span>)
</pre></div>
</div>
<p>If the module path is absolute, Lark will attempt to load it from the built-in directory (which currently contains <code class="docutils literal notranslate"><span class="pre">common.lark</span></code>, <code class="docutils literal notranslate"><span class="pre">lark.lark</span></code>, <code class="docutils literal notranslate"><span class="pre">python.lark</span></code>, and <code class="docutils literal notranslate"><span class="pre">unicode.lark</span></code>).</p>
<p>If the module path is relative, such as <code class="docutils literal notranslate"><span class="pre">.path.to.file</span></code>, Lark will attempt to load it from the current working directory. Grammars must have the <code class="docutils literal notranslate"><span class="pre">.lark</span></code> extension.</p>
<p>The rule or terminal can be imported under another name (an alias) with the <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> syntax.</p>
<p><strong>Example:</strong></p>
<div class="highlight-perl notranslate"><div class="highlight"><pre><span></span><span class="nv">%import</span><span class="w"> </span><span class="n">common</span><span class="o">.</span><span class="n">NUMBER</span>

<span class="nv">%import</span><span class="w"> </span><span class="o">.</span><span class="n">terminals_file</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">)</span>

<span class="nv">%import</span><span class="w"> </span><span class="o">.</span><span class="n">rules_file</span><span class="o">.</span><span class="nn">rule_a</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">rule_b</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">%ignore</span></code> directives cannot be imported. Imported rules will abide by the <code class="docutils literal notranslate"><span class="pre">%ignore</span></code> directives declared in the main grammar.</p>
</section>
<section id="declare">
<h4>%declare<a class="headerlink" href="#declare" title="Permalink to this heading"></a></h4>
<p>Declare a terminal without defining it. Useful for plugins.</p>
</section>
<section id="override">
<h4>%override<a class="headerlink" href="#override" title="Permalink to this heading"></a></h4>
<p>Override a rule or terminals, affecting all references to it, even in imported grammars.</p>
<p>Useful for implementing an inheritance pattern when importing grammars.</p>
<p><strong>Example:</strong></p>
<div class="highlight-perl notranslate"><div class="highlight"><pre><span></span><span class="nv">%import</span><span class="w"> </span><span class="n">my_grammar</span><span class="w"> </span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">number</span><span class="p">,</span><span class="w"> </span><span class="n">NUMBER</span><span class="p">)</span>

<span class="sr">//</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="nb">hex</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">my_grammar</span>
<span class="nv">%override</span><span class="w"> </span><span class="n">number:</span><span class="w"> </span><span class="n">NUMBER</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sr">/0x\w+/</span>
</pre></div>
</div>
</section>
<section id="extend">
<h4>%extend<a class="headerlink" href="#extend" title="Permalink to this heading"></a></h4>
<p>Extend the definition of a rule or terminal, e.g. add a new option on what it can match, like when separated with <code class="docutils literal notranslate"><span class="pre">|</span></code>.</p>
<p>Useful for splitting up a definition of a complex rule with many different options over multiple files.</p>
<p>Can also be used to implement a plugin system where a core grammar is extended by others.</p>
<p><strong>Example:</strong></p>
<div class="highlight-perl notranslate"><div class="highlight"><pre><span></span><span class="nv">%import</span><span class="w"> </span><span class="n">my_grammar</span><span class="w"> </span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">NUMBER</span><span class="p">)</span>

<span class="sr">//</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="nb">hex</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">my_grammar</span>
<span class="nv">%extend</span><span class="w"> </span><span class="n">NUMBER:</span><span class="w"> </span><span class="sr">/0x\w+/</span>
</pre></div>
</div>
<p>For both <code class="docutils literal notranslate"><span class="pre">%extend</span></code> and <code class="docutils literal notranslate"><span class="pre">%override</span></code>, there is not requirement for a rule/terminal to come from another file, but that is probably the most common use-case.</p>
</section>
</section>
</section>
<span id="document-tree_construction"></span><section id="tree-construction-reference">
<h2>Tree Construction Reference<a class="headerlink" href="#tree-construction-reference" title="Permalink to this heading"></a></h2>
<p>Lark builds a tree automatically based on the structure of the grammar, where each rule that is matched becomes a branch (node) in the tree, and its children are its matches, in the order of matching.</p>
<p>For example, the rule <code class="docutils literal notranslate"><span class="pre">node:</span> <span class="pre">child1</span> <span class="pre">child2</span></code> will create a tree node with two children. If it is matched as part of another rule (i.e. if it isn’t the root), the new rule’s tree node will become its parent.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">item+</span></code> or <code class="docutils literal notranslate"><span class="pre">item*</span></code> will result in a list of items, equivalent to writing <code class="docutils literal notranslate"><span class="pre">item</span> <span class="pre">item</span> <span class="pre">item</span> <span class="pre">..</span></code>.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">item?</span></code> will return the item if it matched, or nothing.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">maybe_placeholders=True</span></code> (the default), then using <code class="docutils literal notranslate"><span class="pre">[item]</span></code> will return the item if it matched, or the value <code class="docutils literal notranslate"><span class="pre">None</span></code>, if it didn’t.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">maybe_placeholders=False</span></code>, then <code class="docutils literal notranslate"><span class="pre">[]</span></code> behaves like <code class="docutils literal notranslate"><span class="pre">()?</span></code>.</p>
<section id="terminals">
<h3>Terminals<a class="headerlink" href="#terminals" title="Permalink to this heading"></a></h3>
<p>Terminals are always values in the tree, never branches.</p>
<p>Lark filters out certain types of terminals by default, considering them punctuation:</p>
<ul class="simple">
<li><p>Terminals that won’t appear in the tree are:</p>
<ul>
<li><p>Unnamed literals (like <code class="docutils literal notranslate"><span class="pre">&quot;keyword&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;+&quot;</span></code>)</p></li>
<li><p>Terminals whose name starts with an underscore (like <code class="docutils literal notranslate"><span class="pre">_DIGIT</span></code>)</p></li>
</ul>
</li>
<li><p>Terminals that <em>will</em> appear in the tree are:</p>
<ul>
<li><p>Unnamed regular expressions (like <code class="docutils literal notranslate"><span class="pre">/[0-9]/</span></code>)</p></li>
<li><p>Named terminals whose name starts with a letter (like <code class="docutils literal notranslate"><span class="pre">DIGIT</span></code>)</p></li>
</ul>
</li>
</ul>
<p>Note: Terminals composed of literals and other terminals always include the entire match without filtering any part.</p>
<p><strong>Example:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">start</span><span class="p">:</span>  <span class="n">PNAME</span> <span class="n">pname</span>

<span class="n">PNAME</span><span class="p">:</span>  <span class="s2">&quot;(&quot;</span> <span class="n">NAME</span> <span class="s2">&quot;)&quot;</span>
<span class="n">pname</span><span class="p">:</span>  <span class="s2">&quot;(&quot;</span> <span class="n">NAME</span> <span class="s2">&quot;)&quot;</span>

<span class="n">NAME</span><span class="p">:</span>   <span class="o">/</span>\<span class="n">w</span><span class="o">+/</span>
<span class="o">%</span><span class="n">ignore</span> <span class="o">/</span>\<span class="n">s</span><span class="o">+/</span>
</pre></div>
</div>
<p>Lark will parse “(Hello) (World)” as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">start</span>
    <span class="p">(</span><span class="n">Hello</span><span class="p">)</span>
    <span class="n">pname</span> <span class="n">World</span>
</pre></div>
</div>
<p>Rules prefixed with <code class="docutils literal notranslate"><span class="pre">!</span></code> will retain all their literals regardless.</p>
<p><strong>Example:</strong></p>
<div class="highlight-perl notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="n">expr:</span><span class="w"> </span><span class="s">&quot;(&quot;</span><span class="w"> </span><span class="n">expr</span><span class="w"> </span><span class="s">&quot;)&quot;</span>
<span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">NAME</span><span class="o">+</span>

<span class="w">    </span><span class="n">NAME:</span><span class="w"> </span><span class="sr">/\w+/</span>

<span class="w">    </span><span class="nv">%ignore</span><span class="w"> </span><span class="s">&quot; &quot;</span>
</pre></div>
</div>
<p>Lark will parse “((hello world))” as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">expr</span>
    <span class="n">expr</span>
        <span class="n">expr</span>
            <span class="s2">&quot;hello&quot;</span>
            <span class="s2">&quot;world&quot;</span>
</pre></div>
</div>
<p>The brackets do not appear in the tree by design. The words appear because they are matched by a named terminal.</p>
</section>
<section id="shaping-the-tree">
<h3>Shaping the tree<a class="headerlink" href="#shaping-the-tree" title="Permalink to this heading"></a></h3>
<p>Users can alter the automatic construction of the tree using a collection of grammar features.</p>
<section id="inlining-rules-with">
<h4>Inlining rules with <code class="docutils literal notranslate"><span class="pre">_</span></code><a class="headerlink" href="#inlining-rules-with" title="Permalink to this heading"></a></h4>
<p>Rules whose name begins with an underscore will be inlined into their containing rule.</p>
<p><strong>Example:</strong></p>
<div class="highlight-perl notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="n">start:</span><span class="w"> </span><span class="s">&quot;(&quot;</span><span class="w"> </span><span class="n">_greet</span><span class="w"> </span><span class="s">&quot;)&quot;</span>
<span class="w">    </span><span class="n">_greet:</span><span class="w"> </span><span class="sr">/\w+/</span><span class="w"> </span><span class="sr">/\w+/</span>
</pre></div>
</div>
<p>Lark will parse “(hello world)” as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">start</span>
    <span class="s2">&quot;hello&quot;</span>
    <span class="s2">&quot;world&quot;</span>
</pre></div>
</div>
</section>
<section id="conditionally-inlining-rules-with">
<h4>Conditionally inlining rules with <code class="docutils literal notranslate"><span class="pre">?</span></code><a class="headerlink" href="#conditionally-inlining-rules-with" title="Permalink to this heading"></a></h4>
<p>Rules that receive a question mark (?) at the beginning of their definition, will be inlined if they have a single child, after filtering.</p>
<p><strong>Example:</strong></p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="ss">start</span><span class="p">:</span><span class="w"> </span><span class="n">greet</span><span class="w"> </span><span class="n">greet</span>
<span class="w">    </span><span class="p">?</span><span class="ss">greet</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;(&quot;</span><span class="w"> </span><span class="sr">/\w+/</span><span class="w"> </span><span class="s2">&quot;)&quot;</span>
<span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="sr">/\w+/</span><span class="w"> </span><span class="sr">/\w+/</span>
</pre></div>
</div>
<p>Lark will parse “hello world (planet)” as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">start</span>
    <span class="n">greet</span>
        <span class="s2">&quot;hello&quot;</span>
        <span class="s2">&quot;world&quot;</span>
    <span class="s2">&quot;planet&quot;</span>
</pre></div>
</div>
</section>
<section id="pinning-rule-terminals-with">
<h4>Pinning rule terminals with <code class="docutils literal notranslate"><span class="pre">!</span></code><a class="headerlink" href="#pinning-rule-terminals-with" title="Permalink to this heading"></a></h4>
<p>Rules that begin with an exclamation mark will keep all their terminals (they won’t get filtered).</p>
<div class="highlight-perl notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="o">!</span><span class="n">expr:</span><span class="w"> </span><span class="s">&quot;(&quot;</span><span class="w"> </span><span class="n">expr</span><span class="w"> </span><span class="s">&quot;)&quot;</span>
<span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">NAME</span><span class="o">+</span>
<span class="w">    </span><span class="n">NAME:</span><span class="w"> </span><span class="sr">/\w+/</span>
<span class="w">    </span><span class="nv">%ignore</span><span class="w"> </span><span class="s">&quot; &quot;</span>
</pre></div>
</div>
<p>Will parse “((hello world))” as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">expr</span>
  <span class="p">(</span>
  <span class="n">expr</span>
    <span class="p">(</span>
    <span class="n">expr</span>
      <span class="n">hello</span>
      <span class="n">world</span>
    <span class="p">)</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>Using the <code class="docutils literal notranslate"><span class="pre">!</span></code> prefix is usually a “code smell”, and may point to a flaw in your grammar design.</p>
</section>
<section id="aliasing-rules">
<h4>Aliasing rules<a class="headerlink" href="#aliasing-rules" title="Permalink to this heading"></a></h4>
<p>Aliases - options in a rule can receive an alias. It will be then used as the branch name for the option, instead of the rule name.</p>
<p><strong>Example:</strong></p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="ss">start</span><span class="p">:</span><span class="w"> </span><span class="n">greet</span><span class="w"> </span><span class="n">greet</span>
<span class="w">    </span><span class="ss">greet</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;hello&quot;</span>
<span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;world&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">planet</span>
</pre></div>
</div>
<p>Lark will parse “hello world” as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">start</span>
    <span class="n">greet</span>
    <span class="n">planet</span>
</pre></div>
</div>
</section>
</section>
</section>
<span id="document-classes"></span><section id="api-reference">
<h2>API Reference<a class="headerlink" href="#api-reference" title="Permalink to this heading"></a></h2>
<section id="lark">
<h3>Lark<a class="headerlink" href="#lark" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="lark.Lark">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.</span></span><span class="sig-name descname"><span class="pre">Lark</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">grammar</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Grammar</span><span class="p"><span class="pre">,</span></span><span class="w">  </span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w">  </span><span class="pre">IO</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">options</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.Lark" title="Permalink to this definition"></a></dt>
<dd><p>Main interface for the library.</p>
<p>It’s mostly a thin wrapper for the many different parsers, and for the tree constructor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>grammar</strong> – a string or file-object containing the grammar spec (using Lark’s ebnf syntax)</p></li>
<li><p><strong>options</strong> – a dictionary controlling various aspects of Lark.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Lark</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&#39;&#39;start: &quot;foo&quot; &#39;&#39;&#39;</span><span class="p">)</span>
<span class="go">Lark(...)</span>
</pre></div>
</div>
<p><strong>===  General Options  ===</strong></p>
<dl>
<dt>start</dt><dd><p>The start symbol. Either a string, or a list of strings for multiple possible starts (Default: “start”)</p>
</dd>
<dt>debug</dt><dd><p>Display debug information and extra warnings. Use only when debugging (Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>)
When used with Earley, it generates a forest graph as “sppf.png”, if ‘dot’ is installed.</p>
</dd>
<dt>strict</dt><dd><p>Throw an exception on any potential ambiguity, including shift/reduce conflicts, and regex collisions.</p>
</dd>
<dt>transformer</dt><dd><p>Applies the transformer to every parse tree (equivalent to applying it after the parse, but faster)</p>
</dd>
<dt>propagate_positions</dt><dd><p>Propagates positional attributes into the ‘meta’ attribute of all tree branches.
Sets attributes: (line, column, end_line, end_column, start_pos, end_pos,</p>
<blockquote>
<div><p>container_line, container_column, container_end_line, container_end_column)</p>
</div></blockquote>
<p>Accepts <code class="docutils literal notranslate"><span class="pre">False</span></code>, <code class="docutils literal notranslate"><span class="pre">True</span></code>, or a callable, which will filter which nodes to ignore when propagating.</p>
</dd>
<dt>maybe_placeholders</dt><dd><p>When <code class="docutils literal notranslate"><span class="pre">True</span></code>, the <code class="docutils literal notranslate"><span class="pre">[]</span></code> operator returns <code class="docutils literal notranslate"><span class="pre">None</span></code> when not matched.
When <code class="docutils literal notranslate"><span class="pre">False</span></code>,  <code class="docutils literal notranslate"><span class="pre">[]</span></code> behaves like the <code class="docutils literal notranslate"><span class="pre">?</span></code> operator, and returns no value at all.
(default= <code class="docutils literal notranslate"><span class="pre">True</span></code>)</p>
</dd>
<dt>cache</dt><dd><p>Cache the results of the Lark grammar analysis, for x2 to x3 faster loading. LALR only for now.</p>
<ul class="simple">
<li><p>When <code class="docutils literal notranslate"><span class="pre">False</span></code>, does nothing (default)</p></li>
<li><p>When <code class="docutils literal notranslate"><span class="pre">True</span></code>, caches to a temporary file in the local directory</p></li>
<li><p>When given a string, caches to the path pointed by the string</p></li>
</ul>
</dd>
<dt>cache_grammar</dt><dd><p>For use with <code class="docutils literal notranslate"><span class="pre">cache</span></code> option. When <code class="docutils literal notranslate"><span class="pre">True</span></code>, the unanalyzed grammar is also included in the cache.
Useful for classes that require the <code class="docutils literal notranslate"><span class="pre">Lark.grammar</span></code> to be present (e.g. Reconstructor).
(default= <code class="docutils literal notranslate"><span class="pre">False</span></code>)</p>
</dd>
<dt>regex</dt><dd><p>When True, uses the <code class="docutils literal notranslate"><span class="pre">regex</span></code> module instead of the stdlib <code class="docutils literal notranslate"><span class="pre">re</span></code>.</p>
</dd>
<dt>g_regex_flags</dt><dd><p>Flags that are applied to all terminals (both regex and strings)</p>
</dd>
<dt>keep_all_tokens</dt><dd><p>Prevent the tree builder from automagically removing “punctuation” tokens (Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>)</p>
</dd>
<dt>tree_class</dt><dd><p>Lark will produce trees comprised of instances of this class instead of the default <code class="docutils literal notranslate"><span class="pre">lark.Tree</span></code>.</p>
</dd>
</dl>
<p><strong>=== Algorithm Options ===</strong></p>
<dl class="simple">
<dt>parser</dt><dd><p>Decides which parser engine to use. Accepts “earley” or “lalr”. (Default: “earley”).
(there is also a “cyk” option for legacy)</p>
</dd>
<dt>lexer</dt><dd><p>Decides whether or not to use a lexer stage</p>
<ul class="simple">
<li><p>“auto” (default): Choose for me based on the parser</p></li>
<li><p>“basic”: Use a basic lexer</p></li>
<li><p>“contextual”: Stronger lexer (only works with parser=”lalr”)</p></li>
<li><p>“dynamic”: Flexible and powerful (only with parser=”earley”)</p></li>
<li><p>“dynamic_complete”: Same as dynamic, but tries <em>every</em> variation of tokenizing possible.</p></li>
</ul>
</dd>
<dt>ambiguity</dt><dd><p>Decides how to handle ambiguity in the parse. Only relevant if parser=”earley”</p>
<ul class="simple">
<li><p>“resolve”: The parser will automatically choose the simplest derivation
(it chooses consistently: greedy for tokens, non-greedy for rules)</p></li>
<li><p>“explicit”: The parser will return all derivations wrapped in “_ambig” tree nodes (i.e. a forest).</p></li>
<li><p>“forest”: The parser will return the root of the shared packed parse forest.</p></li>
</ul>
</dd>
</dl>
<p><strong>=== Misc. / Domain Specific Options ===</strong></p>
<dl class="simple">
<dt>postlex</dt><dd><p>Lexer post-processing (Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>) Only works with the basic and contextual lexers.</p>
</dd>
<dt>priority</dt><dd><p>How priorities should be evaluated - “auto”, <code class="docutils literal notranslate"><span class="pre">None</span></code>, “normal”, “invert” (Default: “auto”)</p>
</dd>
<dt>lexer_callbacks</dt><dd><p>Dictionary of callbacks for the lexer. May alter tokens during lexing. Use with caution.</p>
</dd>
<dt>use_bytes</dt><dd><p>Accept an input of type <code class="docutils literal notranslate"><span class="pre">bytes</span></code> instead of <code class="docutils literal notranslate"><span class="pre">str</span></code>.</p>
</dd>
<dt>ordered_sets</dt><dd><p>Should Earley use ordered-sets to achieve stable output (~10% slower than regular sets. Default: True)</p>
</dd>
<dt>edit_terminals</dt><dd><p>A callback for editing the terminals before parse.</p>
</dd>
<dt>import_paths</dt><dd><p>A List of either paths or loader functions to specify from where grammars are imported</p>
</dd>
<dt>source_path</dt><dd><p>Override the source of from where the grammar was loaded. Useful for relative imports and unconventional grammar loading</p>
</dd>
</dl>
<p><strong>=== End of Options ===</strong></p>
<dl class="py method">
<dt class="sig sig-object py" id="lark.Lark.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">f</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_options</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Collection</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">()</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#lark.Lark.save" title="Permalink to this definition"></a></dt>
<dd><p>Saves the instance into the given file object</p>
<p>Useful for caching and multiprocessing.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.Lark.load">
<em class="property"><span class="pre">classmethod</span><span class="w">  </span></em><span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">f</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_T</span></span></span><a class="headerlink" href="#lark.Lark.load" title="Permalink to this definition"></a></dt>
<dd><p>Loads an instance from the given file object</p>
<p>Useful for caching and multiprocessing.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.Lark.open">
<em class="property"><span class="pre">classmethod</span><span class="w">  </span></em><span class="sig-name descname"><span class="pre">open</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">grammar_filename</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rel_to</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">options</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_T</span></span></span><a class="headerlink" href="#lark.Lark.open" title="Permalink to this definition"></a></dt>
<dd><p>Create an instance of Lark with the grammar given by its filename</p>
<p>If <code class="docutils literal notranslate"><span class="pre">rel_to</span></code> is provided, the function will find the grammar filename in relation to it.</p>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Lark</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;grammar_file.lark&quot;</span><span class="p">,</span> <span class="n">rel_to</span><span class="o">=</span><span class="vm">__file__</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s2">&quot;lalr&quot;</span><span class="p">)</span>
<span class="go">Lark(...)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.Lark.open_from_package">
<em class="property"><span class="pre">classmethod</span><span class="w">  </span></em><span class="sig-name descname"><span class="pre">open_from_package</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">package</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grammar_path</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">search_paths</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">['']</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">options</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_T</span></span></span><a class="headerlink" href="#lark.Lark.open_from_package" title="Permalink to this definition"></a></dt>
<dd><p>Create an instance of Lark with the grammar loaded from within the package <cite>package</cite>.
This allows grammar loading from zipapps.</p>
<p>Imports in the grammar will use the <cite>package</cite> and <cite>search_paths</cite> provided, through <cite>FromPackageLoader</cite></p>
<p class="rubric">Example</p>
<p>Lark.open_from_package(__name__, “example.lark”, (“grammars”,), parser=…)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.Lark.lex">
<span class="sig-name descname"><span class="pre">lex</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">text</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">AnyStr</span><span class="p"><span class="pre">,</span></span><span class="w">  </span><a class="reference internal" href="index.html#lark.utils.TextSlice" title="lark.utils.TextSlice"><span class="pre">TextSlice</span></a><span class="p"><span class="pre">[</span></span><span class="pre">AnyStr</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dont_ignore</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">bool</span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="index.html#lark.Token" title="lark.lexer.Token"><span class="pre">Token</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#lark.Lark.lex" title="Permalink to this definition"></a></dt>
<dd><p>Only lex (and postlex) the text, without parsing it. Only relevant when lexer=’basic’</p>
<p>When dont_ignore=True, the lexer will return all tokens, even those marked for %ignore.</p>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="index.html#lark.exceptions.UnexpectedCharacters" title="lark.exceptions.UnexpectedCharacters"><strong>UnexpectedCharacters</strong></a> – In case the lexer cannot find a suitable match.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.Lark.get_terminal">
<span class="sig-name descname"><span class="pre">get_terminal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">TerminalDef</span></span></span><a class="headerlink" href="#lark.Lark.get_terminal" title="Permalink to this definition"></a></dt>
<dd><p>Get information about a terminal</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.Lark.parse_interactive">
<span class="sig-name descname"><span class="pre">parse_interactive</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">text</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">AnyStr</span><span class="p"><span class="pre">,</span></span><span class="w">  </span><a class="reference internal" href="index.html#lark.utils.TextSlice" title="lark.utils.TextSlice"><span class="pre">TextSlice</span></a><span class="p"><span class="pre">[</span></span><span class="pre">AnyStr</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="index.html#lark.parsers.lalr_interactive_parser.InteractiveParser" title="lark.parsers.lalr_interactive_parser.InteractiveParser"><span class="pre">InteractiveParser</span></a></span></span><a class="headerlink" href="#lark.Lark.parse_interactive" title="Permalink to this definition"></a></dt>
<dd><p>Start an interactive parsing session. Only works when parser=’lalr’.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>text</strong> (<em>TextOrSlice</em><em>, </em><em>optional</em>) – Text to be parsed. Required for <code class="docutils literal notranslate"><span class="pre">resume_parse()</span></code>.</p></li>
<li><p><strong>start</strong> (<em>str</em><em>, </em><em>optional</em>) – Start symbol</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A new InteractiveParser instance.</p>
</dd>
</dl>
<p>See Also: <code class="docutils literal notranslate"><span class="pre">Lark.parse()</span></code></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.Lark.parse">
<span class="sig-name descname"><span class="pre">parse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">text</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">AnyStr</span><span class="p"><span class="pre">,</span></span><span class="w">  </span><a class="reference internal" href="index.html#lark.utils.TextSlice" title="lark.utils.TextSlice"><span class="pre">TextSlice</span></a><span class="p"><span class="pre">[</span></span><span class="pre">AnyStr</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">on_error</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="index.html#lark.exceptions.UnexpectedInput" title="lark.exceptions.UnexpectedInput"><span class="pre">UnexpectedInput</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w">  </span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">ParseTree</span></span></span><a class="headerlink" href="#lark.Lark.parse" title="Permalink to this definition"></a></dt>
<dd><p>Parse the given text, according to the options provided.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>text</strong> (<em>TextOrSlice</em>) – Text to be parsed, as <cite>str</cite> or <cite>bytes</cite>.
TextSlice may also be used, but only when lexer=’basic’ or ‘contextual’.</p></li>
<li><p><strong>start</strong> (<em>str</em><em>, </em><em>optional</em>) – Required if Lark was given multiple possible start symbols (using the start option).</p></li>
<li><p><strong>on_error</strong> (<em>function</em><em>, </em><em>optional</em>) – if provided, will be called on UnexpectedInput error,
with the exception as its argument. Return true to resume parsing, or false to raise the exception.
LALR only. See examples/advanced/error_handling.py for an example of how to use on_error.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>If a transformer is supplied to <code class="docutils literal notranslate"><span class="pre">__init__</span></code>, returns whatever is the
result of the transformation. Otherwise, returns a Tree instance.</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="index.html#lark.exceptions.UnexpectedInput" title="lark.exceptions.UnexpectedInput"><strong>UnexpectedInput</strong></a> – On a parse error, one of these sub-exceptions will rise:
<code class="docutils literal notranslate"><span class="pre">UnexpectedCharacters</span></code>, <code class="docutils literal notranslate"><span class="pre">UnexpectedToken</span></code>, or <code class="docutils literal notranslate"><span class="pre">UnexpectedEOF</span></code>.
For convenience, these sub-exceptions also inherit from <code class="docutils literal notranslate"><span class="pre">ParserError</span></code> and <code class="docutils literal notranslate"><span class="pre">LexerError</span></code>.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<section id="using-unicode-character-classes-with-regex">
<h4>Using Unicode character classes with <code class="docutils literal notranslate"><span class="pre">regex</span></code><a class="headerlink" href="#using-unicode-character-classes-with-regex" title="Permalink to this heading"></a></h4>
<p>Python’s builtin <code class="docutils literal notranslate"><span class="pre">re</span></code> module has a few persistent known bugs and also won’t parse
advanced regex features such as character classes.
With <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">lark[regex]</span></code>, the <code class="docutils literal notranslate"><span class="pre">regex</span></code> module will be
installed alongside lark and can act as a drop-in replacement to <code class="docutils literal notranslate"><span class="pre">re</span></code>.</p>
<p>Any instance of Lark instantiated with <code class="docutils literal notranslate"><span class="pre">regex=True</span></code> will use the <code class="docutils literal notranslate"><span class="pre">regex</span></code> module instead of <code class="docutils literal notranslate"><span class="pre">re</span></code>.</p>
<p>For example, we can use character classes to match PEP-3131 compliant Python identifiers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">g</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    ?start: NAME</span>
<span class="s2">                    NAME: ID_START ID_CONTINUE*</span>
<span class="s2">                    ID_START: /[\p</span><span class="si">{Lu}</span><span class="s2">\p</span><span class="si">{Ll}</span><span class="s2">\p</span><span class="si">{Lt}</span><span class="s2">\p</span><span class="si">{Lm}</span><span class="s2">\p</span><span class="si">{Lo}</span><span class="s2">\p</span><span class="si">{Nl}</span><span class="s2">_]+/</span>
<span class="s2">                    ID_CONTINUE: ID_START | /[\p</span><span class="si">{Mn}</span><span class="s2">\p</span><span class="si">{Mc}</span><span class="s2">\p</span><span class="si">{Nd}</span><span class="s2">\p</span><span class="si">{Pc}</span><span class="s2">·]+/</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">g</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;வணக்கம்&#39;</span><span class="p">)</span>
<span class="s1">&#39;வணக்கம்&#39;</span>
</pre></div>
</div>
</section>
</section>
<section id="tree">
<h3>Tree<a class="headerlink" href="#tree" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="lark.Tree">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.</span></span><span class="sig-name descname"><span class="pre">Tree</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">children</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">_Leaf_T</span><span class="p"><span class="pre">,</span></span><span class="w">  </span><a class="reference internal" href="index.html#lark.Tree" title="lark.Tree"><span class="pre">Tree</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_Leaf_T</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meta</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Meta</span><span class="p"><span class="pre">]</span></span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.Tree" title="Permalink to this definition"></a></dt>
<dd><p>The main tree class.</p>
<p>Creates a new tree, and stores “data” and “children” in attributes of the same name.
Trees can be hashed and compared.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – The name of the rule or alias</p></li>
<li><p><strong>children</strong> – List of matched sub-rules and terminals</p></li>
<li><p><strong>meta</strong> – <p>Line &amp; Column numbers (if <code class="docutils literal notranslate"><span class="pre">propagate_positions</span></code> is enabled).
meta attributes: (line, column, end_line, end_column, start_pos, end_pos,</p>
<blockquote>
<div><p>container_line, container_column, container_end_line, container_end_column)</p>
</div></blockquote>
<p>container_* attributes consider all symbols, including those that have been inlined in the tree.
For example, in the rule ‘a: _A B _C’, the regular attributes will mark the start and end of B,
but the container_* attributes will also include _A and _C in the range. However, rules that
contain ‘a’ will consider it in full, including _A and _C for all attributes.</p>
</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="lark.Tree.pretty">
<span class="sig-name descname"><span class="pre">pretty</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">indent_str</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">str</span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">'</span>&#160; <span class="pre">'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#lark.Tree.pretty" title="Permalink to this definition"></a></dt>
<dd><p>Returns an indented string representation of the tree.</p>
<p>Great for debugging.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.Tree.__rich__">
<span class="sig-name descname"><span class="pre">__rich__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parent</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">rich.tree.Tree</span><span class="p"><span class="pre">]</span></span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">rich.tree.Tree</span></span></span><a class="headerlink" href="#lark.Tree.__rich__" title="Permalink to this definition"></a></dt>
<dd><p>Returns a tree widget for the ‘rich’ library.</p>
<p class="rubric">Example</p>
<dl>
<dt>::</dt><dd><p>from rich import print
from lark import Tree</p>
<p>tree = Tree(‘root’, [‘node1’, ‘node2’])
print(tree)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.Tree.iter_subtrees">
<span class="sig-name descname"><span class="pre">iter_subtrees</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="index.html#lark.Tree" title="lark.tree.Tree"><span class="pre">Tree</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_Leaf_T</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#lark.Tree.iter_subtrees" title="Permalink to this definition"></a></dt>
<dd><p>Depth-first iteration.</p>
<p>Iterates over all the subtrees, never returning to the same node twice (Lark’s parse-tree is actually a DAG).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.Tree.iter_subtrees_topdown">
<span class="sig-name descname"><span class="pre">iter_subtrees_topdown</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#lark.Tree.iter_subtrees_topdown" title="Permalink to this definition"></a></dt>
<dd><p>Breadth-first iteration.</p>
<p>Iterates over all the subtrees, return nodes in order like pretty() does.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.Tree.find_pred">
<span class="sig-name descname"><span class="pre">find_pred</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pred</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="index.html#lark.Tree" title="lark.tree.Tree"><span class="pre">Tree</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_Leaf_T</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w">  </span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="index.html#lark.Tree" title="lark.tree.Tree"><span class="pre">Tree</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_Leaf_T</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#lark.Tree.find_pred" title="Permalink to this definition"></a></dt>
<dd><p>Returns all nodes of the tree that evaluate pred(node) as true.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.Tree.find_data">
<span class="sig-name descname"><span class="pre">find_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="index.html#lark.Tree" title="lark.tree.Tree"><span class="pre">Tree</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_Leaf_T</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#lark.Tree.find_data" title="Permalink to this definition"></a></dt>
<dd><p>Returns all nodes of the tree whose data equals the given data.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.Tree.scan_values">
<span class="sig-name descname"><span class="pre">scan_values</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pred</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">_Leaf_T</span><span class="p"><span class="pre">,</span></span><span class="w">  </span><a class="reference internal" href="index.html#lark.Tree" title="lark.Tree"><span class="pre">Tree</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_Leaf_T</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w">  </span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">_Leaf_T</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#lark.Tree.scan_values" title="Permalink to this definition"></a></dt>
<dd><p>Return all values in the tree that evaluate pred(value) as true.</p>
<p>This can be used to find all the tokens in the tree.</p>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">all_tokens</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">scan_values</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Token</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</section>
<section id="token">
<h3>Token<a class="headerlink" href="#token" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="lark.Token">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.</span></span><span class="sig-name descname"><span class="pre">Token</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">type</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_pos</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">column</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_line</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_column</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_pos</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.Token" title="Permalink to this definition"></a></dt>
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.</span></span><span class="sig-name descname"><span class="pre">Token</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">type_</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_pos</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">column</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_line</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_column</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_pos</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>A string with meta-information, that is produced by the lexer.</p>
<p>When parsing text, the resulting chunks of the input that haven’t been discarded,
will end up in the tree as Token instances. The Token class inherits from Python’s <code class="docutils literal notranslate"><span class="pre">str</span></code>,
so normal string comparisons and operations will work as expected.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="lark.Token.type">
<span class="sig-name descname"><span class="pre">type</span></span><a class="headerlink" href="#lark.Token.type" title="Permalink to this definition"></a></dt>
<dd><p>Name of the token (as specified in grammar)</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="lark.Token.value">
<span class="sig-name descname"><span class="pre">value</span></span><a class="headerlink" href="#lark.Token.value" title="Permalink to this definition"></a></dt>
<dd><p>Value of the token (redundant, as <code class="docutils literal notranslate"><span class="pre">token.value</span> <span class="pre">==</span> <span class="pre">token</span></code> will always be true)</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Any</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="lark.Token.start_pos">
<span class="sig-name descname"><span class="pre">start_pos</span></span><a class="headerlink" href="#lark.Token.start_pos" title="Permalink to this definition"></a></dt>
<dd><p>The index of the token in the text</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Optional[int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="lark.Token.line">
<span class="sig-name descname"><span class="pre">line</span></span><a class="headerlink" href="#lark.Token.line" title="Permalink to this definition"></a></dt>
<dd><p>The line of the token in the text (starting with 1)</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Optional[int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="lark.Token.column">
<span class="sig-name descname"><span class="pre">column</span></span><a class="headerlink" href="#lark.Token.column" title="Permalink to this definition"></a></dt>
<dd><p>The column of the token in the text (starting with 1)</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Optional[int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="lark.Token.end_line">
<span class="sig-name descname"><span class="pre">end_line</span></span><a class="headerlink" href="#lark.Token.end_line" title="Permalink to this definition"></a></dt>
<dd><p>The line where the token ends</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Optional[int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="lark.Token.end_column">
<span class="sig-name descname"><span class="pre">end_column</span></span><a class="headerlink" href="#lark.Token.end_column" title="Permalink to this definition"></a></dt>
<dd><p>The next column after the end of the token. For example,
if the token is a single character with a column value of 4,
end_column will be 5.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Optional[int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="lark.Token.end_pos">
<span class="sig-name descname"><span class="pre">end_pos</span></span><a class="headerlink" href="#lark.Token.end_pos" title="Permalink to this definition"></a></dt>
<dd><p>the index where the token ends (basically <code class="docutils literal notranslate"><span class="pre">start_pos</span> <span class="pre">+</span> <span class="pre">len(token)</span></code>)</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Optional[int]</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="transformer-visitor-interpreter">
<h3>Transformer, Visitor &amp; Interpreter<a class="headerlink" href="#transformer-visitor-interpreter" title="Permalink to this heading"></a></h3>
<p>See <a class="reference internal" href="index.html#document-visitors"><span class="doc">Transformers &amp; Visitors</span></a>.</p>
</section>
<section id="forestvisitor-foresttransformer-treeforesttransformer">
<h3>ForestVisitor, ForestTransformer, &amp; TreeForestTransformer<a class="headerlink" href="#forestvisitor-foresttransformer-treeforesttransformer" title="Permalink to this heading"></a></h3>
<p>See <a class="reference internal" href="index.html#document-forest"><span class="doc">Working with the SPPF</span></a>.</p>
</section>
<section id="unexpectedinput">
<h3>UnexpectedInput<a class="headerlink" href="#unexpectedinput" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="lark.exceptions.UnexpectedInput">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.exceptions.</span></span><span class="sig-name descname"><span class="pre">UnexpectedInput</span></span><a class="headerlink" href="#lark.exceptions.UnexpectedInput" title="Permalink to this definition"></a></dt>
<dd><p>UnexpectedInput Error.</p>
<p>Used as a base class for the following exceptions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">UnexpectedCharacters</span></code>: The lexer encountered an unexpected string</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UnexpectedToken</span></code>: The parser received an unexpected token</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UnexpectedEOF</span></code>: The parser expected a token, but the input ended</p></li>
</ul>
<p>After catching one of these exceptions, you may call the following helper methods to create a nicer error message.</p>
<dl class="py method">
<dt class="sig sig-object py" id="lark.exceptions.UnexpectedInput.get_context">
<span class="sig-name descname"><span class="pre">get_context</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">text</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">span</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">int</span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">40</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#lark.exceptions.UnexpectedInput.get_context" title="Permalink to this definition"></a></dt>
<dd><p>Returns a pretty string pinpointing the error in the text,
with span amount of context characters around it.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The parser doesn’t hold a copy of the text it has to parse,
so you have to provide it again</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.exceptions.UnexpectedInput.match_examples">
<span class="sig-name descname"><span class="pre">match_examples</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parse_fn</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w">  </span><a class="reference internal" href="index.html#lark.Tree" title="lark.Tree"><span class="pre">Tree</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">examples</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Mapping</span><span class="p"><span class="pre">[</span></span><span class="pre">T</span><span class="p"><span class="pre">,</span></span><span class="w">  </span><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w">  </span><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">T</span><span class="p"><span class="pre">,</span></span><span class="w">  </span><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">token_type_match_fallback</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">bool</span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_accepts</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">bool</span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">T</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#lark.exceptions.UnexpectedInput.match_examples" title="Permalink to this definition"></a></dt>
<dd><p>Allows you to detect what’s wrong in the input text by matching
against example errors.</p>
<p>Given a parser instance and a dictionary mapping some label with
some malformed syntax examples, it’ll return the label for the
example that bests matches the current error. The function will
iterate the dictionary until it finds a matching error, and
return the corresponding value.</p>
<p>For an example usage, see <cite>examples/error_reporting_lalr.py</cite></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>parse_fn</strong> – parse function (usually <code class="docutils literal notranslate"><span class="pre">lark_instance.parse</span></code>)</p></li>
<li><p><strong>examples</strong> – dictionary of <code class="docutils literal notranslate"><span class="pre">{'example_string':</span> <span class="pre">value}</span></code>.</p></li>
<li><p><strong>use_accepts</strong> – Recommended to keep this as <code class="docutils literal notranslate"><span class="pre">use_accepts=True</span></code>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lark.exceptions.UnexpectedToken">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.exceptions.</span></span><span class="sig-name descname"><span class="pre">UnexpectedToken</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">token</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expected</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">considered_rules</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interactive_parser</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">terminals_by_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">token_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.exceptions.UnexpectedToken" title="Permalink to this definition"></a></dt>
<dd><p>An exception that is raised by the parser, when the token it received
doesn’t match any valid step forward.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>token</strong> – The mismatched token</p></li>
<li><p><strong>expected</strong> – The set of expected tokens</p></li>
<li><p><strong>considered_rules</strong> – Which rules were considered, to deduce the expected tokens</p></li>
<li><p><strong>state</strong> – A value representing the parser state. Do not rely on its value or type.</p></li>
<li><p><strong>interactive_parser</strong> – An instance of <code class="docutils literal notranslate"><span class="pre">InteractiveParser</span></code>, that is initialized to the point of failure,
and can be used for debugging and error handling.</p></li>
</ul>
</dd>
</dl>
<p>Note: These parameters are available as attributes of the instance.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lark.exceptions.UnexpectedCharacters">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.exceptions.</span></span><span class="sig-name descname"><span class="pre">UnexpectedCharacters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">seq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lex_pos</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">column</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allowed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">considered_tokens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">token_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">terminals_by_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">considered_rules</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.exceptions.UnexpectedCharacters" title="Permalink to this definition"></a></dt>
<dd><p>An exception that is raised by the lexer, when it cannot match the next
string of characters to any of its terminals.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lark.exceptions.UnexpectedEOF">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.exceptions.</span></span><span class="sig-name descname"><span class="pre">UnexpectedEOF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">expected</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">terminals_by_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.exceptions.UnexpectedEOF" title="Permalink to this definition"></a></dt>
<dd><p>An exception that is raised by the parser, when the input ends while it still expects a token.</p>
</dd></dl>

</section>
<section id="interactiveparser">
<h3>InteractiveParser<a class="headerlink" href="#interactiveparser" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="lark.parsers.lalr_interactive_parser.InteractiveParser">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.parsers.lalr_interactive_parser.</span></span><span class="sig-name descname"><span class="pre">InteractiveParser</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parser</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parser_state</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">ParserState</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lexer_thread</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">LexerThread</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.lalr_interactive_parser.InteractiveParser" title="Permalink to this definition"></a></dt>
<dd><p>InteractiveParser gives you advanced control over parsing and error handling when parsing with LALR.</p>
<p>For a simpler interface, see the <code class="docutils literal notranslate"><span class="pre">on_error</span></code> argument to <code class="docutils literal notranslate"><span class="pre">Lark.parse()</span></code>.</p>
<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.lalr_interactive_parser.InteractiveParser.feed_token">
<span class="sig-name descname"><span class="pre">feed_token</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">token</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><a class="reference internal" href="index.html#lark.Token" title="lark.lexer.Token"><span class="pre">Token</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.lalr_interactive_parser.InteractiveParser.feed_token" title="Permalink to this definition"></a></dt>
<dd><p>Feed the parser with a token, and advance it to the next state, as if it received it from the lexer.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">token</span></code> has to be an instance of <code class="docutils literal notranslate"><span class="pre">Token</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.lalr_interactive_parser.InteractiveParser.exhaust_lexer">
<span class="sig-name descname"><span class="pre">exhaust_lexer</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="index.html#lark.Token" title="lark.lexer.Token"><span class="pre">Token</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#lark.parsers.lalr_interactive_parser.InteractiveParser.exhaust_lexer" title="Permalink to this definition"></a></dt>
<dd><p>Try to feed the rest of the lexer state into the interactive parser.</p>
<p>Note that this modifies the instance in place and does not feed an ‘$END’ Token</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.lalr_interactive_parser.InteractiveParser.as_immutable">
<span class="sig-name descname"><span class="pre">as_immutable</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.lalr_interactive_parser.InteractiveParser.as_immutable" title="Permalink to this definition"></a></dt>
<dd><p>Convert to an <code class="docutils literal notranslate"><span class="pre">ImmutableInteractiveParser</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.lalr_interactive_parser.InteractiveParser.pretty">
<span class="sig-name descname"><span class="pre">pretty</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.lalr_interactive_parser.InteractiveParser.pretty" title="Permalink to this definition"></a></dt>
<dd><p>Print the output of <code class="docutils literal notranslate"><span class="pre">choices()</span></code> in a way that’s easier to read.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.lalr_interactive_parser.InteractiveParser.choices">
<span class="sig-name descname"><span class="pre">choices</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.lalr_interactive_parser.InteractiveParser.choices" title="Permalink to this definition"></a></dt>
<dd><p>Returns a dictionary of token types, matched to their action in the parser.</p>
<p>Only returns token types that are accepted by the current state.</p>
<p>Updated by <code class="docutils literal notranslate"><span class="pre">feed_token()</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.lalr_interactive_parser.InteractiveParser.accepts">
<span class="sig-name descname"><span class="pre">accepts</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.lalr_interactive_parser.InteractiveParser.accepts" title="Permalink to this definition"></a></dt>
<dd><p>Returns the set of possible tokens that will advance the parser into a new valid state.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.lalr_interactive_parser.InteractiveParser.resume_parse">
<span class="sig-name descname"><span class="pre">resume_parse</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.lalr_interactive_parser.InteractiveParser.resume_parse" title="Permalink to this definition"></a></dt>
<dd><p>Resume automated parsing from the current state.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lark.parsers.lalr_interactive_parser.ImmutableInteractiveParser">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.parsers.lalr_interactive_parser.</span></span><span class="sig-name descname"><span class="pre">ImmutableInteractiveParser</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parser</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parser_state</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">ParserState</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lexer_thread</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">LexerThread</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.lalr_interactive_parser.ImmutableInteractiveParser" title="Permalink to this definition"></a></dt>
<dd><p>Same as <code class="docutils literal notranslate"><span class="pre">InteractiveParser</span></code>, but operations create a new instance instead
of changing it in-place.</p>
<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.lalr_interactive_parser.ImmutableInteractiveParser.feed_token">
<span class="sig-name descname"><span class="pre">feed_token</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">token</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.lalr_interactive_parser.ImmutableInteractiveParser.feed_token" title="Permalink to this definition"></a></dt>
<dd><p>Feed the parser with a token, and advance it to the next state, as if it received it from the lexer.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">token</span></code> has to be an instance of <code class="docutils literal notranslate"><span class="pre">Token</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.lalr_interactive_parser.ImmutableInteractiveParser.exhaust_lexer">
<span class="sig-name descname"><span class="pre">exhaust_lexer</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.lalr_interactive_parser.ImmutableInteractiveParser.exhaust_lexer" title="Permalink to this definition"></a></dt>
<dd><p>Try to feed the rest of the lexer state into the parser.</p>
<p>Note that this returns a new ImmutableInteractiveParser and does not feed an ‘$END’ Token</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.lalr_interactive_parser.ImmutableInteractiveParser.as_mutable">
<span class="sig-name descname"><span class="pre">as_mutable</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.lalr_interactive_parser.ImmutableInteractiveParser.as_mutable" title="Permalink to this definition"></a></dt>
<dd><p>Convert to an <code class="docutils literal notranslate"><span class="pre">InteractiveParser</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.lalr_interactive_parser.ImmutableInteractiveParser.choices">
<span class="sig-name descname"><span class="pre">choices</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.lalr_interactive_parser.ImmutableInteractiveParser.choices" title="Permalink to this definition"></a></dt>
<dd><p>Returns a dictionary of token types, matched to their action in the parser.</p>
<p>Only returns token types that are accepted by the current state.</p>
<p>Updated by <code class="docutils literal notranslate"><span class="pre">feed_token()</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.lalr_interactive_parser.ImmutableInteractiveParser.pretty">
<span class="sig-name descname"><span class="pre">pretty</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.lalr_interactive_parser.ImmutableInteractiveParser.pretty" title="Permalink to this definition"></a></dt>
<dd><p>Print the output of <code class="docutils literal notranslate"><span class="pre">choices()</span></code> in a way that’s easier to read.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.lalr_interactive_parser.ImmutableInteractiveParser.resume_parse">
<span class="sig-name descname"><span class="pre">resume_parse</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.lalr_interactive_parser.ImmutableInteractiveParser.resume_parse" title="Permalink to this definition"></a></dt>
<dd><p>Resume automated parsing from the current state.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.lalr_interactive_parser.ImmutableInteractiveParser.accepts">
<span class="sig-name descname"><span class="pre">accepts</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.lalr_interactive_parser.ImmutableInteractiveParser.accepts" title="Permalink to this definition"></a></dt>
<dd><p>Returns the set of possible tokens that will advance the parser into a new valid state.</p>
</dd></dl>

</dd></dl>

</section>
<section id="ast-utils">
<h3>ast_utils<a class="headerlink" href="#ast-utils" title="Permalink to this heading"></a></h3>
<p>For an example of using <code class="docutils literal notranslate"><span class="pre">ast_utils</span></code>, see <a class="reference external" href="examples/advanced/create_ast.html">/examples/advanced/create_ast.py</a></p>
<dl class="py class">
<dt class="sig sig-object py" id="lark.ast_utils.Ast">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.ast_utils.</span></span><span class="sig-name descname"><span class="pre">Ast</span></span><a class="headerlink" href="#lark.ast_utils.Ast" title="Permalink to this definition"></a></dt>
<dd><p>Abstract class</p>
<p>Subclasses will be collected by <cite>create_transformer()</cite></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lark.ast_utils.AsList">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.ast_utils.</span></span><span class="sig-name descname"><span class="pre">AsList</span></span><a class="headerlink" href="#lark.ast_utils.AsList" title="Permalink to this definition"></a></dt>
<dd><p>Abstract class</p>
<p>Subclasses will be instantiated with the parse results as a single list, instead of as arguments.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lark.ast_utils.create_transformer">
<span class="sig-prename descclassname"><span class="pre">lark.ast_utils.</span></span><span class="sig-name descname"><span class="pre">create_transformer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ast_module:</span> <span class="pre">module</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transformer:</span> <span class="pre">~typing.Optional[~lark.visitors.Transformer]</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decorator_factory:</span> <span class="pre">~typing.Callable</span> <span class="pre">=</span> <span class="pre">&lt;function</span> <span class="pre">v_args&gt;</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="index.html#lark.visitors.Transformer" title="lark.visitors.Transformer"><span class="pre">Transformer</span></a></span></span><a class="headerlink" href="#lark.ast_utils.create_transformer" title="Permalink to this definition"></a></dt>
<dd><p>Collects <cite>Ast</cite> subclasses from the given module, and creates a Lark transformer that builds the AST.</p>
<p>For each class, we create a corresponding rule in the transformer, with a matching name.
CamelCase names will be converted into snake_case. Example: “CodeBlock” -&gt; “code_block”.</p>
<p>Classes starting with an underscore (<cite>_</cite>) will be skipped.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ast_module</strong> – A Python module containing all the subclasses of <code class="docutils literal notranslate"><span class="pre">ast_utils.Ast</span></code></p></li>
<li><p><strong>transformer</strong> (<em>Optional</em><em>[</em><a class="reference internal" href="index.html#lark.visitors.Transformer" title="lark.visitors.Transformer"><em>Transformer</em></a><em>]</em>) – An initial transformer. Its attributes may be overwritten.</p></li>
<li><p><strong>decorator_factory</strong> (<em>Callable</em>) – An optional callable accepting two booleans, inline, and meta,
and returning a decorator for the methods of <code class="docutils literal notranslate"><span class="pre">transformer</span></code>. (default: <code class="docutils literal notranslate"><span class="pre">v_args</span></code>).</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="indenter">
<h3>Indenter<a class="headerlink" href="#indenter" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="lark.indenter.Indenter">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.indenter.</span></span><span class="sig-name descname"><span class="pre">Indenter</span></span><a class="headerlink" href="#lark.indenter.Indenter" title="Permalink to this definition"></a></dt>
<dd><p>This is a postlexer that “injects” indent/dedent tokens based on indentation.</p>
<p>It keeps track of the current indentation, as well as the current level of parentheses.
Inside parentheses, the indentation is ignored, and no indent/dedent tokens get generated.</p>
<dl class="simple">
<dt>Note: This is an abstract class. To use it, inherit and implement all its abstract methods:</dt><dd><ul class="simple">
<li><p>tab_len</p></li>
<li><p>NL_type</p></li>
<li><p>OPEN_PAREN_types, CLOSE_PAREN_types</p></li>
<li><p>INDENT_type, DEDENT_type</p></li>
</ul>
</dd>
</dl>
<p>See also: the <code class="docutils literal notranslate"><span class="pre">postlex</span></code> option in <cite>Lark</cite>.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lark.indenter.PythonIndenter">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.indenter.</span></span><span class="sig-name descname"><span class="pre">PythonIndenter</span></span><a class="headerlink" href="#lark.indenter.PythonIndenter" title="Permalink to this definition"></a></dt>
<dd><p>A postlexer that “injects” _INDENT/_DEDENT tokens based on indentation, according to the Python syntax.</p>
<p>See also: the <code class="docutils literal notranslate"><span class="pre">postlex</span></code> option in <cite>Lark</cite>.</p>
</dd></dl>

</section>
<section id="textslice">
<h3>TextSlice<a class="headerlink" href="#textslice" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="lark.utils.TextSlice">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.utils.</span></span><span class="sig-name descname"><span class="pre">TextSlice</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">text</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">AnyStr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.utils.TextSlice" title="Permalink to this definition"></a></dt>
<dd><p>A view of a string or bytes object, between the start and end indices.</p>
<p>Never creates a copy.</p>
<p>Lark accepts instances of TextSlice as input (instead of a string),
when the lexer is ‘basic’ or ‘contextual’.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>text</strong> (<em>str</em><em> or </em><em>bytes</em>) – The text to slice.</p></li>
<li><p><strong>start</strong> (<em>int</em>) – The start index. Negative indices are supported.</p></li>
<li><p><strong>end</strong> (<em>int</em>) – The end index. Negative indices are supported.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>TypeError</strong> – If <cite>text</cite> is not a <cite>str</cite> or <cite>bytes</cite>.</p></li>
<li><p><strong>AssertionError</strong> – If <cite>start</cite> or <cite>end</cite> are out of bounds.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">TextSlice</span><span class="p">(</span><span class="s2">&quot;Hello, World!&quot;</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="go">TextSlice(text=&#39;Hello, World!&#39;, start=7, end=12)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">TextSlice</span><span class="p">(</span><span class="s2">&quot;Hello, World!&quot;</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;o&quot;</span><span class="p">)</span>
<span class="go">1</span>
</pre></div>
</div>
</dd></dl>

</section>
</section>
<span id="document-visitors"></span><section id="transformers-visitors">
<h2>Transformers &amp; Visitors<a class="headerlink" href="#transformers-visitors" title="Permalink to this heading"></a></h2>
<p>Transformers &amp; Visitors provide a convenient interface to process the
parse-trees that Lark returns.</p>
<p>They are used by inheriting from the correct class (visitor or transformer),
and implementing methods corresponding to the rule you wish to process. Each
method accepts the children as an argument. That can be modified using the
<code class="docutils literal notranslate"><span class="pre">v_args</span></code> decorator, which allows one to inline the arguments (akin to <code class="docutils literal notranslate"><span class="pre">*args</span></code>),
or add the tree <code class="docutils literal notranslate"><span class="pre">meta</span></code> property as an argument.</p>
<p>See: <a class="reference external" href="https://github.com/lark-parser/lark/blob/master/lark/visitors.py">visitors.py</a></p>
<section id="visitor">
<h3>Visitor<a class="headerlink" href="#visitor" title="Permalink to this heading"></a></h3>
<p>Visitors visit each node of the tree, and run the appropriate method on it according to the node’s data.</p>
<p>They work bottom-up, starting with the leaves and ending at the root of the tree.</p>
<p>There are two classes that implement the visitor interface:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Visitor</span></code>: Visit every node (without recursion)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Visitor_Recursive</span></code>: Visit every node using recursion. Slightly faster.</p></li>
</ul>
<dl>
<dt>Example:</dt><dd><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">IncreaseAllNumbers</span><span class="p">(</span><span class="n">Visitor</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">tree</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;number&quot;</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="n">IncreaseAllNumbers</span><span class="p">()</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">parse_tree</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<dl class="py class">
<dt class="sig sig-object py" id="lark.visitors.Visitor">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.visitors.</span></span><span class="sig-name descname"><span class="pre">Visitor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.visitors.Visitor" title="Permalink to this definition"></a></dt>
<dd><p>Tree visitor, non-recursive (can handle huge trees).</p>
<p>Visiting a node calls its methods (provided by the user via inheritance) according to <code class="docutils literal notranslate"><span class="pre">tree.data</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="lark.visitors.Visitor.visit">
<span class="sig-name descname"><span class="pre">visit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tree</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><a class="reference internal" href="index.html#lark.Tree" title="lark.tree.Tree"><span class="pre">Tree</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_Leaf_T</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="index.html#lark.Tree" title="lark.tree.Tree"><span class="pre">Tree</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_Leaf_T</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#lark.visitors.Visitor.visit" title="Permalink to this definition"></a></dt>
<dd><p>Visits the tree, starting with the leaves and finally the root (bottom-up)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.visitors.Visitor.visit_topdown">
<span class="sig-name descname"><span class="pre">visit_topdown</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tree</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><a class="reference internal" href="index.html#lark.Tree" title="lark.tree.Tree"><span class="pre">Tree</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_Leaf_T</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="index.html#lark.Tree" title="lark.tree.Tree"><span class="pre">Tree</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_Leaf_T</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#lark.visitors.Visitor.visit_topdown" title="Permalink to this definition"></a></dt>
<dd><p>Visit the tree, starting at the root, and ending at the leaves (top-down)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.visitors.Visitor.__default__">
<span class="sig-name descname"><span class="pre">__default__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tree</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.visitors.Visitor.__default__" title="Permalink to this definition"></a></dt>
<dd><p>Default function that is called if there is no attribute matching <code class="docutils literal notranslate"><span class="pre">tree.data</span></code></p>
<p>Can be overridden. Defaults to doing nothing.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lark.visitors.Visitor_Recursive">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.visitors.</span></span><span class="sig-name descname"><span class="pre">Visitor_Recursive</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.visitors.Visitor_Recursive" title="Permalink to this definition"></a></dt>
<dd><p>Bottom-up visitor, recursive.</p>
<p>Visiting a node calls its methods (provided by the user via inheritance) according to <code class="docutils literal notranslate"><span class="pre">tree.data</span></code></p>
<p>Slightly faster than the non-recursive version.</p>
<dl class="py method">
<dt class="sig sig-object py" id="lark.visitors.Visitor_Recursive.visit">
<span class="sig-name descname"><span class="pre">visit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tree</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><a class="reference internal" href="index.html#lark.Tree" title="lark.tree.Tree"><span class="pre">Tree</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_Leaf_T</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="index.html#lark.Tree" title="lark.tree.Tree"><span class="pre">Tree</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_Leaf_T</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#lark.visitors.Visitor_Recursive.visit" title="Permalink to this definition"></a></dt>
<dd><p>Visits the tree, starting with the leaves and finally the root (bottom-up)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.visitors.Visitor_Recursive.visit_topdown">
<span class="sig-name descname"><span class="pre">visit_topdown</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tree</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><a class="reference internal" href="index.html#lark.Tree" title="lark.tree.Tree"><span class="pre">Tree</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_Leaf_T</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="index.html#lark.Tree" title="lark.tree.Tree"><span class="pre">Tree</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_Leaf_T</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#lark.visitors.Visitor_Recursive.visit_topdown" title="Permalink to this definition"></a></dt>
<dd><p>Visit the tree, starting at the root, and ending at the leaves (top-down)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.visitors.Visitor_Recursive.__default__">
<span class="sig-name descname"><span class="pre">__default__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tree</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.visitors.Visitor_Recursive.__default__" title="Permalink to this definition"></a></dt>
<dd><p>Default function that is called if there is no attribute matching <code class="docutils literal notranslate"><span class="pre">tree.data</span></code></p>
<p>Can be overridden. Defaults to doing nothing.</p>
</dd></dl>

</dd></dl>

</section>
<section id="interpreter">
<h3>Interpreter<a class="headerlink" href="#interpreter" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="lark.visitors.Interpreter">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.visitors.</span></span><span class="sig-name descname"><span class="pre">Interpreter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.visitors.Interpreter" title="Permalink to this definition"></a></dt>
<dd><p>Interpreter walks the tree starting at the root.</p>
<p>Visits the tree, starting with the root and finally the leaves (top-down)</p>
<p>For each tree node, it calls its methods (provided by user via inheritance) according to <code class="docutils literal notranslate"><span class="pre">tree.data</span></code>.</p>
<p>Unlike <code class="docutils literal notranslate"><span class="pre">Transformer</span></code> and <code class="docutils literal notranslate"><span class="pre">Visitor</span></code>, the Interpreter doesn’t automatically visit its sub-branches.
The user has to explicitly call <code class="docutils literal notranslate"><span class="pre">visit</span></code>, <code class="docutils literal notranslate"><span class="pre">visit_children</span></code>, or use the <code class="docutils literal notranslate"><span class="pre">&#64;visit_children_decor</span></code>.
This allows the user to implement branching and loops.</p>
</dd></dl>

<dl>
<dt>Example:</dt><dd><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">IncreaseSomeOfTheNumbers</span><span class="p">(</span><span class="n">Interpreter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">skip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
        <span class="c1"># skip this subtree. don&#39;t change any number node inside it.</span>
        <span class="k">pass</span>

    <span class="n">IncreaseSomeOfTheNumbers</span><span class="p">()</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">parse_tree</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="transformer">
<h3>Transformer<a class="headerlink" href="#transformer" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="lark.visitors.Transformer">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.visitors.</span></span><span class="sig-name descname"><span class="pre">Transformer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">visit_tokens</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">bool</span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.visitors.Transformer" title="Permalink to this definition"></a></dt>
<dd><p>Transformers work bottom-up (or depth-first), starting with visiting the leaves and working
their way up until ending at the root of the tree.</p>
<p>For each node visited, the transformer will call the appropriate method (callbacks), according to the
node’s <code class="docutils literal notranslate"><span class="pre">data</span></code>, and use the returned value to replace the node, thereby creating a new tree structure.</p>
<p>Transformers can be used to implement map &amp; reduce patterns. Because nodes are reduced from leaf to root,
at any point the callbacks may assume the children have already been transformed (if applicable).</p>
<p>If the transformer cannot find a method with the right name, it will instead call <code class="docutils literal notranslate"><span class="pre">__default__</span></code>, which by
default creates a copy of the node.</p>
<p>To discard a node, return Discard (<code class="docutils literal notranslate"><span class="pre">lark.visitors.Discard</span></code>).</p>
<p><code class="docutils literal notranslate"><span class="pre">Transformer</span></code> can do anything <code class="docutils literal notranslate"><span class="pre">Visitor</span></code> can do, but because it reconstructs the tree,
it is slightly less efficient.</p>
<p>A transformer without methods essentially performs a non-memoized partial deepcopy.</p>
<p>All these classes implement the transformer interface:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Transformer</span></code> - Recursively transforms the tree. This is the one you probably want.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Transformer_InPlace</span></code> - Non-recursive. Changes the tree in-place instead of returning new instances</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Transformer_InPlaceRecursive</span></code> - Recursive. Changes the tree in-place instead of returning new instances</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>visit_tokens</strong> (<em>bool</em><em>, </em><em>optional</em>) – Should the transformer visit tokens in addition to rules.
Setting this to <code class="docutils literal notranslate"><span class="pre">False</span></code> is slightly faster. Defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code>.
(For processing ignored tokens, use the <code class="docutils literal notranslate"><span class="pre">lexer_callbacks</span></code> options)</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="lark.visitors.Transformer.transform">
<span class="sig-name descname"><span class="pre">transform</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tree</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><a class="reference internal" href="index.html#lark.Tree" title="lark.tree.Tree"><span class="pre">Tree</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_Leaf_T</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_Return_T</span></span></span><a class="headerlink" href="#lark.visitors.Transformer.transform" title="Permalink to this definition"></a></dt>
<dd><p>Transform the given tree, and return the final result</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.visitors.Transformer.__mul__">
<span class="sig-name descname"><span class="pre">__mul__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="index.html#lark.visitors.Transformer" title="lark.visitors.Transformer"><span class="pre">Transformer</span></a><span class="p"><span class="pre">,</span></span><span class="w">  </span><span class="pre">TransformerChain</span><span class="p"><span class="pre">[</span></span><span class="pre">_Leaf_U</span><span class="p"><span class="pre">,</span></span><span class="w">  </span><span class="pre">_Return_V</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">TransformerChain</span><span class="p"><span class="pre">[</span></span><span class="pre">_Leaf_T</span><span class="p"><span class="pre">,</span></span><span class="w">  </span><span class="pre">_Return_V</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#lark.visitors.Transformer.__mul__" title="Permalink to this definition"></a></dt>
<dd><p>Chain two transformers together, returning a new transformer.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.visitors.Transformer.__default__">
<span class="sig-name descname"><span class="pre">__default__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">children</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meta</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.visitors.Transformer.__default__" title="Permalink to this definition"></a></dt>
<dd><p>Default function that is called if there is no attribute matching <code class="docutils literal notranslate"><span class="pre">data</span></code></p>
<p>Can be overridden. Defaults to creating a new copy of the tree node (i.e. <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">Tree(data,</span> <span class="pre">children,</span> <span class="pre">meta)</span></code>)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.visitors.Transformer.__default_token__">
<span class="sig-name descname"><span class="pre">__default_token__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">token</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.visitors.Transformer.__default_token__" title="Permalink to this definition"></a></dt>
<dd><p>Default function that is called if there is no attribute matching <code class="docutils literal notranslate"><span class="pre">token.type</span></code></p>
<p>Can be overridden. Defaults to returning the token as-is.</p>
</dd></dl>

</dd></dl>

<dl>
<dt>Example:</dt><dd><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Tree</span><span class="p">,</span> <span class="n">Transformer</span>

<span class="k">class</span> <span class="nc">EvalExpressions</span><span class="p">(</span><span class="n">Transformer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">Tree</span><span class="p">(</span><span class="s1">&#39;expr&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;1+2&#39;</span><span class="p">])])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">EvalExpressions</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span> <span class="n">t</span> <span class="p">))</span>

<span class="c1"># Prints: Tree(a, [3])</span>
</pre></div>
</div>
</dd>
<dt>Example:</dt><dd><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">T</span><span class="p">(</span><span class="n">Transformer</span><span class="p">):</span>
    <span class="n">INT</span> <span class="o">=</span> <span class="nb">int</span>
    <span class="n">NUMBER</span> <span class="o">=</span> <span class="nb">float</span>
    <span class="k">def</span> <span class="nf">NAME</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lookup_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<span class="n">T</span><span class="p">(</span><span class="n">visit_tokens</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<dl class="py class">
<dt class="sig sig-object py" id="lark.visitors.Transformer_NonRecursive">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.visitors.</span></span><span class="sig-name descname"><span class="pre">Transformer_NonRecursive</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">visit_tokens</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">bool</span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.visitors.Transformer_NonRecursive" title="Permalink to this definition"></a></dt>
<dd><p>Same as Transformer but non-recursive.</p>
<p>Like Transformer, it doesn’t change the original tree.</p>
<p>Useful for huge trees.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lark.visitors.Transformer_InPlace">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.visitors.</span></span><span class="sig-name descname"><span class="pre">Transformer_InPlace</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">visit_tokens</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">bool</span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.visitors.Transformer_InPlace" title="Permalink to this definition"></a></dt>
<dd><p>Same as Transformer, but non-recursive, and changes the tree in-place instead of returning new instances</p>
<p>Useful for huge trees. Conservative in memory.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lark.visitors.Transformer_InPlaceRecursive">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.visitors.</span></span><span class="sig-name descname"><span class="pre">Transformer_InPlaceRecursive</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">visit_tokens</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">bool</span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.visitors.Transformer_InPlaceRecursive" title="Permalink to this definition"></a></dt>
<dd><p>Same as Transformer, recursive, but changes the tree in-place instead of returning new instances</p>
</dd></dl>

</section>
<section id="v-args">
<h3>v_args<a class="headerlink" href="#v-args" title="Permalink to this heading"></a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="lark.visitors.v_args">
<span class="sig-prename descclassname"><span class="pre">lark.visitors.</span></span><span class="sig-name descname"><span class="pre">v_args</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">inline</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">bool</span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meta</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">bool</span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tree</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">bool</span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wrapper</span></span><span class="p"><span class="pre">:</span></span><span class="w">  </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span></span><span class="w">  </span><span class="o"><span class="pre">=</span></span><span class="w">  </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w">  </span><span class="pre">_Return_T</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w">  </span><span class="pre">type</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w">  </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w">  </span><span class="pre">_Return_T</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w">  </span><span class="pre">type</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#lark.visitors.v_args" title="Permalink to this definition"></a></dt>
<dd><p>A convenience decorator factory for modifying the behavior of user-supplied callback methods of <code class="docutils literal notranslate"><span class="pre">Transformer</span></code> classes.</p>
<p>By default, transformer callback methods accept one argument - a list of the node’s children.</p>
<p><code class="docutils literal notranslate"><span class="pre">v_args</span></code> can modify this behavior. When used on a <code class="docutils literal notranslate"><span class="pre">Transformer</span></code> class definition, it applies to
all the callback methods inside it.</p>
<p><code class="docutils literal notranslate"><span class="pre">v_args</span></code> can be applied to a single method, or to an entire class. When applied to both,
the options given to the method take precedence.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inline</strong> (<em>bool</em><em>, </em><em>optional</em>) – Children are provided as <code class="docutils literal notranslate"><span class="pre">*args</span></code> instead of a list argument (not recommended for very long lists).</p></li>
<li><p><strong>meta</strong> (<em>bool</em><em>, </em><em>optional</em>) – Provides two arguments: <code class="docutils literal notranslate"><span class="pre">meta</span></code> and <code class="docutils literal notranslate"><span class="pre">children</span></code> (instead of just the latter); <code class="docutils literal notranslate"><span class="pre">meta</span></code> isn’t available for transformers supplied to Lark using the <code class="docutils literal notranslate"><span class="pre">transformer</span></code> parameter (aka internal transformers).</p></li>
<li><p><strong>tree</strong> (<em>bool</em><em>, </em><em>optional</em>) – Provides the entire tree as the argument, instead of the children.</p></li>
<li><p><strong>wrapper</strong> (<em>function</em><em>, </em><em>optional</em>) – Provide a function to decorate all methods.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@v_args</span><span class="p">(</span><span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">SolveArith</span><span class="p">(</span><span class="n">Transformer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">left</span> <span class="o">+</span> <span class="n">right</span>

    <span class="nd">@v_args</span><span class="p">(</span><span class="n">meta</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">mul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">children</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mul at line </span><span class="si">{</span><span class="n">meta</span><span class="o">.</span><span class="n">line</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">children</span>
        <span class="k">return</span> <span class="n">left</span> <span class="o">*</span> <span class="n">right</span>


<span class="k">class</span> <span class="nc">ReverseNotation</span><span class="p">(</span><span class="n">Transformer_InPlace</span><span class="p">):</span>
    <span class="nd">@v_args</span><span class="p">(</span><span class="n">tree</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">tree_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">children</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="merge-transformers">
<h3>merge_transformers<a class="headerlink" href="#merge-transformers" title="Permalink to this heading"></a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="lark.visitors.merge_transformers">
<span class="sig-prename descclassname"><span class="pre">lark.visitors.</span></span><span class="sig-name descname"><span class="pre">merge_transformers</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">base_transformer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">transformers_to_merge</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.visitors.merge_transformers" title="Permalink to this definition"></a></dt>
<dd><p>Merge a collection of transformers into the base_transformer, each into its own ‘namespace’.</p>
<p>When called, it will collect the methods from each transformer, and assign them to base_transformer,
with their name prefixed with the given keyword, as <code class="docutils literal notranslate"><span class="pre">prefix__methodname</span></code>.</p>
<p>This function is especially useful for processing grammars that import other grammars,
thereby creating some of their rules in a ‘namespace’. (i.e with a consistent name prefix).
In this case, the key for the transformer should match the name of the imported grammar.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>base_transformer</strong> (<a class="reference internal" href="index.html#lark.visitors.Transformer" title="lark.visitors.Transformer"><em>Transformer</em></a><em>, </em><em>optional</em>) – The transformer that all other transformers will be added to.</p></li>
<li><p><strong>**transformers_to_merge</strong> – Keyword arguments, in the form of <code class="docutils literal notranslate"><span class="pre">name_prefix</span> <span class="pre">=</span> <span class="pre">transformer</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>AttributeError</strong> – In case of a name collision in the merged methods</p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TBase</span><span class="p">(</span><span class="n">Transformer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">children</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;bar&#39;</span>

<span class="k">class</span> <span class="nc">TImportedGrammar</span><span class="p">(</span><span class="n">Transformer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">children</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;foo&quot;</span>

<span class="n">composed_transformer</span> <span class="o">=</span> <span class="n">merge_transformers</span><span class="p">(</span><span class="n">TBase</span><span class="p">(),</span> <span class="n">imported</span><span class="o">=</span><span class="n">TImportedGrammar</span><span class="p">())</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="n">Tree</span><span class="p">(</span><span class="s1">&#39;imported__foo&#39;</span><span class="p">,</span> <span class="p">[])</span> <span class="p">])</span>

<span class="k">assert</span> <span class="n">composed_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;foobar&#39;</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="discard">
<h3>Discard<a class="headerlink" href="#discard" title="Permalink to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Discard</span></code> is the singleton instance of <code class="docutils literal notranslate"><span class="pre">_DiscardType</span></code>.</p>
<dl class="py class">
<dt class="sig sig-object py" id="lark.visitors._DiscardType">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.visitors.</span></span><span class="sig-name descname"><span class="pre">_DiscardType</span></span><a class="headerlink" href="#lark.visitors._DiscardType" title="Permalink to this definition"></a></dt>
<dd><p>When the Discard value is returned from a transformer callback,
that node is discarded and won’t appear in the parent.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This feature is disabled when the transformer is provided to Lark
using the <code class="docutils literal notranslate"><span class="pre">transformer</span></code> keyword (aka Tree-less LALR mode).</p>
</div>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">T</span><span class="p">(</span><span class="n">Transformer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">ignore_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">children</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Discard</span>

    <span class="k">def</span> <span class="nf">IGNORE_TOKEN</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Discard</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="visiterror">
<h3>VisitError<a class="headerlink" href="#visiterror" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="lark.exceptions.VisitError">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.exceptions.</span></span><span class="sig-name descname"><span class="pre">VisitError</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rule</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orig_exc</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.exceptions.VisitError" title="Permalink to this definition"></a></dt>
<dd><p>VisitError is raised when visitors are interrupted by an exception</p>
<p>It provides the following attributes for inspection:</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rule</strong> – the name of the visit rule that failed</p></li>
<li><p><strong>obj</strong> – the tree-node or token that was being processed</p></li>
<li><p><strong>orig_exc</strong> – the exception that cause it to fail</p></li>
</ul>
</dd>
</dl>
<p>Note: These parameters are available as attributes</p>
</dd></dl>

</section>
</section>
<span id="document-forest"></span><section id="working-with-the-sppf">
<h2>Working with the SPPF<a class="headerlink" href="#working-with-the-sppf" title="Permalink to this heading"></a></h2>
<p>When parsing with Earley, Lark provides the <code class="docutils literal notranslate"><span class="pre">ambiguity='forest'</span></code> option
to obtain the shared packed parse forest (SPPF) produced by the parser as
an alternative to it being automatically converted to a tree.</p>
<p>Lark provides a few tools to facilitate working with the SPPF. Here are some
things to consider when deciding whether or not to use the SPPF.</p>
<p><strong>Pros</strong></p>
<ul class="simple">
<li><p>Efficient storage of highly ambiguous parses</p></li>
<li><p>Precise handling of ambiguities</p></li>
<li><p>Custom rule prioritizers</p></li>
<li><p>Ability to handle infinite ambiguities</p></li>
<li><p>Directly transform forest -&gt; object instead of forest -&gt; tree -&gt; object</p></li>
</ul>
<p><strong>Cons</strong></p>
<ul class="simple">
<li><p>More complex than working with a tree</p></li>
<li><p>SPPF may contain nodes corresponding to rules generated internally</p></li>
<li><p>Loss of Lark grammar features:</p>
<ul>
<li><p>Rules starting with ‘_’ are not inlined in the SPPF</p></li>
<li><p>Rules starting with ‘?’ are never inlined in the SPPF</p></li>
<li><p>All tokens will appear in the SPPF</p></li>
</ul>
</li>
</ul>
<section id="symbolnode">
<h3>SymbolNode<a class="headerlink" href="#symbolnode" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="lark.parsers.earley_forest.SymbolNode">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.parsers.earley_forest.</span></span><span class="sig-name descname"><span class="pre">SymbolNode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">s</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.earley_forest.SymbolNode" title="Permalink to this definition"></a></dt>
<dd><p>A Symbol Node represents a symbol (or Intermediate LR0).</p>
<p>Symbol nodes are keyed by the symbol (s). For intermediate nodes
s will be an LR0, stored as a tuple of (rule, ptr). For completed symbol
nodes, s will be a string representing the non-terminal origin (i.e.
the left hand side of the rule).</p>
<p>The children of a Symbol or Intermediate Node will always be Packed Nodes;
with each Packed Node child representing a single derivation of a production.</p>
<p>Hence a Symbol Node with a single child is unambiguous.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>s</strong> – A Symbol, or a tuple of (rule, ptr) for an intermediate node.</p></li>
<li><p><strong>start</strong> – For dynamic lexers, the index of the start of the substring matched by this symbol (inclusive).</p></li>
<li><p><strong>end</strong> – For dynamic lexers, the index of the end of the substring matched by this symbol (exclusive).</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Properties:</dt><dd><p>is_intermediate: True if this node is an intermediate node.
priority: The priority of the node’s symbol.</p>
</dd>
</dl>
<dl class="py property">
<dt class="sig sig-object py" id="lark.parsers.earley_forest.SymbolNode.is_ambiguous">
<em class="property"><span class="pre">property</span><span class="w">  </span></em><span class="sig-name descname"><span class="pre">is_ambiguous</span></span><a class="headerlink" href="#lark.parsers.earley_forest.SymbolNode.is_ambiguous" title="Permalink to this definition"></a></dt>
<dd><p>Returns True if this node is ambiguous.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="lark.parsers.earley_forest.SymbolNode.children">
<em class="property"><span class="pre">property</span><span class="w">  </span></em><span class="sig-name descname"><span class="pre">children</span></span><a class="headerlink" href="#lark.parsers.earley_forest.SymbolNode.children" title="Permalink to this definition"></a></dt>
<dd><p>Returns a list of this node’s children sorted from greatest to
least priority.</p>
</dd></dl>

</dd></dl>

</section>
<section id="packednode">
<h3>PackedNode<a class="headerlink" href="#packednode" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="lark.parsers.earley_forest.PackedNode">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.parsers.earley_forest.</span></span><span class="sig-name descname"><span class="pre">PackedNode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parent</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">s</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rule</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.earley_forest.PackedNode" title="Permalink to this definition"></a></dt>
<dd><p>A Packed Node represents a single derivation in a symbol node.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rule</strong> – The rule associated with this node.</p></li>
<li><p><strong>parent</strong> – The parent of this node.</p></li>
<li><p><strong>left</strong> – The left child of this node. <code class="docutils literal notranslate"><span class="pre">None</span></code> if one does not exist.</p></li>
<li><p><strong>right</strong> – The right child of this node. <code class="docutils literal notranslate"><span class="pre">None</span></code> if one does not exist.</p></li>
<li><p><strong>priority</strong> – The priority of this node.</p></li>
</ul>
</dd>
</dl>
<dl class="py property">
<dt class="sig sig-object py" id="lark.parsers.earley_forest.PackedNode.children">
<em class="property"><span class="pre">property</span><span class="w">  </span></em><span class="sig-name descname"><span class="pre">children</span></span><a class="headerlink" href="#lark.parsers.earley_forest.PackedNode.children" title="Permalink to this definition"></a></dt>
<dd><p>Returns a list of this node’s children.</p>
</dd></dl>

</dd></dl>

</section>
<section id="forestvisitor">
<h3>ForestVisitor<a class="headerlink" href="#forestvisitor" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="lark.parsers.earley_forest.ForestVisitor">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.parsers.earley_forest.</span></span><span class="sig-name descname"><span class="pre">ForestVisitor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">single_visit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.earley_forest.ForestVisitor" title="Permalink to this definition"></a></dt>
<dd><p>An abstract base class for building forest visitors.</p>
<p>This class performs a controllable depth-first walk of an SPPF.
The visitor will not enter cycles and will backtrack if one is encountered.
Subclasses are notified of cycles through the <code class="docutils literal notranslate"><span class="pre">on_cycle</span></code> method.</p>
<p>Behavior for visit events is defined by overriding the
<code class="docutils literal notranslate"><span class="pre">visit*node*</span></code> functions.</p>
<p>The walk is controlled by the return values of the <code class="docutils literal notranslate"><span class="pre">visit*node_in</span></code>
methods. Returning a node(s) will schedule them to be visited. The visitor
will begin to backtrack if no nodes are returned.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>single_visit</strong> – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, non-Token nodes will only be visited once.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.earley_forest.ForestVisitor.visit_token_node">
<span class="sig-name descname"><span class="pre">visit_token_node</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.earley_forest.ForestVisitor.visit_token_node" title="Permalink to this definition"></a></dt>
<dd><p>Called when a <code class="docutils literal notranslate"><span class="pre">Token</span></code> is visited. <code class="docutils literal notranslate"><span class="pre">Token</span></code> nodes are always leaves.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.earley_forest.ForestVisitor.visit_symbol_node_in">
<span class="sig-name descname"><span class="pre">visit_symbol_node_in</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.earley_forest.ForestVisitor.visit_symbol_node_in" title="Permalink to this definition"></a></dt>
<dd><p>Called when a symbol node is visited. Nodes that are returned
will be scheduled to be visited. If <code class="docutils literal notranslate"><span class="pre">visit_intermediate_node_in</span></code>
is not implemented, this function will be called for intermediate
nodes as well.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.earley_forest.ForestVisitor.visit_symbol_node_out">
<span class="sig-name descname"><span class="pre">visit_symbol_node_out</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.earley_forest.ForestVisitor.visit_symbol_node_out" title="Permalink to this definition"></a></dt>
<dd><p>Called after all nodes returned from a corresponding <code class="docutils literal notranslate"><span class="pre">visit_symbol_node_in</span></code>
call have been visited. If <code class="docutils literal notranslate"><span class="pre">visit_intermediate_node_out</span></code>
is not implemented, this function will be called for intermediate
nodes as well.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.earley_forest.ForestVisitor.visit_packed_node_in">
<span class="sig-name descname"><span class="pre">visit_packed_node_in</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.earley_forest.ForestVisitor.visit_packed_node_in" title="Permalink to this definition"></a></dt>
<dd><p>Called when a packed node is visited. Nodes that are returned
will be scheduled to be visited.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.earley_forest.ForestVisitor.visit_packed_node_out">
<span class="sig-name descname"><span class="pre">visit_packed_node_out</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.earley_forest.ForestVisitor.visit_packed_node_out" title="Permalink to this definition"></a></dt>
<dd><p>Called after all nodes returned from a corresponding <code class="docutils literal notranslate"><span class="pre">visit_packed_node_in</span></code>
call have been visited.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.earley_forest.ForestVisitor.on_cycle">
<span class="sig-name descname"><span class="pre">on_cycle</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.earley_forest.ForestVisitor.on_cycle" title="Permalink to this definition"></a></dt>
<dd><p>Called when a cycle is encountered.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>node</strong> – The node that causes a cycle.</p></li>
<li><p><strong>path</strong> – The list of nodes being visited: nodes that have been
entered but not exited. The first element is the root in a forest
visit, and the last element is the node visited most recently.
<code class="docutils literal notranslate"><span class="pre">path</span></code> should be treated as read-only.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.earley_forest.ForestVisitor.get_cycle_in_path">
<span class="sig-name descname"><span class="pre">get_cycle_in_path</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.earley_forest.ForestVisitor.get_cycle_in_path" title="Permalink to this definition"></a></dt>
<dd><p>A utility function for use in <code class="docutils literal notranslate"><span class="pre">on_cycle</span></code> to obtain a slice of
<code class="docutils literal notranslate"><span class="pre">path</span></code> that only contains the nodes that make up the cycle.</p>
</dd></dl>

</dd></dl>

</section>
<section id="foresttransformer">
<h3>ForestTransformer<a class="headerlink" href="#foresttransformer" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="lark.parsers.earley_forest.ForestTransformer">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.parsers.earley_forest.</span></span><span class="sig-name descname"><span class="pre">ForestTransformer</span></span><a class="headerlink" href="#lark.parsers.earley_forest.ForestTransformer" title="Permalink to this definition"></a></dt>
<dd><p>The base class for a bottom-up forest transformation. Most users will
want to use <code class="docutils literal notranslate"><span class="pre">TreeForestTransformer</span></code> instead as it has a friendlier
interface and covers most use cases.</p>
<p>Transformations are applied via inheritance and overriding of the
<code class="docutils literal notranslate"><span class="pre">transform*node</span></code> methods.</p>
<p><code class="docutils literal notranslate"><span class="pre">transform_token_node</span></code> receives a <code class="docutils literal notranslate"><span class="pre">Token</span></code> as an argument.
All other methods receive the node that is being transformed and
a list of the results of the transformations of that node’s children.
The return value of these methods are the resulting transformations.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">Discard</span></code> is raised in a node’s transformation, no data from that node
will be passed to its parent’s transformation.</p>
<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.earley_forest.ForestTransformer.transform">
<span class="sig-name descname"><span class="pre">transform</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">root</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.earley_forest.ForestTransformer.transform" title="Permalink to this definition"></a></dt>
<dd><p>Perform a transformation on an SPPF.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.earley_forest.ForestTransformer.transform_symbol_node">
<span class="sig-name descname"><span class="pre">transform_symbol_node</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.earley_forest.ForestTransformer.transform_symbol_node" title="Permalink to this definition"></a></dt>
<dd><p>Transform a symbol node.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.earley_forest.ForestTransformer.transform_intermediate_node">
<span class="sig-name descname"><span class="pre">transform_intermediate_node</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.earley_forest.ForestTransformer.transform_intermediate_node" title="Permalink to this definition"></a></dt>
<dd><p>Transform an intermediate node.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.earley_forest.ForestTransformer.transform_packed_node">
<span class="sig-name descname"><span class="pre">transform_packed_node</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.earley_forest.ForestTransformer.transform_packed_node" title="Permalink to this definition"></a></dt>
<dd><p>Transform a packed node.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.earley_forest.ForestTransformer.transform_token_node">
<span class="sig-name descname"><span class="pre">transform_token_node</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.earley_forest.ForestTransformer.transform_token_node" title="Permalink to this definition"></a></dt>
<dd><p>Transform a <code class="docutils literal notranslate"><span class="pre">Token</span></code>.</p>
</dd></dl>

</dd></dl>

</section>
<section id="treeforesttransformer">
<h3>TreeForestTransformer<a class="headerlink" href="#treeforesttransformer" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="lark.parsers.earley_forest.TreeForestTransformer">
<em class="property"><span class="pre">class</span><span class="w">  </span></em><span class="sig-prename descclassname"><span class="pre">lark.parsers.earley_forest.</span></span><span class="sig-name descname"><span class="pre">TreeForestTransformer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tree_class=&lt;class</span> <span class="pre">'lark.tree.Tree'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prioritizer=&lt;lark.parsers.earley_forest.ForestSumVisitor</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resolve_ambiguity=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_cache=False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.earley_forest.TreeForestTransformer" title="Permalink to this definition"></a></dt>
<dd><p>A <code class="docutils literal notranslate"><span class="pre">ForestTransformer</span></code> with a tree <code class="docutils literal notranslate"><span class="pre">Transformer</span></code>-like interface.
By default, it will construct a tree.</p>
<p>Methods provided via inheritance are called based on the rule/symbol
names of nodes in the forest.</p>
<p>Methods that act on rules will receive a list of the results of the
transformations of the rule’s children. By default, trees and tokens.</p>
<p>Methods that act on tokens will receive a token.</p>
<p>Alternatively, methods that act on rules may be annotated with
<code class="docutils literal notranslate"><span class="pre">handles_ambiguity</span></code>. In this case, the function will receive a list
of all the transformations of all the derivations of the rule.
By default, a list of trees where each tree.data is equal to the
rule name or one of its aliases.</p>
<p>Non-tree transformations are made possible by override of
<code class="docutils literal notranslate"><span class="pre">__default__</span></code>, <code class="docutils literal notranslate"><span class="pre">__default_token__</span></code>, and <code class="docutils literal notranslate"><span class="pre">__default_ambig__</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Tree shaping features such as inlined rules and token filtering are
not built into the transformation. Positions are also not propagated.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tree_class</strong> – The tree class to use for construction</p></li>
<li><p><strong>prioritizer</strong> – A <code class="docutils literal notranslate"><span class="pre">ForestVisitor</span></code> that manipulates the priorities of nodes in the SPPF.</p></li>
<li><p><strong>resolve_ambiguity</strong> – If True, ambiguities will be resolved based on priorities.</p></li>
<li><p><strong>use_cache</strong> (<em>bool</em>) – If True, caches the results of some transformations,
potentially improving performance when <code class="docutils literal notranslate"><span class="pre">resolve_ambiguity==False</span></code>.
Only use if you know what you are doing: i.e. All transformation
functions are pure and referentially transparent.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.earley_forest.TreeForestTransformer.__default__">
<span class="sig-name descname"><span class="pre">__default__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.earley_forest.TreeForestTransformer.__default__" title="Permalink to this definition"></a></dt>
<dd><p>Default operation on tree (for override).</p>
<p>Returns a tree with name with data as children.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.earley_forest.TreeForestTransformer.__default_ambig__">
<span class="sig-name descname"><span class="pre">__default_ambig__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.earley_forest.TreeForestTransformer.__default_ambig__" title="Permalink to this definition"></a></dt>
<dd><p>Default operation on ambiguous rule (for override).</p>
<p>Wraps data in an ‘_ambig_’ node if it contains more than
one element.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lark.parsers.earley_forest.TreeForestTransformer.__default_token__">
<span class="sig-name descname"><span class="pre">__default_token__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.earley_forest.TreeForestTransformer.__default_token__" title="Permalink to this definition"></a></dt>
<dd><p>Default operation on <code class="docutils literal notranslate"><span class="pre">Token</span></code> (for override).</p>
<p>Returns <code class="docutils literal notranslate"><span class="pre">node</span></code>.</p>
</dd></dl>

</dd></dl>

</section>
<section id="handles-ambiguity">
<h3>handles_ambiguity<a class="headerlink" href="#handles-ambiguity" title="Permalink to this heading"></a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="lark.parsers.earley_forest.handles_ambiguity">
<span class="sig-prename descclassname"><span class="pre">lark.parsers.earley_forest.</span></span><span class="sig-name descname"><span class="pre">handles_ambiguity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lark.parsers.earley_forest.handles_ambiguity" title="Permalink to this definition"></a></dt>
<dd><p>Decorator for methods of subclasses of <code class="docutils literal notranslate"><span class="pre">TreeForestTransformer</span></code>.
Denotes that the method should receive a list of transformed derivations.</p>
</dd></dl>

</section>
</section>
<span id="document-tools"></span><section id="tools-stand-alone-nearley">
<h2>Tools (Stand-alone, Nearley)<a class="headerlink" href="#tools-stand-alone-nearley" title="Permalink to this heading"></a></h2>
<section id="stand-alone-parser">
<h3>Stand-alone parser<a class="headerlink" href="#stand-alone-parser" title="Permalink to this heading"></a></h3>
<p>Lark can generate a stand-alone LALR(1) parser from a grammar.</p>
<p>The resulting module provides the same interface as Lark, but with a fixed grammar, and reduced functionality.</p>
<p>Run using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>lark.tools.standalone
</pre></div>
</div>
<p>For a play-by-play, read the <a class="reference external" href="http://blog.erezsh.com/create-a-stand-alone-lalr1-parser-in-python/">tutorial</a></p>
</section>
<section id="importing-grammars-from-nearley-js">
<h3>Importing grammars from Nearley.js<a class="headerlink" href="#importing-grammars-from-nearley-js" title="Permalink to this heading"></a></h3>
<p>Lark comes with a tool to convert grammars from <a class="reference external" href="https://github.com/Hardmath123/nearley">Nearley</a>, a popular Earley library for Javascript. It uses <a class="reference external" href="https://github.com/PiotrDabkowski/Js2Py">Js2Py</a> to convert and run the Javascript postprocessing code segments.</p>
<section id="requirements">
<h4>Requirements<a class="headerlink" href="#requirements" title="Permalink to this heading"></a></h4>
<ol class="simple">
<li><p>Install Lark with the <code class="docutils literal notranslate"><span class="pre">nearley</span></code> component:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>lark<span class="o">[</span>nearley<span class="o">]</span>
</pre></div>
</div>
<ol class="simple">
<li><p>Acquire a copy of the Nearley codebase. This can be done using:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/Hardmath123/nearley
</pre></div>
</div>
</section>
<section id="usage">
<h4>Usage<a class="headerlink" href="#usage" title="Permalink to this heading"></a></h4>
<p>The tool can be run using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>lark.tools.nearley<span class="w"> </span>&lt;grammar.ne&gt;<span class="w"> </span>&lt;start_rule&gt;<span class="w"> </span>&lt;path_to_nearley_repo&gt;
</pre></div>
</div>
<p>Here’s an example of how to import nearley’s calculator example into Lark:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/Hardmath123/nearley
python<span class="w"> </span>-m<span class="w"> </span>lark.tools.nearley<span class="w"> </span>nearley/examples/calculator/arithmetic.ne<span class="w"> </span>main<span class="w"> </span>./nearley<span class="w"> </span>&gt;<span class="w"> </span>ncalc.py
</pre></div>
</div>
<p>You can use the output as a regular python module:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ncalc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ncalc</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;sin(pi/4) ^ e&#39;</span><span class="p">)</span>
<span class="go">0.38981434460254655</span>
</pre></div>
</div>
<p>The Nearley converter also supports an experimental converter for newer JavaScript (ES6+), using the <code class="docutils literal notranslate"><span class="pre">--es6</span></code> flag:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/Hardmath123/nearley
python<span class="w"> </span>-m<span class="w"> </span>lark.tools.nearley<span class="w"> </span>nearley/examples/calculator/arithmetic.ne<span class="w"> </span>main<span class="w"> </span>nearley<span class="w"> </span>--es6<span class="w"> </span>&gt;<span class="w"> </span>ncalc.py
</pre></div>
</div>
</section>
<section id="notes">
<h4>Notes<a class="headerlink" href="#notes" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>Lark currently cannot import templates from Nearley</p></li>
<li><p>Lark currently cannot export grammars to Nearley</p></li>
</ul>
<p>These might get added in the future, if enough users ask for them.</p>
</section>
</section>
</section>
</div>
<p>Lark is a modern parsing library for Python. Lark can parse any context-free grammar.</p>
<p>Lark provides:</p>
<ul class="simple">
<li><p>Advanced grammar language, based on EBNF</p></li>
<li><p>Three parsing algorithms to choose from: Earley, LALR(1) and CYK</p></li>
<li><p>Automatic tree construction, inferred from your grammar</p></li>
<li><p>Fast unicode lexer with regexp support, and automatic line-counting</p></li>
</ul>
<section id="install-lark">
<h2>Install Lark<a class="headerlink" href="#install-lark" title="Permalink to this heading"></a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>lark
</pre></div>
</div>
</section>
<section id="syntax-highlighting">
<h2>Syntax Highlighting<a class="headerlink" href="#syntax-highlighting" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/lark-parser/lark_syntax">Sublime Text &amp; TextMate</a></p></li>
<li><p><a class="reference external" href="https://github.com/lark-parser/vscode-lark">Visual Studio Code</a> (Or install through the vscode plugin system)</p></li>
<li><p><a class="reference external" href="https://github.com/lark-parser/intellij-syntax-highlighting">Intellij &amp; PyCharm</a></p></li>
<li><p><a class="reference external" href="https://github.com/lark-parser/vim-lark-syntax">Vim</a></p></li>
<li><p><a class="reference external" href="https://github.com/Alhadis/language-grammars">Atom</a></p></li>
</ul>
</section>
<section id="resources">
<h2>Resources<a class="headerlink" href="#resources" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="index.html#document-philosophy"><span class="doc">Philosophy</span></a></p></li>
<li><p><a class="reference internal" href="index.html#document-features"><span class="doc">Features</span></a></p></li>
<li><p><a class="reference external" href="https://github.com/lark-parser/lark/tree/master/examples">Examples</a></p></li>
<li><p><a class="reference external" href="https://github.com/ligurio/lark-grammars">Third-party examples</a></p></li>
<li><p><a class="reference external" href="https://lark-parser.org/ide">Online IDE</a></p></li>
<li><p>Tutorials</p>
<ul>
<li><p><a class="reference external" href="https://eshsoft.com/blog/write-dsl-in-python-with-lark">How to write a DSL</a> - Implements a toy LOGO-like language with
an interpreter</p></li>
<li><p><a class="reference internal" href="index.html#document-json_tutorial"><span class="doc">JSON parser - Tutorial</span></a> - Teaches you how to use Lark</p></li>
<li><p>Unofficial</p>
<ul>
<li><p><a class="reference external" href="https://www.cs.cornell.edu/~asampson/blog/minisynth.html">Program Synthesis is Possible</a> - Creates a DSL for Z3</p></li>
<li><p><a class="reference external" href="https://www.youtube.com/watch?v=CeOtqlh0UuQ">Using Lark to Parse Text - Robin Reynolds-Haertle (PyCascades 2023)</a> (video presentation)</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Guides</p>
<ul>
<li><p><a class="reference internal" href="index.html#document-how_to_use"><span class="doc">How To Use Lark - Guide</span></a></p></li>
<li><p><a class="reference internal" href="index.html#document-how_to_develop"><span class="doc">How to develop Lark - Guide</span></a></p></li>
</ul>
</li>
<li><p>Reference</p>
<ul>
<li><p><a class="reference internal" href="index.html#document-grammar"><span class="doc">Grammar Reference</span></a></p></li>
<li><p><a class="reference internal" href="index.html#document-tree_construction"><span class="doc">Tree Construction Reference</span></a></p></li>
<li><p><a class="reference internal" href="index.html#document-visitors"><span class="doc">Transformers &amp; Visitors</span></a></p></li>
<li><p><a class="reference internal" href="index.html#document-forest"><span class="doc">Working with the SPPF</span></a></p></li>
<li><p><a class="reference internal" href="index.html#document-classes"><span class="doc">API Reference</span></a></p></li>
<li><p><a class="reference internal" href="index.html#document-tools"><span class="doc">Tools (Stand-alone, Nearley)</span></a></p></li>
<li><p><a class="reference external" href="_static/lark_cheatsheet.pdf">Cheatsheet (PDF)</a></p></li>
</ul>
</li>
<li><p>Discussion</p>
<ul>
<li><p><a class="reference external" href="https://gitter.im/lark-parser/Lobby">Gitter</a></p></li>
<li><p><a class="reference external" href="https://groups.google.com/forum/#!forum/lark-parser">Forum (Google Groups)</a></p></li>
</ul>
</li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Erez Shinan.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>